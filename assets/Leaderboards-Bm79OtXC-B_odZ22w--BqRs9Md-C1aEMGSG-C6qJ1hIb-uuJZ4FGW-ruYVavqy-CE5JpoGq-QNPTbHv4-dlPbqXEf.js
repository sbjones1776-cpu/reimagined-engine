import{b as V,C as Q,a2 as Z,r as h,U as _,aN as ee,x as e,P as o,l as N,o as P,i as se,k as ae,W as j,G as u,u as p,Y as g,t as q,v as le,f as A,m as W,ag as te,A as re,D as X,aO as ie,az as ce,aP as ne,aQ as de,aR as me,aS as oe,aT as xe,aU as he}from"./index-BX6Y2SaO.js";import{D as O}from"./useMutation-Dw-sPjxD-CEUn9Yuu-xvhDPSZb-Dr0QtMK_-BVesU6qw-CG5MCbzm-BvDHL4Y4-BLMKEBwG-B1Kla6TY-DNLsubLb.js";import{Y as je,P as ue,B as f,Q as v}from"./tabs-BCUfDdd3-DRpA79_--UQJ3H5nI-BCygjE_3-CERtGQAZ-BoCXO3SG-CiW37Qbf-CABa6JX2-DjJdYRTG-BebtthiM.js";import{x as w}from"./user-plus-DvDth6Co-mjoHpJFL-BN7sEb4a-XUvNzI20-Du5ZVLe7-CSuTkKjt-Dd0stPfK-9C-XPk8w-WTJ8bO6l-Bqi2HE31.js";import{p as pe}from"./trending-up-DOxCo9I6-CjyZKRpy-BwiJPOic-BbyIY-I5-2slMDHp0-Dt8Hz_gu-DQ4ciPVI-C7q_24xj-H1M9DqwC-CFaYqVfq.js";import{p as ge}from"./zap-BUGd4PS--D5Rx8Je6-38BwrXim-CvVM-oS5-D5MMr3dA-CncrG6o8-h7sLaBiA-CSYVy3Yk-Fuox9TMR-C7HLLnHm.js";import{t as ye}from"./plus-CzE6Y-vE-CTS6AMhf-DQnCZw7L-g8gOaACh-BCHOnD0---4-_1MLM-D60HZjyU-CK9qTR---B813dogJ-CoPCoFbU.js";import{y as be}from"./target-1p2ICMDN-CvDzxGjB-qkOcir94-HosS9mN8-D7ZLtM3Q-fUNOd4Tb-uVCUCnov-BMauAVDu-BG4_fLfQ-mdeLfgsR.js";import{d as D}from"./medal-iK-ypg-g-C4SGU5mg-BNIgUb0U-Bj1cSb-g-DgYru0Gs-B5_uRmKS-BqjAjW_i-_Qq55oOh-BwVksR0Q-BZY9egzp.js";import{s as Ne}from"./startOfMonth-D3h4jTlt-D4WVPLzh-Dy-xtlLU-xSybLC5--BPyiYMnQ-k2gq4TdQ-DUtTXYiH-ClTToQ8q-BkYvAO4I-Bam7_poJ.js";function Fe(){const y=V(),[x,T]=Q.useState(""),[z,F]=Q.useState(!1),{user:r}=Z(),{data:$=[]}=h({queryKey:["allUsers"],queryFn:()=>de(),staleTime:3e5,gcTime:6e5}),{data:m=[]}=h({queryKey:["allProgress"],queryFn:()=>me(),staleTime:3e5,gcTime:6e5}),{data:k=[]}=h({queryKey:["allDailyChallenges"],queryFn:()=>oe(),staleTime:3e5,gcTime:6e5}),{data:C=[]}=h({queryKey:["myFriends",r==null?void 0:r.email],queryFn:()=>xe(r.email),enabled:!!(r!=null&&r.email),staleTime:6e4}),{data:S=[]}=h({queryKey:["pendingRequests",r==null?void 0:r.email],queryFn:()=>he(r.email),enabled:!!(r!=null&&r.email),staleTime:6e4}),K=O({mutationFn:async({user_email:s,friend_email:a})=>await ne(s,a),onSuccess:()=>{y.invalidateQueries({queryKey:["myFriends",r==null?void 0:r.email]}),y.invalidateQueries({queryKey:["pendingRequests",r==null?void 0:r.email]}),F(!0),T(""),setTimeout(()=>F(!1),3e3)}}),M=O({mutationFn:async({id:s,status:a})=>await ie(s,a),onSuccess:()=>{y.invalidateQueries({queryKey:["myFriends",r==null?void 0:r.email]}),y.invalidateQueries({queryKey:["pendingRequests",r==null?void 0:r.email]})}}),H=`${_(new Date,"yyyy")}-W${ee(new Date)}`,I=`${_(new Date,"yyyy")}-M${_(new Date,"MM")}`,b=(s,a=null)=>{const l=m.filter(i=>a?i.operation===s&&i.level===a:i.operation===s),t={};return l.forEach(i=>{const c=i.user_email;t[c]||(t[c]={email:c,totalScore:0,bestScore:0,gamesPlayed:0,totalAccuracy:0}),t[c].totalScore+=i.score,t[c].bestScore=Math.max(t[c].bestScore,i.score),t[c].gamesPlayed++,t[c].totalAccuracy+=i.correct_answers/i.total_questions*100}),Object.values(t).map(i=>({...i,avgAccuracy:Math.round(i.totalAccuracy/i.gamesPlayed)})).sort((i,c)=>c.bestScore-i.bestScore).slice(0,10)},L=()=>{const s={};return m.forEach(a=>{const l=a.user_email;(!s[l]||a.time_taken<s[l].time)&&(s[l]={email:l,time:a.time_taken,score:a.score,accuracy:Math.round(a.correct_answers/a.total_questions*100)})}),Object.values(s).sort((a,l)=>a.time-l.time).slice(0,10)},U=()=>{const s=C.map(l=>l.user_email===(r==null?void 0:r.email)?l.friend_email:l.user_email);s.push(r==null?void 0:r.email);const a={};return m.forEach(l=>{const t=l.user_email;s.includes(t)&&(a[t]||(a[t]={email:t,totalScore:0,gamesPlayed:0,totalStars:0}),a[t].totalScore+=l.score,a[t].gamesPlayed++,a[t].totalStars+=l.stars_earned||0)}),Object.values(a).sort((l,t)=>t.totalScore-l.totalScore).slice(0,10)},R=s=>{const a=s==="weekly"?ce(new Date):Ne(new Date),l={};return m.forEach(t=>{var i;const c=(i=t.completed_at)!=null&&i.toDate?t.completed_at.toDate():new Date,n=t.user_email;c>=a&&(l[n]||(l[n]={email:n,totalScore:0,gamesPlayed:0,totalStars:0}),l[n].totalScore+=t.score,l[n].gamesPlayed++,l[n].totalStars+=t.stars_earned||0)}),Object.values(l).sort((t,i)=>i.totalScore-t.totalScore).slice(0,10)},Y=s=>s===1?e.jsx(o,{className:"w-6 h-6 text-yellow-500 fill-yellow-500"}):s===2?e.jsx(D,{className:"w-6 h-6 text-gray-400 fill-gray-400"}):s===3?e.jsx(D,{className:"w-6 h-6 text-amber-600 fill-amber-600"}):e.jsxs("span",{className:"w-6 h-6 flex items-center justify-center font-bold text-gray-500",children:["#",s]}),G=s=>s===1?"from-yellow-100 to-yellow-200 border-yellow-300":s===2?"from-gray-100 to-gray-200 border-gray-300":s===3?"from-amber-100 to-amber-200 border-amber-300":"from-white to-gray-50 border-gray-200",B=s=>{const a=$.find(l=>l.email===s);return(a==null?void 0:a.child_name)||(a==null?void 0:a.full_name)||s.split("@")[0]},J=()=>{!x||x===(r==null?void 0:r.email)||K.mutate({user_email:r.email,friend_email:x,connection_type:"friend"})},d=({title:s,icon:a,data:l,renderStats:t})=>e.jsxs(j,{className:"border-2 border-purple-200",children:[e.jsx(u,{className:"bg-gradient-to-r from-purple-100 to-pink-100",children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-6 h-6 text-purple-600"}),s]})}),e.jsx(g,{className:"p-6",children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(o,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No data available yet"})]}):e.jsx("div",{className:"space-y-2",children:l.map((i,c)=>{const n=c+1,E=i.email===(r==null?void 0:r.email);return e.jsx("div",{className:`flex items-center justify-between p-4 rounded-xl border-2 transition-all ${E?"bg-gradient-to-r from-purple-100 to-pink-100 border-purple-300 shadow-md":`bg-gradient-to-r ${G(n)} border`}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[Y(n),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:B(i.email)}),E&&e.jsx(A,{className:"bg-purple-500 text-white",children:"You"})]}),t(i)]})]})},c)})})})]});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-block mb-4",children:e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-xl",children:e.jsx(o,{className:"w-10 h-10 text-white"})})}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-r from-yellow-600 via-orange-600 to-red-600 bg-clip-text text-transparent",children:"Leaderboards"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Compete with friends and players worldwide!"}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-4 justify-center text-sm text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow",children:[e.jsx(o,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("span",{children:[$.length," Players"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow",children:[e.jsx(N,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{children:[m.length," Game Entries"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow",children:[e.jsx(P,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{children:[k.length," Daily Challenges"]})]})]})]}),z&&e.jsxs(se,{className:"mb-6 bg-green-50 border-green-200",children:[e.jsx(w,{className:"w-4 h-4 text-green-600"}),e.jsx(ae,{className:"text-green-800",children:"Friend request sent successfully! ğŸ‰"})]}),S.length>0&&e.jsxs(j,{className:"mb-6 border-2 border-blue-300 bg-blue-50",children:[e.jsx(u,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-blue-600"}),"Pending Friend Requests (",S.length,")"]})}),e.jsx(g,{children:e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"font-medium",children:B(s.user_email)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{size:"sm",onClick:()=>M.mutate({id:s.id,status:"accepted"}),className:"bg-green-500 hover:bg-green-600",children:"Accept"}),e.jsx(q,{size:"sm",variant:"outline",onClick:()=>M.mutate({id:s.id,status:"declined"}),children:"Decline"})]})]},s.id))})})]}),e.jsxs(je,{defaultValue:"tournaments",className:"space-y-6",children:[e.jsxs(ue,{className:"grid w-full grid-cols-2 md:grid-cols-4",children:[e.jsx(f,{value:"tournaments",children:"Tournaments"}),e.jsx(f,{value:"categories",children:"Categories"}),e.jsx(f,{value:"friends",children:"Friends"}),e.jsx(f,{value:"special",children:"Special"})]}),e.jsxs(v,{value:"tournaments",className:"space-y-6",children:[e.jsxs(j,{className:"border-4 border-yellow-300 bg-gradient-to-r from-yellow-50 to-orange-50",children:[e.jsx(u,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-6 h-6 text-yellow-600"}),"Active Tournaments"]})}),e.jsx(g,{children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(P,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Weekly Tournament"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Resets every Monday"})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tournament ID:"}),e.jsx("span",{className:"font-bold",children:H})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Prize:"}),e.jsx("span",{className:"font-bold text-yellow-600",children:"50 Bonus Stars â­"})]})]}),e.jsx(A,{className:"w-full justify-center bg-purple-500 text-white",children:"Active Now"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(P,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Monthly Tournament"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Resets on 1st of month"})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tournament ID:"}),e.jsx("span",{className:"font-bold",children:I})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Prize:"}),e.jsx("span",{className:"font-bold text-yellow-600",children:"100 Bonus Stars â­"})]})]}),e.jsx(A,{className:"w-full justify-center bg-blue-500 text-white",children:"Active Now"})]})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(d,{title:"Weekly Leaders",icon:pe,data:R("weekly"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),s.totalScore," pts"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4 text-yellow-500"}),s.totalStars]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})}),e.jsx(d,{title:"Monthly Leaders",icon:W,data:R("monthly"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),s.totalScore," pts"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4 text-yellow-500"}),s.totalStars]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})})]})]}),e.jsx(v,{value:"categories",className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(d,{title:"Multiplication Masters (Hard)",icon:ge,data:b("multiplication","hard"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:["Best: ",s.bestScore]}),e.jsxs("span",{children:["Avg: ",s.avgAccuracy,"%"]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})}),e.jsx(d,{title:"Addition Champions",icon:ye,data:b("addition"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:["Best: ",s.bestScore]}),e.jsxs("span",{children:["Avg: ",s.avgAccuracy,"%"]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})}),e.jsx(d,{title:"Division Experts (Hard)",icon:be,data:b("division","hard"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:["Best: ",s.bestScore]}),e.jsxs("span",{children:["Avg: ",s.avgAccuracy,"%"]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})}),e.jsx(d,{title:"Subtraction Stars",icon:D,data:b("subtraction"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:["Best: ",s.bestScore]}),e.jsxs("span",{children:["Avg: ",s.avgAccuracy,"%"]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})})]})}),e.jsxs(v,{value:"friends",className:"space-y-6",children:[e.jsxs(j,{className:"border-2 border-blue-200 bg-blue-50",children:[e.jsx(u,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-blue-600"}),"Invite Friends"]})}),e.jsxs(g,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{placeholder:"Enter friend's email",value:x,onChange:s=>T(s.target.value),type:"email"}),e.jsxs(q,{onClick:J,className:"bg-blue-500 hover:bg-blue-600",disabled:K.isPending||!x,children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Invite"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Connected friends: ",C.length]})]})]}),e.jsx(d,{title:"Friends & Family Leaderboard",icon:re,data:U(),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),s.totalScore," pts"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4 text-yellow-500"}),s.totalStars]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})})]}),e.jsxs(v,{value:"special",className:"space-y-6",children:[e.jsx(d,{title:"Speed Demons (Fastest Completion)",icon:X,data:L(),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 font-bold text-blue-600",children:[e.jsx(X,{className:"w-4 h-4"}),s.time,"s"]}),e.jsxs("span",{children:[s.score," pts"]}),e.jsxs("span",{children:[s.accuracy,"% accuracy"]})]})}),e.jsxs(j,{className:"border-2 border-green-200 bg-green-50",children:[e.jsx(u,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-6 h-6 text-green-600"}),"Special Achievements"]})}),e.jsx(g,{children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ†"}),e.jsx("h4",{className:"font-bold mb-1",children:"Perfect Score Club"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m.filter(s=>s.correct_answers/s.total_questions===1).length," perfect games"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"âš¡"}),e.jsx("h4",{className:"font-bold mb-1",children:"Speed Masters"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m.filter(s=>s.time_taken<60).length," games under 60s"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ”¥"}),e.jsx("h4",{className:"font-bold mb-1",children:"Daily Warriors"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[k.length," daily challenges completed"]})]})]})})]})]})]})]})}export{Fe as default};
