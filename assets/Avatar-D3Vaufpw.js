import{c as ye,j as e,r as d,a0 as He,a1 as ve,a2 as $e,a3 as Be,a4 as Ue,a5 as we,a6 as We,a7 as Qe,a8 as A,a9 as _e,aa as Ge,ab as qe,ac as Ye,ad as ze,o as Ke,N as Ve,z as Je,n as Xe,u as Ze,ae as ea,B as W,af as me,h as k,i as Q,k as G,ag as q,ah as Y,A as F,v as R,y as H,L as z,g as $,ai as ee,C as M,d as O,p as aa,b as ta,f as ue,W as sa,I as K,J as V,U as ra,K as la}from"./index-C0XnwW1J.js";import{u as pe}from"./useMutation-BBbn5Ibo.js";import{L as he}from"./label-BaWOfaZ4.js";import{T as na,a as oa,b as ae,c as te}from"./tabs-CHDP_n8y.js";import ia from"./AvatarDisplay-Bq8KvINC.js";import{R as ca}from"./index-BwFEnwcg.js";import{L as xe}from"./lock-C1-5gGAl.js";import da from"./PetDisplay-CWJwigaH.js";import{C as ma}from"./credit-card-6uWoetCu.js";import{S as ua}from"./save-_1Dbls43.js";import{T as fe}from"./triangle-alert-Dd6OicLx.js";import"./progress-D8Mly-oi.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],ha=ye("Shirt",pa);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],fa=ye("Smile",xa);var ga=Symbol("radix.slottable");function ja(t){const s=({children:a})=>e.jsx(e.Fragment,{children:a});return s.displayName=`${t}.Slottable`,s.__radixId=ga,s}var[J]=He("Tooltip",[ve]),X=ve(),Ne="TooltipProvider",ba=700,se="tooltip.open",[ya,ne]=J(Ne),ke=t=>{const{__scopeTooltip:s,delayDuration:a=ba,skipDelayDuration:l=300,disableHoverableContent:n=!1,children:i}=t,c=d.useRef(!0),g=d.useRef(!1),m=d.useRef(0);return d.useEffect(()=>{const u=m.current;return()=>window.clearTimeout(u)},[]),e.jsx(ya,{scope:s,isOpenDelayedRef:c,delayDuration:a,onOpen:d.useCallback(()=>{window.clearTimeout(m.current),c.current=!1},[]),onClose:d.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>c.current=!0,l)},[l]),isPointerInTransitRef:g,onPointerInTransitChange:d.useCallback(u=>{g.current=u},[]),disableHoverableContent:n,children:i})};ke.displayName=Ne;var B="Tooltip",[va,U]=J(B),Ce=t=>{const{__scopeTooltip:s,children:a,open:l,defaultOpen:n,onOpenChange:i,disableHoverableContent:c,delayDuration:g}=t,m=ne(B,t.__scopeTooltip),u=X(s),[r,h]=d.useState(null),b=$e(),x=d.useRef(0),y=c??m.disableHoverableContent,f=g??m.delayDuration,p=d.useRef(!1),[N,v]=Be({prop:l,defaultProp:n??!1,onChange:D=>{D?(m.onOpen(),document.dispatchEvent(new CustomEvent(se))):m.onClose(),i==null||i(D)},caller:B}),L=d.useMemo(()=>N?p.current?"delayed-open":"instant-open":"closed",[N]),T=d.useCallback(()=>{window.clearTimeout(x.current),x.current=0,p.current=!1,v(!0)},[v]),j=d.useCallback(()=>{window.clearTimeout(x.current),x.current=0,v(!1)},[v]),S=d.useCallback(()=>{window.clearTimeout(x.current),x.current=window.setTimeout(()=>{p.current=!0,v(!0),x.current=0},f)},[f,v]);return d.useEffect(()=>()=>{x.current&&(window.clearTimeout(x.current),x.current=0)},[]),e.jsx(Ue,{...u,children:e.jsx(va,{scope:s,contentId:b,open:N,stateAttribute:L,trigger:r,onTriggerChange:h,onTriggerEnter:d.useCallback(()=>{m.isOpenDelayedRef.current?S():T()},[m.isOpenDelayedRef,S,T]),onTriggerLeave:d.useCallback(()=>{y?j():(window.clearTimeout(x.current),x.current=0)},[j,y]),onOpen:T,onClose:j,disableHoverableContent:y,children:a})})};Ce.displayName=B;var re="TooltipTrigger",Te=d.forwardRef((t,s)=>{const{__scopeTooltip:a,...l}=t,n=U(re,a),i=ne(re,a),c=X(a),g=d.useRef(null),m=we(s,g,n.onTriggerChange),u=d.useRef(!1),r=d.useRef(!1),h=d.useCallback(()=>u.current=!1,[]);return d.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),e.jsx(We,{asChild:!0,...c,children:e.jsx(Qe.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...l,ref:m,onPointerMove:A(t.onPointerMove,b=>{b.pointerType!=="touch"&&!r.current&&!i.isPointerInTransitRef.current&&(n.onTriggerEnter(),r.current=!0)}),onPointerLeave:A(t.onPointerLeave,()=>{n.onTriggerLeave(),r.current=!1}),onPointerDown:A(t.onPointerDown,()=>{n.open&&n.onClose(),u.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:A(t.onFocus,()=>{u.current||n.onOpen()}),onBlur:A(t.onBlur,n.onClose),onClick:A(t.onClick,n.onClose)})})});Te.displayName=re;var oe="TooltipPortal",[wa,_a]=J(oe,{forceMount:void 0}),Pe=t=>{const{__scopeTooltip:s,forceMount:a,children:l,container:n}=t,i=U(oe,s);return e.jsx(wa,{scope:s,forceMount:a,children:e.jsx(_e,{present:a||i.open,children:e.jsx(Ge,{asChild:!0,container:n,children:l})})})};Pe.displayName=oe;var I="TooltipContent",Se=d.forwardRef((t,s)=>{const a=_a(I,t.__scopeTooltip),{forceMount:l=a.forceMount,side:n="top",...i}=t,c=U(I,t.__scopeTooltip);return e.jsx(_e,{present:l||c.open,children:c.disableHoverableContent?e.jsx(Ee,{side:n,...i,ref:s}):e.jsx(Na,{side:n,...i,ref:s})})}),Na=d.forwardRef((t,s)=>{const a=U(I,t.__scopeTooltip),l=ne(I,t.__scopeTooltip),n=d.useRef(null),i=we(s,n),[c,g]=d.useState(null),{trigger:m,onClose:u}=a,r=n.current,{onPointerInTransitChange:h}=l,b=d.useCallback(()=>{g(null),h(!1)},[h]),x=d.useCallback((y,f)=>{const p=y.currentTarget,N={x:y.clientX,y:y.clientY},v=Sa(N,p.getBoundingClientRect()),L=Ea(N,v),T=Ra(f.getBoundingClientRect()),j=Da([...L,...T]);g(j),h(!0)},[h]);return d.useEffect(()=>()=>b(),[b]),d.useEffect(()=>{if(m&&r){const y=p=>x(p,r),f=p=>x(p,m);return m.addEventListener("pointerleave",y),r.addEventListener("pointerleave",f),()=>{m.removeEventListener("pointerleave",y),r.removeEventListener("pointerleave",f)}}},[m,r,x,b]),d.useEffect(()=>{if(c){const y=f=>{const p=f.target,N={x:f.clientX,y:f.clientY},v=(m==null?void 0:m.contains(p))||(r==null?void 0:r.contains(p)),L=!La(N,c);v?b():L&&(b(),u())};return document.addEventListener("pointermove",y),()=>document.removeEventListener("pointermove",y)}},[m,r,c,u,b]),e.jsx(Ee,{...t,ref:i})}),[ka,Ca]=J(B,{isInside:!1}),Ta=ja("TooltipContent"),Ee=d.forwardRef((t,s)=>{const{__scopeTooltip:a,children:l,"aria-label":n,onEscapeKeyDown:i,onPointerDownOutside:c,...g}=t,m=U(I,a),u=X(a),{onClose:r}=m;return d.useEffect(()=>(document.addEventListener(se,r),()=>document.removeEventListener(se,r)),[r]),d.useEffect(()=>{if(m.trigger){const h=b=>{const x=b.target;x!=null&&x.contains(m.trigger)&&r()};return window.addEventListener("scroll",h,{capture:!0}),()=>window.removeEventListener("scroll",h,{capture:!0})}},[m.trigger,r]),e.jsx(qe,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:c,onFocusOutside:h=>h.preventDefault(),onDismiss:r,children:e.jsxs(Ye,{"data-state":m.stateAttribute,...u,...g,ref:s,style:{...g.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(Ta,{children:l}),e.jsx(ka,{scope:a,isInside:!0,children:e.jsx(ca,{id:m.contentId,role:"tooltip",children:n||l})})]})})});Se.displayName=I;var Re="TooltipArrow",Pa=d.forwardRef((t,s)=>{const{__scopeTooltip:a,...l}=t,n=X(a);return Ca(Re,a).isInside?null:e.jsx(ze,{...n,...l,ref:s})});Pa.displayName=Re;function Sa(t,s){const a=Math.abs(s.top-t.y),l=Math.abs(s.bottom-t.y),n=Math.abs(s.right-t.x),i=Math.abs(s.left-t.x);switch(Math.min(a,l,n,i)){case i:return"left";case n:return"right";case a:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function Ea(t,s,a=5){const l=[];switch(s){case"top":l.push({x:t.x-a,y:t.y+a},{x:t.x+a,y:t.y+a});break;case"bottom":l.push({x:t.x-a,y:t.y-a},{x:t.x+a,y:t.y-a});break;case"left":l.push({x:t.x+a,y:t.y-a},{x:t.x+a,y:t.y+a});break;case"right":l.push({x:t.x-a,y:t.y-a},{x:t.x-a,y:t.y+a});break}return l}function Ra(t){const{top:s,right:a,bottom:l,left:n}=t;return[{x:n,y:s},{x:a,y:s},{x:a,y:l},{x:n,y:l}]}function La(t,s){const{x:a,y:l}=t;let n=!1;for(let i=0,c=s.length-1;i<s.length;c=i++){const g=s[i],m=s[c],u=g.x,r=g.y,h=m.x,b=m.y;r>l!=b>l&&a<(h-u)*(l-r)/(b-r)+u&&(n=!n)}return n}function Da(t){const s=t.slice();return s.sort((a,l)=>a.x<l.x?-1:a.x>l.x?1:a.y<l.y?-1:a.y>l.y?1:0),Aa(s)}function Aa(t){if(t.length<=1)return t.slice();const s=[];for(let l=0;l<t.length;l++){const n=t[l];for(;s.length>=2;){const i=s[s.length-1],c=s[s.length-2];if((i.x-c.x)*(n.y-c.y)>=(i.y-c.y)*(n.x-c.x))s.pop();else break}s.push(n)}s.pop();const a=[];for(let l=t.length-1;l>=0;l--){const n=t[l];for(;a.length>=2;){const i=a[a.length-1],c=a[a.length-2];if((i.x-c.x)*(n.y-c.y)>=(i.y-c.y)*(n.x-c.x))a.pop();else break}a.push(n)}return a.pop(),s.length===1&&a.length===1&&s[0].x===a[0].x&&s[0].y===a[0].y?s:s.concat(a)}var Ma=ke,Oa=Ce,Ia=Te,Fa=Pe,Le=Se;const ge=Ma,je=Oa,be=Ia,le=d.forwardRef(({className:t,sideOffset:s=4,...a},l)=>e.jsx(Fa,{children:e.jsx(Le,{ref:l,sideOffset:s,className:Ke("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));le.displayName=Le.displayName;function De({type:t,value:s,size:a=32}){const l=i=>{const c=a/64;return i==="wink"?e.jsxs("g",{transform:`scale(${c})`,children:[e.jsx("circle",{cx:"20",cy:"24",r:"7",fill:"#111827"}),e.jsx("circle",{cx:"20",cy:"23",r:"3",fill:"#ffffff"}),e.jsx("circle",{cx:"21",cy:"22",r:"1.5",fill:"#ffffff",opacity:"0.6"}),e.jsx("path",{d:"M38 24 Q 44 24 50 24",stroke:"#111827",strokeWidth:"3",strokeLinecap:"round"})]}):i==="sleepy"?e.jsxs("g",{transform:`scale(${c})`,children:[e.jsx("path",{d:"M14 24 Q 20 30 26 24",stroke:"#111827",strokeWidth:"3",strokeLinecap:"round",fill:"none"}),e.jsx("path",{d:"M38 24 Q 44 30 50 24",stroke:"#111827",strokeWidth:"3",strokeLinecap:"round",fill:"none"})]}):e.jsxs("g",{transform:`scale(${c})`,children:[e.jsx("circle",{cx:"20",cy:"24",r:"7",fill:"#111827"}),e.jsx("circle",{cx:"20",cy:"23",r:"3",fill:"#ffffff"}),e.jsx("circle",{cx:"21",cy:"22",r:"1.5",fill:"#ffffff",opacity:"0.6"}),e.jsx("circle",{cx:"44",cy:"24",r:"7",fill:"#111827"}),e.jsx("circle",{cx:"44",cy:"23",r:"3",fill:"#ffffff"}),e.jsx("circle",{cx:"45",cy:"22",r:"1.5",fill:"#ffffff",opacity:"0.6"})]})},n=i=>{const c=a/64;return i==="big_smile"?e.jsxs("g",{transform:`scale(${c})`,children:[e.jsx("path",{d:"M18 42 Q 32 56 46 42",stroke:"#111827",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),e.jsx("path",{d:"M22 42 Q 32 52 42 42",stroke:"#ef4444",strokeWidth:"2.5",fill:"none",strokeLinecap:"round"})]}):i==="open_smile"?e.jsx("g",{transform:`scale(${c})`,children:e.jsx("path",{d:"M20 40 Q 32 56 44 40 Q 32 48 20 40 Z",fill:"#ef4444",stroke:"#111827",strokeWidth:"2.5"})}):i==="grin"?e.jsxs("g",{transform:`scale(${c})`,children:[e.jsx("path",{d:"M18 44 Q 32 52 46 44",stroke:"#111827",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),e.jsx("path",{d:"M28 44 L 28 47",stroke:"#111827",strokeWidth:"1.5"}),e.jsx("path",{d:"M36 44 L 36 47",stroke:"#111827",strokeWidth:"1.5"})]}):i==="tongue_out"?e.jsxs("g",{transform:`scale(${c})`,children:[e.jsx("path",{d:"M20 42 Q 32 50 44 42",stroke:"#111827",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),e.jsx("path",{d:"M28 42 Q 32 52 36 42",fill:"#f87171",stroke:"#111827",strokeWidth:"1.5"})]}):i==="neutral"?e.jsx("g",{transform:`scale(${c})`,children:e.jsx("path",{d:"M22 44 L 42 44",stroke:"#111827",strokeWidth:"3",strokeLinecap:"round"})}):e.jsx("g",{transform:`scale(${c})`,children:e.jsx("path",{d:"M20 42 Q 32 50 44 42",stroke:"#111827",strokeWidth:"3",fill:"none",strokeLinecap:"round"})})};return e.jsxs("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,className:"inline-block",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:a/2-1,fill:"#FFE0BD",stroke:"#e5e7eb",strokeWidth:"1"}),t==="eyes"?l(s):null,t==="mouth"?n(s):null,t==="face"?e.jsxs(e.Fragment,{children:[l("normal"),n(s)]}):null]})}function P({title:t,options:s,selected:a,onChange:l,isUnlocked:n,unlockableItems:i=[],type:c="default",previewType:g=null}){const m=u=>{const r=i.find(h=>h.id===u);return(r==null?void 0:r.requirement)||"Complete challenges to unlock"};return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800",children:t}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:s.map(u=>{const r=n(u.id),h=a===u.id;return c==="color"?e.jsx(ge,{children:e.jsxs(je,{children:[e.jsx(be,{asChild:!0,children:e.jsxs("button",{onClick:()=>r&&l(u.id),disabled:!r,className:`relative h-16 rounded-xl border-4 transition-all ${h?"border-purple-500 shadow-lg scale-110":"border-gray-200 hover:border-purple-300"} ${!r&&"opacity-50 cursor-not-allowed"}`,style:{backgroundColor:u.color},children:[!r&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 rounded-lg",children:e.jsx(xe,{className:"w-6 h-6 text-white"})}),h&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center",children:"âœ“"})]})}),e.jsxs(le,{children:[e.jsx("p",{className:"font-medium",children:u.label}),!r&&e.jsx("p",{className:"text-xs text-gray-400",children:m(u.id)})]})]})},u.id):e.jsx(ge,{children:e.jsxs(je,{children:[e.jsx(be,{asChild:!0,children:e.jsxs("button",{onClick:()=>r&&l(u.id),disabled:!r,className:`relative p-4 rounded-xl border-4 transition-all ${h?"border-purple-500 bg-purple-50 shadow-lg scale-105":"border-gray-200 bg-white hover:border-purple-300 hover:bg-purple-50"} ${!r&&"opacity-50 cursor-not-allowed"}`,children:[g?e.jsx("div",{className:"mb-1 flex justify-center",children:e.jsx(De,{type:g,value:u.id,size:48})}):e.jsx("div",{className:"text-3xl mb-1",children:u.emoji}),e.jsx("div",{className:"text-xs font-medium text-gray-600 truncate",children:u.label}),!r&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-700 text-white rounded-full w-6 h-6 flex items-center justify-center",children:e.jsx(xe,{className:"w-3 h-3"})}),h&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-purple-500 text-white rounded-full w-7 h-7 flex items-center justify-center shadow-lg",children:"âœ“"})]})}),e.jsxs(le,{children:[e.jsx("p",{className:"font-medium",children:u.label}),!r&&e.jsx("p",{className:"text-xs text-gray-400",children:m(u.id)})]})]})},u.id)})})]})}function Ja(){var ie,ce,de;const t=Ve(),s=Je(),{user:a,loading:l}=Xe(),[n,i]=d.useState(!1),[c,g]=d.useState(!1),[m,u]=d.useState(""),[r,h]=d.useState({avatar_skin_tone:"medium",avatar_hair_style:"short",avatar_hair_color:"brown",avatar_eyes:"normal",avatar_face:"smile",avatar_shirt:"t_shirt_basic",avatar_pants:"jeans",avatar_shoes:"sneakers",avatar_hat:"none",avatar_glasses:"none",avatar_accessory:"none",avatar_background:"plain",pet_hat:"none",pet_accessory:"none",unlocked_items:["t_shirt_basic","jeans","sneakers","short","long","black","brown","blonde","normal","happy","light","medium","tan","dark","smile","big_smile","plain"],parent_email:""});d.useEffect(()=>{a&&(u(a.full_name||""),h({avatar_skin_tone:a.avatar_skin_tone||"medium",avatar_hair_style:a.avatar_hair_style||"short",avatar_hair_color:a.avatar_hair_color||"brown",avatar_eyes:a.avatar_eyes||"normal",avatar_face:a.avatar_face||"smile",avatar_shirt:a.avatar_shirt||"t_shirt_basic",avatar_pants:a.avatar_pants||"jeans",avatar_shoes:a.avatar_shoes||"sneakers",avatar_hat:a.avatar_hat||"none",avatar_glasses:a.avatar_glasses||"none",avatar_accessory:a.avatar_accessory||"none",avatar_background:a.avatar_background||"plain",pet_hat:a.pet_hat||"none",pet_accessory:a.pet_accessory||"none",unlocked_items:a.unlocked_items||["t_shirt_basic","jeans","sneakers","short","long","black","brown","blonde","normal","happy","light","medium","tan","dark","smile","big_smile","plain"],parent_email:a.parent_email||""}))},[a]);const b=async()=>{if(!a)return;const o=Q(G);await q(Y(o,"users",a.email),{...r,full_name:a.full_name,email:a.email,updatedAt:Date.now()},{merge:!0}),i(!0),setTimeout(()=>i(!1),3e3)},x=pe({mutationFn:async o=>{if(!a)return;const w=Q(G);return await q(Y(w,"users",a.email),{...o},{merge:!0}),o},onSuccess:o=>{h(w=>({...w,...o})),s.invalidateQueries({queryKey:["user",a.email]})}}),y=pe({mutationFn:async()=>{if(!a)return;const o=Q(G);return await q(Y(o,"users",a.email),{subscription_cancels_at:a.subscription_expires_at,subscription_auto_renew:!1},{merge:!0}),!0},onSuccess:()=>{g(!1),s.invalidateQueries({queryKey:["user",a.email]})}}),f=(o,w)=>{h(Z=>({...Z,[o]:w}))},p=o=>a!=null&&a.hasPremiumAccess?!0:(r.unlocked_items||[]).includes(o)||((a==null?void 0:a.purchased_items)||[]).includes(o),N=()=>{const o=v.length,w=v.reduce((C,Fe)=>C+(Fe.stars_earned||0),0),Z=v.some(C=>C.stars_earned===3),Oe=v.some(C=>C.correct_answers/C.total_questions===1),Ie=v.some(C=>C.level==="hard"&&C.stars_earned>=2),_=[];return o>=3&&!p("hoodie")&&_.push({item:"hoodie",reason:"Play 3 games",emoji:"ðŸ‘•"}),o>=5&&!p("curly")&&_.push({item:"curly",reason:"Play 5 games",emoji:"ðŸ¦±"}),o>=7&&!p("baseball_cap")&&_.push({item:"baseball_cap",reason:"Play 7 games",emoji:"ðŸ§¢"}),o>=10&&!p("shorts")&&_.push({item:"shorts",reason:"Play 10 games",emoji:"ðŸ©³"}),o>=15&&!p("boots")&&_.push({item:"boots",reason:"Play 15 games",emoji:"ðŸ¥¾"}),w>=10&&!p("spiky")&&_.push({item:"spiky",reason:"Earn 10 stars",emoji:"âš¡"}),w>=20&&!p("sunglasses")&&_.push({item:"sunglasses",reason:"Earn 20 stars",emoji:"ðŸ˜Ž"}),w>=30&&!p("stars")&&_.push({item:"stars",reason:"Earn 30 stars",emoji:"â­"}),Z&&!p("star")&&_.push({item:"star",reason:"Get 3 stars in one game",emoji:"ðŸ¤©"}),Oe&&!p("heart")&&_.push({item:"heart",reason:"Perfect score",emoji:"ðŸ˜"}),Ie&&!p("crown")&&_.push({item:"crown",reason:"Complete hard level",emoji:"ðŸ‘‘"}),_.slice(0,3)},{data:v=[],isFetching:L}=Ze({queryKey:["userProgress",a==null?void 0:a.email],queryFn:()=>la(a.email),enabled:!!(a!=null&&a.email)}),T=N(),j=a==null?void 0:a.active_pet,S=j?{id:j,name:j.charAt(0).toUpperCase()+j.slice(1),emoji:j==="dragon"?"ðŸ‰":j==="owl"?"ðŸ¦‰":j==="fox"?"ðŸ¦Š":j==="unicorn"?"ðŸ¦„":"ðŸ±",gradient:j==="dragon"?"from-red-400 to-orange-500":j==="owl"?"from-indigo-400 to-purple-500":j==="fox"?"from-orange-400 to-red-500":"from-pink-400 to-purple-500"}:null,D=(a==null?void 0:a.subscription_tier)||"free",Ae=D!=="free",E=a!=null&&a.subscription_expires_at?new Date(a.subscription_expires_at):null,Me=E?Math.ceil((E-new Date)/(1e3*60*60*24)):0;return l?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Loading your avatar..."})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-block mb-4",children:e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-xl",children:e.jsx(ea,{className:"w-10 h-10 text-white"})})}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent",children:"Customize Your Avatar"}),(a==null?void 0:a.hasPremiumAccess)&&((a==null?void 0:a.subscription_tier)==="free"||(a==null?void 0:a.isOnTrial))&&e.jsxs(W,{className:"bg-green-500 text-white",children:["Premium (Trial)",typeof(a==null?void 0:a.trialDaysRemaining)=="number"?` â€¢ ${a.trialDaysRemaining} day${a.trialDaysRemaining===1?"":"s"} left`:""]})]}),e.jsx("p",{className:"text-xl text-gray-600",children:"Express yourself with tons of options!"}),e.jsxs("div",{className:"mt-4 mx-auto max-w-sm",children:[e.jsx(he,{className:"text-sm text-gray-600",children:"Display name"}),e.jsxs("form",{className:"flex gap-2 mt-1",onSubmit:async o=>{o.preventDefault();const w=Q(G);a!=null&&a.email&&(await q(Y(w,"users",a.email),{full_name:m},{merge:!0}),s.invalidateQueries({queryKey:["user",a.email]}),i(!0),setTimeout(()=>i(!1),3e3))},children:[e.jsx(me,{value:m,onChange:o=>u(o.target.value),placeholder:"Your name",maxLength:32,autoComplete:"off"}),e.jsx(k,{variant:"outline",type:"submit",children:"Save"})]})]})]}),n&&e.jsxs(F,{className:"mb-6 bg-green-50 border-green-200",children:[e.jsx(R,{className:"w-4 h-4 text-green-600"}),e.jsx(H,{className:"text-green-800",children:"Avatar saved successfully! ðŸŽ‰"})]}),T.length>0&&e.jsxs(F,{className:"mb-6 bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-300",children:[e.jsx(R,{className:"w-5 h-5 text-yellow-600"}),e.jsx(H,{className:"text-yellow-800",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-lg",children:"ðŸŽ‰ New Items Unlocked!"}),e.jsx("div",{className:"flex gap-3 mt-2",children:T.map((o,w)=>e.jsxs(W,{className:"bg-yellow-500 text-white text-sm",children:[o.emoji," ",o.item.replace(/_/g," ")]},w))})]}),e.jsx(z,{to:$("Shop"),children:e.jsxs(k,{className:"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Browse Shop"]})})]})})]}),Ae&&e.jsx(M,{className:"mb-8 border-4 border-yellow-400 shadow-xl bg-gradient-to-r from-yellow-50 to-orange-50",children:e.jsx(O,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(aa,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:D==="premium_parent"?"Premium Parent":D==="premium_player"?"Premium Player":"Family/Teacher Plan"}),e.jsxs(W,{className:"bg-green-500 text-white",children:[e.jsx(ta,{className:"w-3 h-3 mr-1"}),"Active",(a==null?void 0:a.subscription_tier)==="free"?" (Trial)":""]})]}),e.jsxs("p",{className:"text-gray-600 flex flex-wrap gap-2 items-center",children:[E&&`Renews ${ue(E,"MMM d, yyyy")} â€¢ ${Me} days left`,!E&&(a==null?void 0:a.isOnTrial)&&typeof(a==null?void 0:a.trialDaysRemaining)=="number"&&e.jsxs("span",{className:"text-sm text-yellow-700",children:["Trial: ",a.trialDaysRemaining," day",a.trialDaysRemaining===1?"":"s"," left"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(k,{variant:"outline",className:"h-12",onClick:()=>t($("Subscription")),children:[e.jsx(ma,{className:"w-4 h-4 mr-2"}),"Manage Subscription"]}),(a==null?void 0:a.subscription_auto_renew)!==!1&&e.jsxs(k,{variant:"destructive",onClick:()=>g(!0),className:"h-12",children:[e.jsx(sa,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(M,{className:"sticky top-24 border-4 border-purple-200 shadow-xl",children:[e.jsx(K,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white",children:e.jsxs(V,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Your Avatar"}),e.jsxs(W,{variant:"secondary",className:"bg-white text-purple-600",children:[(((ie=r.unlocked_items)==null?void 0:ie.length)||0)+(((ce=a==null?void 0:a.purchased_items)==null?void 0:ce.length)||0)," Items"]})]})}),e.jsxs(O,{className:"p-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(ia,{avatarData:r,size:"large",showPet:!!j,petData:S})}),j&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-purple-500"}),S.name,"'s Accessories"]}),e.jsx("div",{className:"flex justify-center gap-4",children:e.jsx(da,{pet:S,experience:((de=a==null?void 0:a.pet_experience)==null?void 0:de[j])||0,size:"medium",showAccessories:!0,hatType:r.pet_hat,accessoryType:r.pet_accessory})})]}),e.jsxs(k,{onClick:b,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 h-12 text-lg",disabled:x.isPending,children:[e.jsx(ua,{className:"w-5 h-5 mr-2"}),x.isPending?"Saving...":"Save Avatar"]}),e.jsx(z,{to:$("Shop"),children:e.jsxs(k,{variant:"outline",className:"w-full mt-3 h-12 border-2 border-purple-300 hover:bg-purple-50",children:[e.jsx(ee,{className:"w-5 h-5 mr-2"}),"Get More Items"]})})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(M,{className:"border-2 border-purple-200 shadow-lg",children:[e.jsx(K,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-6 h-6 text-purple-500"}),"Customization Options"]})}),e.jsx(O,{children:e.jsxs(na,{defaultValue:"appearance",className:"w-full",children:[e.jsxs(oa,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(ae,{value:"appearance",children:[e.jsx(fa,{className:"w-4 h-4 mr-1"}),"Face"]}),e.jsxs(ae,{value:"clothing",children:[e.jsx(ha,{className:"w-4 h-4 mr-1"}),"Clothing"]}),e.jsxs(ae,{value:"pet",children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),"Pet"]})]}),e.jsxs(te,{value:"appearance",className:"space-y-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 text-gray-800 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-purple-500"}),"Quick Pick - Adorable Faces!"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[{id:"happy_kid",eyes:"normal",face:"big_smile",label:"ðŸ˜„ Happy"},{id:"playful",eyes:"wink",face:"tongue_out",label:"ðŸ˜œ Playful"},{id:"sweet_smile",eyes:"normal",face:"smile",label:"ðŸ˜Š Sweet"},{id:"excited",eyes:"normal",face:"open_smile",label:"ðŸ˜ƒ Excited"},{id:"sleepy_cute",eyes:"sleepy",face:"smile",label:"ðŸ˜Œ Sleepy"}].map(o=>e.jsx("button",{onClick:()=>{f("avatar_eyes",o.eyes),f("avatar_face",o.face)},className:"relative p-6 rounded-xl border-4 border-purple-200 bg-gradient-to-br from-purple-50 to-pink-50 hover:border-purple-400 hover:shadow-xl transition-all group",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-yellow-100 to-orange-100 flex items-center justify-center mb-2 group-hover:scale-110 transition-transform",children:e.jsx(De,{type:"face",value:o.face,size:56})}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:o.label})]})},o.id))})]}),e.jsx(P,{title:"Skin Tone",options:[{id:"light",label:"Light",color:"#FFE0BD"},{id:"medium",label:"Medium",color:"#F4C89A"},{id:"tan",label:"Tan",color:"#D4A574"},{id:"dark",label:"Dark",color:"#8D5524"}],selected:r.avatar_skin_tone,onChange:o=>f("avatar_skin_tone",o),isUnlocked:()=>!0,type:"color"}),e.jsx(P,{title:"Eyes",options:[{id:"normal",label:"Round",emoji:"ðŸ‘€"},{id:"happy",label:"Happy",emoji:"ðŸ˜Š"},{id:"wink",label:"Wink",emoji:"ï¿½"},{id:"sleepy",label:"Sleepy",emoji:"ðŸ˜´"}],selected:r.avatar_eyes,onChange:o=>f("avatar_eyes",o),isUnlocked:p,previewType:"eyes"}),e.jsx(P,{title:"Face Expression",options:[{id:"smile",label:"Smile",emoji:"ðŸ˜Š"},{id:"big_smile",label:"Big Smile",emoji:"ðŸ˜„"},{id:"grin",label:"Grin",emoji:"ï¿½"},{id:"open_smile",label:"Open Smile",emoji:"ï¿½"},{id:"neutral",label:"Neutral",emoji:"ðŸ˜"},{id:"tongue_out",label:"Playful",emoji:"ðŸ˜›"}],selected:r.avatar_face,onChange:o=>f("avatar_face",o),isUnlocked:p,previewType:"mouth"}),e.jsx(P,{title:"Background",options:[{id:"plain",label:"Plain",emoji:"â¬œ"},{id:"stars",label:"Stars",emoji:"â­"},{id:"rainbow",label:"Rainbow",emoji:"ðŸŒˆ"},{id:"clouds",label:"Clouds",emoji:"â˜ï¸"},{id:"space",label:"Space",emoji:"ðŸš€"},{id:"underwater",label:"Underwater",emoji:"ðŸŒŠ"},{id:"forest",label:"Forest",emoji:"ðŸŒ²"},{id:"city",label:"City",emoji:"ðŸ™ï¸"},{id:"beach",label:"Beach",emoji:"ðŸ–ï¸"}],selected:r.avatar_background,onChange:o=>f("avatar_background",o),isUnlocked:p})]}),e.jsxs(te,{value:"clothing",className:"space-y-6",children:[e.jsx(P,{title:"Shirts & Tops",options:[{id:"t_shirt_basic",label:"Basic Tee",emoji:"ðŸ‘•"},{id:"t_shirt_stripe",label:"Striped Tee",emoji:"ðŸ‘”"},{id:"polo",label:"Polo Shirt",emoji:"ðŸ‘•"},{id:"hoodie",label:"Hoodie",emoji:"ðŸ§¥"},{id:"tank_top",label:"Tank Top",emoji:"ðŸ‘™"},{id:"sweater",label:"Sweater",emoji:"ðŸ§¶"},{id:"jersey",label:"Jersey",emoji:"âš½"},{id:"button_up",label:"Button Up",emoji:"ðŸ‘”"},{id:"graphic_tee",label:"Graphic Tee",emoji:"ðŸŽ¨"}],selected:r.avatar_shirt,onChange:o=>f("avatar_shirt",o),isUnlocked:p}),e.jsx(P,{title:"Pants & Bottoms",options:[{id:"jeans",label:"Jeans",emoji:"ðŸ‘–"},{id:"shorts",label:"Shorts",emoji:"ðŸ©³"},{id:"skirt",label:"Skirt",emoji:"ðŸ‘—"},{id:"dress_pants",label:"Dress Pants",emoji:"ðŸ‘”"},{id:"joggers",label:"Joggers",emoji:"ðŸƒ"},{id:"overalls",label:"Overalls",emoji:"ðŸ‘–"},{id:"leggings",label:"Leggings",emoji:"ðŸ©±"},{id:"cargo_pants",label:"Cargo Pants",emoji:"ðŸŽ’"}],selected:r.avatar_pants,onChange:o=>f("avatar_pants",o),isUnlocked:p})]}),e.jsx(te,{value:"pet",className:"space-y-6",children:j?e.jsxs(e.Fragment,{children:[e.jsxs(F,{className:"bg-purple-50 border-purple-300",children:[e.jsx(R,{className:"w-4 h-4 text-purple-600"}),e.jsxs(H,{className:"text-purple-800",children:[e.jsxs("strong",{children:["Dress up your ",S.name,"!"]})," Customize your pet's look with hats and accessories."]})]}),e.jsx(P,{title:"Pet Hats",options:[{id:"none",label:"None",emoji:"ðŸš«"},{id:"tiny_cap",label:"Tiny Cap",emoji:"ðŸ§¢"},{id:"bow",label:"Bow",emoji:"ðŸŽ€"},{id:"crown",label:"Crown",emoji:"ðŸ‘‘"},{id:"santa_hat",label:"Santa Hat",emoji:"ðŸŽ…"},{id:"party_hat",label:"Party Hat",emoji:"ðŸŽ‰"}],selected:r.pet_hat,onChange:o=>f("pet_hat",o),isUnlocked:p}),e.jsx(P,{title:"Pet Accessories",options:[{id:"none",label:"None",emoji:"ðŸš«"},{id:"collar",label:"Collar",emoji:"ðŸ“¿"},{id:"bow_tie",label:"Bow Tie",emoji:"ðŸŽ€"},{id:"bandana",label:"Bandana",emoji:"ðŸ§£"},{id:"scarf",label:"Scarf",emoji:"ðŸ§£"},{id:"wings",label:"Wings",emoji:"ðŸª½"},{id:"cape",label:"Cape",emoji:"ðŸ¦¸"}],selected:r.pet_accessory,onChange:o=>f("pet_accessory",o),isUnlocked:p})]}):e.jsx(M,{className:"text-center py-12",children:e.jsxs(O,{children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ¾"}),e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"No Pet Yet!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Get a pet from the shop to customize it!"}),e.jsx(z,{to:$("Shop"),children:e.jsxs(k,{className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(ee,{className:"w-5 h-5 mr-2"}),"Visit Shop"]})})]})})})]})})]})})]}),e.jsxs(M,{className:"mt-8 border-2 border-blue-200",children:[e.jsx(K,{className:"bg-blue-50",children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(ra,{className:"w-6 h-6 text-blue-600"}),"Parent/Teacher Access"]})}),e.jsx(O,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Allow a parent or teacher to monitor your progress and help you set learning goals."}),e.jsx(F,{className:"bg-blue-50 border-blue-200",children:e.jsxs(H,{className:"text-sm text-blue-900 space-y-2",children:[e.jsx("p",{className:"font-semibold",children:"How it works"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Enter a parent or teacher's email and tap Save â€” we'll send them an invite."}),e.jsx("li",{children:"They can create/sign in to a free account and link to your profile."}),e.jsx("li",{children:"They can see your stars, recent games, concepts practiced, and goals."}),e.jsx("li",{children:"They cannot change your avatar, play as you, or make purchases."}),e.jsx("li",{children:"You can remove or change the email anytime, or manage access in the Parent Portal."})]}),e.jsx("p",{className:"text-xs text-blue-800",children:"Tip: If the invite doesnâ€™t arrive, ask them to check spam or try again."})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{htmlFor:"parent_email",children:"Parent/Teacher Email"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(me,{id:"parent_email",type:"email",value:r.parent_email||"",onChange:o=>f("parent_email",o.target.value),placeholder:"parent@example.com"}),e.jsx(k,{onClick:()=>x.mutate({parent_email:r.parent_email}),disabled:x.isPending,children:"Save"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[(a==null?void 0:a.parent_email)&&e.jsxs("p",{className:"text-sm text-green-600",children:["âœ“ Linked to: ",a.parent_email]}),e.jsx(z,{to:$("ParentPortal"),className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"Manage in Parent Portal"})]})]})]})})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(M,{className:"max-w-md w-full border-4 border-red-300",children:[e.jsx(K,{className:"bg-red-50",children:e.jsxs(V,{className:"flex items-center gap-2 text-red-700",children:[e.jsx(fe,{className:"w-6 h-6"}),"Cancel Subscription?"]})}),e.jsxs(O,{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-gray-700",children:"Are you sure you want to cancel your subscription?"}),e.jsxs(F,{className:"bg-yellow-50 border-yellow-300",children:[e.jsx(fe,{className:"w-4 h-4 text-yellow-600"}),e.jsxs(H,{className:"text-yellow-800 text-sm",children:["You'll lose access to premium features when your current billing period ends on ",E?ue(E,"MMMM d, yyyy"):"the end date","."]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"outline",className:"flex-1",onClick:()=>g(!1),children:"Keep Subscription"}),e.jsx(k,{variant:"destructive",className:"flex-1",onClick:()=>y.mutate(),disabled:y.isPending,children:y.isPending?"Cancelling...":"Yes, Cancel"})]})]})]})})]})}export{Ja as default};
