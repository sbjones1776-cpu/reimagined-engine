import{c as pe,ak as X,aw as ge,j as e,G as ne,B,z as oe,r as E,u as le,C as _,I as Y,J as Z,a as ye,v as q,d as w,x as z,b as ee,h as N,f as R,s as L,i as he,k as ue,ag as xe,ah as je,ax as ve,n as be,Z as fe,ai as _e,A as W,y as I,p as T,$ as G,K as we}from"./index-C0XnwW1J.js";import{u as V}from"./useMutation-BBbn5Ibo.js";import{T as ae,a as se,b as f,c as M}from"./tabs-CHDP_n8y.js";import Ne from"./PetDisplay-CWJwigaH.js";import{C as K}from"./coins-C3lSgozT.js";import{L as O}from"./lock-C1-5gGAl.js";import{P as ke}from"./PremiumFeatureLock-DOt-wJcj.js";import{P as Se}from"./palette-DxTrdA_5.js";import{Z as Ce}from"./zap-w4f_OL2g.js";import"./progress-D8Mly-oi.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],re=pe("Gift",De);function te(i,n){const o=X(i),r=X(n),u=ie(o,r),C=Math.abs(ge(o,r));o.setDate(o.getDate()-u*C);const D=+(ie(o,r)===-u),k=u*(C-D);return k===0?0:k}function ie(i,n){const o=i.getFullYear()-n.getFullYear()||i.getMonth()-n.getMonth()||i.getDate()-n.getDate()||i.getHours()-n.getHours()||i.getMinutes()-n.getMinutes()||i.getSeconds()-n.getSeconds()||i.getMilliseconds()-n.getMilliseconds();return o<0?-1:o>0?1:o}function Pe({badge:i,size:n="medium"}){if(!i)return null;const o={small:"w-8 h-8 text-lg",medium:"w-12 h-12 text-2xl",large:"w-20 h-20 text-4xl"},r=o[n]||o.medium,u=i.emoji==="ğŸ®";return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:`${r} rounded-full bg-gradient-to-br ${i.gradient} flex items-center justify-center shadow-lg border-2 border-white`,children:u?e.jsx(ne,{size:n==="large"?"md":n==="small"?"xs":"sm",variant:"plain"}):e.jsx("span",{children:i.emoji})}),n!=="small"&&e.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 whitespace-nowrap",children:e.jsx(B,{variant:"outline",className:"text-xs bg-white",children:i.name})})]})}const ce=[{day:1,stars:5,coins:20,emoji:"ğŸ"},{day:2,stars:5,coins:25,emoji:"â­"},{day:3,stars:10,coins:30,emoji:"ğŸ’"},{day:4,stars:10,coins:35,emoji:"ğŸ¯"},{day:5,stars:15,coins:50,emoji:"ğŸ†"},{day:6,stars:15,coins:60,emoji:"ğŸ‘‘"},{day:7,stars:25,coins:100,emoji:"ğŸ‰",special:"Bonus Pet Food!"}];function Be(){const i=oe(),[n,o]=E.useState(!1),{data:r}=le({queryKey:["currentUser"],queryFn:async()=>({email:"user@example.com",coins:0,daily_login_streak:0,total_login_days:0,last_login_date:null,active_pet:null,pet_experience:{}}),initialData:{email:"user@example.com",coins:0,daily_login_streak:0,total_login_days:0,last_login_date:null,active_pet:null,pet_experience:{}}}),u=V({mutationFn:async()=>{var s;const l=R(L(new Date),"yyyy-MM-dd"),p=((r==null?void 0:r.daily_login_streak)||0)+1,y=(p-1)%7+1,P=ce[y-1],v={last_login_date:l,daily_login_streak:p,total_login_days:((r==null?void 0:r.total_login_days)||0)+1,coins:((r==null?void 0:r.coins)||0)+P.coins};if(y===7&&(r!=null&&r.active_pet)){const t=((s=r==null?void 0:r.pet_experience)==null?void 0:s[r.active_pet])||0;v.pet_experience={...(r==null?void 0:r.pet_experience)||{},[r.active_pet]:t+200}}const F=he(ue);await xe(je(F,"users",r.email),v,{merge:!0})},onSuccess:()=>{i.invalidateQueries({queryKey:["currentUser"]}),o(!0),setTimeout(()=>o(!1),3e3)}}),C=()=>{if(!r)return!1;const l=R(L(new Date),"yyyy-MM-dd"),m=r.last_login_date;if(!m)return!0;if(m===l)return!1;let p;try{if(p=new Date(m),isNaN(p.getTime()))return!0}catch{return!0}const y=L(new Date);return te(y,p)===1},D=()=>{if(!(r!=null&&r.last_login_date))return!1;let l;try{if(l=new Date(r.last_login_date),isNaN(l.getTime()))return!1}catch{return!1}const m=L(new Date);return te(m,l)>1},k=()=>r!=null&&r.daily_login_streak?(r.daily_login_streak-1)%7+1:1,A=()=>{if(!(r!=null&&r.last_login_date))return!1;const l=R(L(new Date),"yyyy-MM-dd");let m;try{if(m=new Date(r.last_login_date),isNaN(m.getTime()))return!1}catch{return!1}return r.last_login_date===l},U=(r==null?void 0:r.daily_login_streak)||0,a=k(),H=A(),j=D();return e.jsxs(_,{className:"border-4 border-purple-300 shadow-xl bg-gradient-to-br from-purple-50 to-pink-50",children:[e.jsx(Y,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white",children:e.jsxs(Z,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-6 h-6"}),e.jsx("span",{children:"Daily Login Rewards"})]}),e.jsxs(B,{className:"bg-white text-purple-600 font-bold",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),U," Day Streak"]})]})}),e.jsxs(w,{className:"p-6",children:[n&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border-2 border-green-300 rounded-xl animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-4xl",children:"ğŸ‰"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-green-800",children:"Reward Claimed!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Come back tomorrow for more rewards!"})]})]})}),j&&e.jsx("div",{className:"mb-4 p-4 bg-orange-50 border-2 border-orange-300 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:"ğŸ˜¢"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-orange-800",children:"Streak Reset!"}),e.jsx("p",{className:"text-sm text-orange-700",children:"You missed a day. Start a new streak today!"})]})]})}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-6",children:ce.map((l,m)=>{const p=m+1,y=p===a,P=!j&&U>=p,v=H&&p===a;return e.jsxs("div",{className:`relative p-3 rounded-xl text-center transition-all ${v?"bg-green-100 border-2 border-green-400 scale-105":y&&!H?"bg-purple-100 border-2 border-purple-400 scale-105 animate-pulse":P?"bg-gray-100 border-2 border-gray-300":"bg-white border-2 border-gray-200 opacity-60"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:l.emoji}),e.jsxs("div",{className:"text-xs font-bold mb-1",children:["Day ",p]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs",children:[e.jsx(z,{className:"w-3 h-3 text-yellow-500 fill-yellow-500"}),e.jsx("span",{children:l.stars})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs",children:[e.jsx(K,{className:"w-3 h-3 text-blue-500"}),e.jsx("span",{children:l.coins})]})]}),v&&e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(ee,{className:"w-5 h-5 text-green-500 fill-green-100"})}),!y&&!P&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 rounded-xl",children:e.jsx(O,{className:"w-4 h-4 text-gray-500"})}),l.special&&y&&e.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 whitespace-nowrap",children:e.jsx(B,{className:"bg-orange-500 text-white text-xs",children:l.special})})]},p)})}),e.jsxs("div",{className:"space-y-3",children:[H?e.jsxs("div",{className:"text-center p-4 bg-green-50 border-2 border-green-200 rounded-xl",children:[e.jsx(ee,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsx("p",{className:"font-bold text-green-800",children:"Already claimed today!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Come back tomorrow for more rewards"})]}):j?e.jsxs(N,{onClick:()=>u.mutate(),disabled:u.isPending,className:"w-full h-14 text-lg bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600",children:[e.jsx(re,{className:"w-5 h-5 mr-2"}),"Start New Streak & Claim Day 1"]}):e.jsxs(N,{onClick:()=>u.mutate(),disabled:!C()||u.isPending,className:"w-full h-14 text-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(re,{className:"w-5 h-5 mr-2"}),"Claim Day ",a," Reward"]}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["ğŸ† Total Login Days: ",e.jsx("strong",{children:(r==null?void 0:r.total_login_days)||0})]}),e.jsx("p",{className:"mt-1",children:"ğŸ’¡ Log in every day to keep your streak and earn bigger rewards!"})]})]})]})]})}const de=(i=[])=>i.reduce((n,o)=>n+(o.stars_earned||0),0),Fe=(i=[],n)=>{const o=de(i),r=(n==null?void 0:n.stars_spent)||0;return o-r},J=i=>(i==null?void 0:i.coins)||0,Q={pets:[{id:"dragon",name:"Dragon",emoji:"ğŸ‰",price:50,gradient:"from-red-400 to-orange-500",evolveLevel:5,description:"Breathe fire and soar!",premium:!0},{id:"unicorn",name:"Unicorn",emoji:"ğŸ¦„",price:50,gradient:"from-pink-400 to-purple-500",evolveLevel:5,description:"Magical and sparkly!",premium:!0},{id:"owl",name:"Owl",emoji:"ğŸ¦‰",price:50,gradient:"from-indigo-400 to-purple-500",evolveLevel:5,description:"Wise and clever!"},{id:"fox",name:"Fox",emoji:"ğŸ¦Š",price:50,gradient:"from-orange-400 to-red-500",evolveLevel:5,description:"Cunning and quick!"},{id:"cat",name:"Cat",emoji:"ğŸ±",price:50,gradient:"from-gray-400 to-slate-500",evolveLevel:5,description:"Playful and curious!"},{id:"dog",name:"Dog",emoji:"ğŸ¶",price:50,gradient:"from-yellow-400 to-orange-500",evolveLevel:5,description:"Loyal and friendly!"}],avatarItems:[{id:"curly",name:"Curly Hair",emoji:"ğŸ¦±",price:20,category:"hair",type:"avatar_hair_style"},{id:"spiky",name:"Spiky Hair",emoji:"âš¡",price:20,category:"hair",type:"avatar_hair_style"},{id:"ponytail",name:"Ponytail",emoji:"ğŸ€",price:25,category:"hair",type:"avatar_hair_style"},{id:"braids",name:"Braids",emoji:"ğŸ§µ",price:25,category:"hair",type:"avatar_hair_style"},{id:"afro",name:"Afro",emoji:"ğŸŒ€",price:30,category:"hair",type:"avatar_hair_style"},{id:"mohawk",name:"Mohawk",emoji:"ğŸ”¥",price:30,category:"hair",type:"avatar_hair_style"},{id:"bun",name:"Bun",emoji:"ğŸ”",price:25,category:"hair",type:"avatar_hair_style"},{id:"red",name:"Red Hair",emoji:"â¤ï¸",price:15,category:"hair",type:"avatar_hair_color"},{id:"blue",name:"Blue Hair",emoji:"ğŸ’™",price:15,category:"hair",type:"avatar_hair_color"},{id:"pink",name:"Pink Hair",emoji:"ğŸ’—",price:15,category:"hair",type:"avatar_hair_color"},{id:"purple",name:"Purple Hair",emoji:"ğŸ’œ",price:15,category:"hair",type:"avatar_hair_color"},{id:"green",name:"Green Hair",emoji:"ğŸ’š",price:15,category:"hair",type:"avatar_hair_color"},{id:"orange",name:"Orange Hair",emoji:"ğŸ§¡",price:15,category:"hair",type:"avatar_hair_color"},{id:"white",name:"White Hair",emoji:"ğŸ¤",price:20,category:"hair",type:"avatar_hair_color",premium:!0},{id:"rainbow",name:"Rainbow Hair",emoji:"ğŸŒˆ",price:40,category:"hair",type:"avatar_hair_color",premium:!0},{id:"hoodie",name:"Hoodie",emoji:"ğŸ§¥",price:30,category:"clothing",type:"avatar_shirt"},{id:"tank_top",name:"Tank Top",emoji:"ğŸ‘™",price:25,category:"clothing",type:"avatar_shirt"},{id:"sweater",name:"Sweater",emoji:"ğŸ§¶",price:30,category:"clothing",type:"avatar_shirt"},{id:"jersey",name:"Jersey",emoji:"âš½",price:35,category:"clothing",type:"avatar_shirt"},{id:"button_up",name:"Button Up",emoji:"ğŸ‘”",price:35,category:"clothing",type:"avatar_shirt"},{id:"graphic_tee",name:"Graphic Tee",emoji:"ğŸ¨",price:30,category:"clothing",type:"avatar_shirt"},{id:"t_shirt_stripe",name:"Striped Tee",emoji:"ğŸ‘”",price:25,category:"clothing",type:"avatar_shirt"},{id:"polo",name:"Polo Shirt",emoji:"ğŸ‘•",price:30,category:"clothing",type:"avatar_shirt"},{id:"shorts",name:"Shorts",emoji:"ğŸ©³",price:25,category:"clothing",type:"avatar_pants"},{id:"skirt",name:"Skirt",emoji:"ğŸ‘—",price:25,category:"clothing",type:"avatar_pants"},{id:"dress_pants",name:"Dress Pants",emoji:"ğŸ‘”",price:30,category:"clothing",type:"avatar_pants"},{id:"joggers",name:"Joggers",emoji:"ğŸƒ",price:30,category:"clothing",type:"avatar_pants"},{id:"overalls",name:"Overalls",emoji:"ğŸ‘–",price:35,category:"clothing",type:"avatar_pants"},{id:"leggings",name:"Leggings",emoji:"ğŸ©±",price:25,category:"clothing",type:"avatar_pants"},{id:"cargo_pants",name:"Cargo Pants",emoji:"ğŸ’",price:30,category:"clothing",type:"avatar_pants"},{id:"boots",name:"Boots",emoji:"ğŸ¥¾",price:30,category:"clothing",type:"avatar_shoes"},{id:"sandals",name:"Sandals",emoji:"ğŸ©´",price:20,category:"clothing",type:"avatar_shoes"},{id:"dress_shoes",name:"Dress Shoes",emoji:"ğŸ‘",price:35,category:"clothing",type:"avatar_shoes"},{id:"high_tops",name:"High Tops",emoji:"ğŸ‘Ÿ",price:35,category:"clothing",type:"avatar_shoes"},{id:"cleats",name:"Cleats",emoji:"âš½",price:35,category:"clothing",type:"avatar_shoes"},{id:"slippers",name:"Slippers",emoji:"ğŸ©´",price:20,category:"clothing",type:"avatar_shoes"},{id:"baseball_cap",name:"Baseball Cap",emoji:"ğŸ§¢",price:25,category:"accessories",type:"avatar_hat"},{id:"beanie",name:"Beanie",emoji:"ğŸ©",price:25,category:"accessories",type:"avatar_hat"},{id:"sun_hat",name:"Sun Hat",emoji:"ğŸ‘’",price:25,category:"accessories",type:"avatar_hat"},{id:"wizard_hat",name:"Wizard Hat",emoji:"ğŸ§™",price:40,category:"accessories",type:"avatar_hat"},{id:"party_hat",name:"Party Hat",emoji:"ğŸ‰",price:30,category:"accessories",type:"avatar_hat"},{id:"graduation_cap",name:"Graduation Cap",emoji:"ğŸ“",price:35,category:"accessories",type:"avatar_hat"},{id:"crown",name:"Crown",emoji:"ğŸ‘‘",price:50,category:"accessories",type:"avatar_hat"},{id:"top_hat",name:"Top Hat",emoji:"ğŸ©",price:35,category:"accessories",type:"avatar_hat"},{id:"cowboy_hat",name:"Cowboy Hat",emoji:"ğŸ¤ ",price:30,category:"accessories",type:"avatar_hat"},{id:"regular",name:"Glasses",emoji:"ğŸ‘“",price:25,category:"accessories",type:"avatar_glasses"},{id:"sunglasses",name:"Sunglasses",emoji:"ğŸ˜",price:30,category:"accessories",type:"avatar_glasses"},{id:"reading",name:"Reading Glasses",emoji:"ğŸ¤“",price:25,category:"accessories",type:"avatar_glasses"},{id:"safety_goggles",name:"Safety Goggles",emoji:"ğŸ¥½",price:30,category:"accessories",type:"avatar_glasses"},{id:"3d_glasses",name:"3D Glasses",emoji:"ğŸ•¶ï¸",price:30,category:"accessories",type:"avatar_glasses"},{id:"heart_shaped",name:"Heart Glasses",emoji:"ğŸ˜",price:35,category:"accessories",type:"avatar_glasses"},{id:"star_shaped",name:"Star Glasses",emoji:"ğŸ¤©",price:35,category:"accessories",type:"avatar_glasses"},{id:"backpack",name:"Backpack",emoji:"ğŸ’",price:30,category:"accessories",type:"avatar_accessory"},{id:"cape",name:"Cape",emoji:"ğŸ¦¸",price:40,category:"accessories",type:"avatar_accessory"},{id:"scarf",name:"Scarf",emoji:"ğŸ§£",price:25,category:"accessories",type:"avatar_accessory"},{id:"bow_tie",name:"Bow Tie",emoji:"ğŸ€",price:25,category:"accessories",type:"avatar_accessory"},{id:"necklace",name:"Necklace",emoji:"ğŸ“¿",price:30,category:"accessories",type:"avatar_accessory"},{id:"watch",name:"Watch",emoji:"âŒš",price:35,category:"accessories",type:"avatar_accessory"},{id:"headphones",name:"Headphones",emoji:"ğŸ§",price:35,category:"accessories",type:"avatar_accessory"},{id:"earrings",name:"Earrings",emoji:"ğŸ’",price:30,category:"accessories",type:"avatar_accessory"},{id:"bracelet",name:"Bracelet",emoji:"ğŸ“¿",price:25,category:"accessories",type:"avatar_accessory"},{id:"stars",name:"Starry Background",emoji:"â­",price:40,category:"backgrounds",type:"avatar_background"},{id:"rainbow",name:"Rainbow Background",emoji:"ğŸŒˆ",price:40,category:"backgrounds",type:"avatar_background"},{id:"clouds",name:"Cloudy Background",emoji:"â˜ï¸",price:35,category:"backgrounds",type:"avatar_background"},{id:"space",name:"Space Background",emoji:"ğŸš€",price:45,category:"backgrounds",type:"avatar_background"},{id:"underwater",name:"Underwater Background",emoji:"ğŸŒŠ",price:45,category:"backgrounds",type:"avatar_background"},{id:"forest",name:"Forest Background",emoji:"ğŸŒ²",price:40,category:"backgrounds",type:"avatar_background"},{id:"city",name:"City Background",emoji:"ğŸ™ï¸",price:40,category:"backgrounds",type:"avatar_background"},{id:"beach",name:"Beach Background",emoji:"ğŸ–ï¸",price:40,category:"backgrounds",type:"avatar_background"},{id:"cool",name:"Cool Eyes",emoji:"ğŸ˜",price:20,category:"facial",type:"avatar_eyes"},{id:"star",name:"Star Eyes",emoji:"ğŸ¤©",price:25,category:"facial",type:"avatar_eyes"},{id:"heart",name:"Heart Eyes",emoji:"ğŸ˜",price:25,category:"facial",type:"avatar_eyes"},{id:"sleepy",name:"Sleepy Eyes",emoji:"ğŸ˜´",price:20,category:"facial",type:"avatar_eyes"},{id:"angry",name:"Determined Eyes",emoji:"ğŸ˜ ",price:20,category:"facial",type:"avatar_eyes"},{id:"surprised",name:"Surprised Eyes",emoji:"ğŸ˜²",price:20,category:"facial",type:"avatar_eyes"},{id:"wink",name:"Winking Eyes",emoji:"ğŸ˜‰",price:25,category:"facial",type:"avatar_eyes"},{id:"laughing",name:"Laughing Face",emoji:"ğŸ˜†",price:20,category:"facial",type:"avatar_face"},{id:"determined",name:"Determined Face",emoji:"ğŸ˜¤",price:20,category:"facial",type:"avatar_face"},{id:"neutral",name:"Neutral Face",emoji:"ğŸ˜",price:15,category:"facial",type:"avatar_face"},{id:"tongue_out",name:"Playful Face",emoji:"ğŸ˜›",price:20,category:"facial",type:"avatar_face"}],badges:[{id:"first_game",name:"First Game",emoji:"ğŸ®",gradient:"from-green-400 to-emerald-500",description:"Completed your first game!",requirement:"Play 1 game",isAppIcon:!0},{id:"star_collector",name:"Star Collector",emoji:"â­",gradient:"from-yellow-400 to-orange-500",description:"Earned 50 stars!",requirement:"Earn 50 stars"},{id:"speed_demon",name:"Speed Demon",emoji:"âš¡",gradient:"from-blue-400 to-cyan-500",description:"Complete a game in under 60 seconds",requirement:"Complete game < 60s"},{id:"perfectionist",name:"Perfectionist",emoji:"ğŸ’¯",gradient:"from-pink-400 to-purple-500",description:"Get 100% accuracy",requirement:"100% accuracy"},{id:"daily_warrior",name:"Daily Warrior",emoji:"ğŸ—“ï¸",gradient:"from-red-400 to-orange-500",description:"Complete 7 daily challenges",requirement:"7 daily challenges"}],powerUps:[{id:"time_freeze",name:"Time Freeze",emoji:"â°",price:10,coins:!0,description:"Stop the timer for 10 seconds"},{id:"hint_helper",name:"Hint Helper",emoji:"ğŸ’¡",price:5,coins:!0,description:"Get a hint on a problem"},{id:"skip_question",name:"Skip Question",emoji:"â­ï¸",price:8,coins:!0,description:"Skip one difficult question"},{id:"double_stars",name:"Double Stars",emoji:"â­â­",price:15,coins:!0,description:"Earn 2x stars for next game"}]};function ze(){const i=oe(),[n,o]=E.useState(null),[r,u]=E.useState("pets"),[C,D]=E.useState(!1),[k,A]=E.useState(null),{toast:U}=ve(),{user:a,loading:H}=be(),{user:j}=fe(),{data:l=[]}=le({queryKey:["gameProgress",a==null?void 0:a.email],queryFn:()=>we(a.email),enabled:!!(a!=null&&a.email)}),m=V({mutationFn:async({itemId:s,price:t,type:c,coins:g})=>{if(!(a!=null&&a.email))throw new Error("Not signed in");const x=l.reduce((b,me)=>b+(me.stars_earned||0),0),S=(a==null?void 0:a.stars_spent)||0,$=x-S,d=(a==null?void 0:a.coins)||0;if(g){if(d<t)throw new Error("Not enough coins");const b={...a.power_ups||{}};b[s]=(b[s]||0)+1,await G(a.email,{coins:d-t,power_ups:b});return}if($<t)throw new Error("Not enough stars");if(c==="pet"){const b=new Set((a==null?void 0:a.owned_pets)||[]);b.has(s)||b.add(s),await G(a.email,{stars_spent:S+t,owned_pets:Array.from(b)});return}const h=new Set((a==null?void 0:a.unlocked_items)||[]);h.has(s)||h.add(s),await G(a.email,{stars_spent:S+t,unlocked_items:Array.from(h)})},onMutate:async s=>{await i.cancelQueries({queryKey:["currentUser"]}),await i.cancelQueries({queryKey:["gameProgress",a==null?void 0:a.email]});const t=i.getQueryData(["currentUser"]),c=i.getQueryData(["gameProgress",a==null?void 0:a.email]);if(!t)return{prevUser:t,prevProgress:c};const{itemId:g,price:x,type:S,coins:$}=s,d={...t};if($){d.coins=(d.coins||0)-x,d.coins<0&&(d.coins=0);const h={...d.power_ups||{}};h[g]=(h[g]||0)+1,d.power_ups=h}else if(S==="pet"){d.stars_spent=(d.stars_spent||0)+x;const h=new Set(d.owned_pets||[]);h.add(g),d.owned_pets=Array.from(h)}else{d.stars_spent=(d.stars_spent||0)+x;const h=new Set(d.unlocked_items||[]);h.add(g),d.unlocked_items=Array.from(h)}return i.setQueryData(["currentUser"],d),{prevUser:t,prevProgress:c}},onError:(s,t,c)=>{c!=null&&c.prevUser&&i.setQueryData(["currentUser"],c.prevUser),U({title:"Purchase Failed",description:s.message.includes("Not enough")?s.message:"Could not complete purchase."})},onSuccess:()=>{o(!0),setTimeout(()=>o(!1),2500)},onSettled:()=>{i.invalidateQueries({queryKey:["currentUser"]}),i.invalidateQueries({queryKey:["gameProgress",a==null?void 0:a.email]})}}),p=V({mutationFn:async s=>{if(!(a!=null&&a.email))throw new Error("Not signed in");if(!new Set((a==null?void 0:a.owned_pets)||[]).has(s))throw new Error("Pet not owned");await G(a.email,{active_pet:s})},onMutate:async s=>{await i.cancelQueries({queryKey:["currentUser"]});const t=i.getQueryData(["currentUser"]);if(!t)return{prevUser:t};const c={...t};return new Set(c.owned_pets||[]).has(s)&&(c.active_pet=s,i.setQueryData(["currentUser"],c)),{prevUser:t}},onError:(s,t,c)=>{c!=null&&c.prevUser&&i.setQueryData(["currentUser"],c.prevUser)},onSettled:()=>{i.invalidateQueries({queryKey:["currentUser"]})}}),y=(s,t="avatar",c=!1)=>{m.mutate({itemId:s.id,price:s.price,type:t,coins:c})},P=s=>{p.mutate(s)},v=(s,t="avatar")=>t==="pet"?((a==null?void 0:a.owned_pets)||[]).includes(s):((a==null?void 0:a.unlocked_items)||[]).includes(s)||((a==null?void 0:a.purchased_items)||[]).includes(s),F=()=>Fe(l,a);return H?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Loading shop..."})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[C&&e.jsx(ke,{featureName:(k==null?void 0:k.name)||"Premium Item",description:"This exclusive item is available to premium subscribers. Upgrade to unlock all premium pets, avatar items, and more!",isOpen:C,onClose:()=>{D(!1),A(null)}}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-block mb-4",children:e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-xl",children:e.jsx(_e,{className:"w-10 h-10 text-white"})})}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent",children:"Rewards Shop"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Spend your stars and coins on awesome items!"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-8",children:[e.jsx(_,{className:"border-4 border-yellow-300 bg-gradient-to-r from-yellow-50 to-orange-50",children:e.jsxs(w,{className:"p-6 text-center",children:[e.jsx(z,{className:"w-12 h-12 mx-auto mb-2 text-yellow-500 fill-yellow-500"}),e.jsx("div",{className:"text-4xl font-bold text-yellow-600 mb-1",children:F()}),e.jsx("p",{className:"text-gray-600",children:"Available Stars"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Total: ",de(l)," | Spent: ",(a==null?void 0:a.stars_spent)||0]})]})}),e.jsx(_,{className:"border-4 border-blue-300 bg-gradient-to-r from-blue-50 to-cyan-50",children:e.jsxs(w,{className:"p-6 text-center",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-1",children:J(a)}),e.jsx("p",{className:"text-gray-600",children:"Coins"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For power-ups and boosts"})]})})]}),n&&e.jsxs(W,{className:"mb-6 bg-green-50 border-green-200",children:[e.jsx(q,{className:"w-4 h-4 text-green-600"}),e.jsx(I,{className:"text-green-800",children:"Purchase successful! Item added to your collection ğŸ‰"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(Be,{})}),e.jsx(_,{className:"border-2 border-purple-200",children:e.jsx(w,{className:"p-6",children:e.jsxs(ae,{value:r,onValueChange:u,children:[e.jsxs(se,{className:"grid w-full grid-cols-4 mb-6",children:[e.jsxs(f,{value:"pets",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Pets"]}),e.jsxs(f,{value:"avatar",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Avatar"]}),e.jsxs(f,{value:"badges",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Badges"]}),e.jsxs(f,{value:"powerups",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Power-Ups"]})]}),e.jsx(M,{value:"pets",className:"space-y-6",children:e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Q.pets.map(s=>{var S;const t=v(s.id,"pet"),c=(a==null?void 0:a.active_pet)===s.id,g=F()>=s.price,x=s.premium&&!(j!=null&&j.hasPremiumAccess);return e.jsxs(_,{className:`border-2 ${c?"border-purple-500 ring-2 ring-purple-200":x?"border-purple-300 bg-purple-50":"border-gray-200"}`,children:[e.jsx(Y,{children:e.jsxs(Z,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[s.name,s.premium&&e.jsx(T,{className:"w-4 h-4 inline ml-1 text-purple-500"})]}),c&&e.jsx(B,{className:"bg-purple-500",children:"Active"})]})}),e.jsxs(w,{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(Ne,{pet:s,experience:((S=a==null?void 0:a.pet_experience)==null?void 0:S[s.id])||0,size:"large"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),t?c?e.jsx(N,{disabled:!0,className:"w-full",variant:"outline",children:"Currently Active"}):e.jsx(N,{onClick:()=>P(s.id),className:"w-full bg-purple-500 hover:bg-purple-600",children:"Set as Active"}):x?e.jsxs(N,{onClick:()=>{A(s),D(!0)},variant:"outline",className:"w-full border-purple-400 text-purple-600",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Premium Only"]}):e.jsx(N,{onClick:()=>y(s,"pet"),disabled:!g||m.isPending,className:`w-full ${g?"bg-gradient-to-r from-purple-500 to-pink-500":""}`,children:g?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-2 fill-white"}),"Buy for ",s.price," Stars"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Need ",s.price-F()," more stars"]})})]})]},s.id)})})}),e.jsx(M,{value:"avatar",className:"space-y-6",children:e.jsxs(ae,{defaultValue:"hair",children:[e.jsxs(se,{className:"grid w-full grid-cols-5",children:[e.jsx(f,{value:"hair",children:"Hair"}),e.jsx(f,{value:"clothing",children:"Clothing"}),e.jsx(f,{value:"accessories",children:"Accessories"}),e.jsx(f,{value:"backgrounds",children:"Backgrounds"}),e.jsx(f,{value:"facial",children:"Facial"})]}),["hair","clothing","accessories","backgrounds","facial"].map(s=>e.jsx(M,{value:s,children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Q.avatarItems.filter(t=>t.category===s).map(t=>{const c=v(t.id),g=F()>=t.price,x=t.premium&&!(j!=null&&j.hasPremiumAccess);return e.jsx(_,{className:`border-2 ${c?"border-green-300 bg-green-50":x?"border-purple-300 bg-purple-50":"border-gray-200"}`,children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:t.emoji}),e.jsxs("h3",{className:"font-bold text-sm mb-2",children:[t.name,t.premium&&e.jsx(T,{className:"w-3 h-3 inline ml-1 text-purple-500"})]}),c?e.jsx(B,{className:"bg-green-500 text-white",children:"Owned"}):x?e.jsxs(N,{onClick:()=>{A(t),D(!0)},size:"sm",variant:"outline",className:"w-full border-purple-400 text-purple-600",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"Premium"]}):e.jsx(N,{onClick:()=>y(t),disabled:!g||m.isPending,size:"sm",className:`w-full ${g?"bg-gradient-to-r from-purple-500 to-pink-500":""}`,children:g?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-3 h-3 mr-1 fill-white"}),t.price]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),t.price]})})]})},t.id)})})},s))]})}),e.jsxs(M,{value:"badges",className:"space-y-6",children:[e.jsxs(W,{className:"bg-blue-50 border-blue-300",children:[e.jsx(q,{className:"w-4 h-4 text-blue-600"}),e.jsx(I,{className:"text-blue-800",children:"Badges are earned by completing specific achievements. Keep playing to unlock them all!"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Q.badges.map(s=>e.jsx(_,{className:"border-2 border-gray-200",children:e.jsxs(w,{className:"p-6 text-center",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(Pe,{badge:s,size:"large"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),e.jsx(B,{variant:"outline",className:"text-xs",children:s.requirement})]})},s.id))})]}),e.jsxs(M,{value:"powerups",className:"space-y-6",children:[e.jsxs(W,{className:"bg-cyan-50 border-cyan-300",children:[e.jsx(K,{className:"w-4 h-4 text-cyan-600"}),e.jsx(I,{className:"text-cyan-800",children:"Power-ups are purchased with coins and can be used during games to help you succeed!"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:Q.powerUps.map(s=>{const t=J(a)>=s.price,c=((a==null?void 0:a.power_ups)||{})[s.id]||0;return e.jsx(_,{className:"border-2 border-cyan-200",children:e.jsxs(w,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-5xl mb-3",children:s.emoji}),e.jsx("h3",{className:"font-bold mb-2",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:s.description}),c>0&&e.jsxs(B,{className:"bg-green-500 text-white mb-2",children:["Owned: ",c]}),e.jsx(N,{onClick:()=>y(s,"powerup",!0),disabled:!t||m.isPending,size:"sm",className:`w-full ${t?"bg-gradient-to-r from-cyan-500 to-blue-500":""}`,children:t?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Buy for ",s.price]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Need ",s.price-J(a)," coins"]})})]})},s.id)})})]})]})})}),e.jsxs(_,{className:"mt-8 bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-purple-200",children:[e.jsx(Y,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-6 h-6 text-purple-600"}),"How to Earn More"]})}),e.jsxs(w,{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx(ne,{size:"sm",variant:"circle"})}),e.jsx("h3",{className:"font-bold mb-1",children:"Play Games"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Earn up to 3 stars per game"})]}),e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ“…"}),e.jsx("h3",{className:"font-bold mb-1",children:"Daily Challenges"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Get bonus rewards every day"})]}),e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ†"}),e.jsx("h3",{className:"font-bold mb-1",children:"Achievements"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Unlock items by achieving goals"})]})]})]})]})}export{ze as default};
