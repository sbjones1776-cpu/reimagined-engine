import{T as Be,Y as He,_ as Ie,E as d,d as We,x as e,a7 as ze,i as Q,a8 as me,t as T,H as U,I as Y,a9 as X,aa as q,m as O,p as E,o as B,k as G,y as H,ab as te,X as $,e as L,z as Qe,D as Ue,W as ue,a3 as Ye,q as K,J,l as ye,j as Xe,ac as qe,ad as ve,ae as Ge,af as Ke,ag as Je,ah as we,ai as Ve,aj as Ze,ak as R,F as ea,al as _e,am as aa,an as sa,ao as ta,ap as ra,Q as la}from"./index-D8KcSHts.js";import{$ as pe}from"./useMutation-BBbn5Ibo-BJFBDAw4-Dv4aGJVX.js";import{N as he}from"./label-BaWOfaZ4-D2bnlHOe-C3ZiZWl7.js";import{X as ia,H as na,L as re,O as le}from"./tabs-CHDP_n8y-n--N7dEs-DHG4L-Nj.js";import oa from"./AvatarDisplay-Bq8KvINC-Bkjcf5GX-CYSbrbbG.js";import{s as ca}from"./index-BwFEnwcg-BH8kZdV1-7yxjqrzn.js";import{o as xe}from"./lock-C1-5gGAl-B47CgZWV-D6DQBFTb.js";import da from"./PetDisplay-CWJwigaH-Dn1kB1rT-DC_LFbLk.js";import{y as ma}from"./credit-card-6uWoetCu-Drjw4SxZ-C4TAGbnZ.js";import{o as ua}from"./save-_1Dbls43-gPqzGvW6-BzKl92VA.js";import{e as fe}from"./triangle-alert-Dd6OicLx-I3IE0NwH-CK_H4sCV.js";import"./progress-D8Mly-oi-3Ij_j_WH-Cj7a_al8.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],ha=ye("Shirt",pa);/**
* @license lucide-react v0.475.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const xa=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],fa=ye("Smile",xa);var ga=Symbol("radix.slottable");function ja(t){const r=({children:s})=>e.jsx(e.Fragment,{children:s});return r.displayName=`${t}.Slottable`,r.__radixId=ga,r}var[V]=qe("Tooltip",[ve]),Z=ve(),Ne="TooltipProvider",ba=700,ie="tooltip.open",[ya,ce]=V(Ne),ke=t=>{const{__scopeTooltip:r,delayDuration:s=ba,skipDelayDuration:l=300,disableHoverableContent:i=!1,children:a}=t,o=d.useRef(!0),g=d.useRef(!1),m=d.useRef(0);return d.useEffect(()=>{const u=m.current;return()=>window.clearTimeout(u)},[]),e.jsx(ya,{scope:r,isOpenDelayedRef:o,delayDuration:s,onOpen:d.useCallback(()=>{window.clearTimeout(m.current),o.current=!1},[]),onClose:d.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>o.current=!0,l)},[l]),isPointerInTransitRef:g,onPointerInTransitChange:d.useCallback(u=>{g.current=u},[]),disableHoverableContent:i,children:a})};ke.displayName=Ne;var I="Tooltip",[va,W]=V(I),Ce=t=>{const{__scopeTooltip:r,children:s,open:l,defaultOpen:i,onOpenChange:a,disableHoverableContent:o,delayDuration:g}=t,m=ce(I,t.__scopeTooltip),u=Z(r),[c,h]=d.useState(null),j=Ge(),p=d.useRef(0),b=o??m.disableHoverableContent,w=g??m.delayDuration,y=d.useRef(!1),[N,f]=Ke({prop:l,defaultProp:i??!1,onChange:F=>{F?(m.onOpen(),document.dispatchEvent(new CustomEvent(ie))):m.onClose(),a==null||a(F)},caller:I}),x=d.useMemo(()=>N?y.current?"delayed-open":"instant-open":"closed",[N]),D=d.useCallback(()=>{window.clearTimeout(p.current),p.current=0,y.current=!1,f(!0)},[f]),C=d.useCallback(()=>{window.clearTimeout(p.current),p.current=0,f(!1)},[f]),ee=d.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{y.current=!0,f(!0),p.current=0},w)},[w,f]);return d.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),e.jsx(Je,{...u,children:e.jsx(va,{scope:r,contentId:j,open:N,stateAttribute:x,trigger:c,onTriggerChange:h,onTriggerEnter:d.useCallback(()=>{m.isOpenDelayedRef.current?ee():D()},[m.isOpenDelayedRef,ee,D]),onTriggerLeave:d.useCallback(()=>{b?C():(window.clearTimeout(p.current),p.current=0)},[C,b]),onOpen:D,onClose:C,disableHoverableContent:b,children:s})})};Ce.displayName=I;var ne="TooltipTrigger",Te=d.forwardRef((t,r)=>{const{__scopeTooltip:s,...l}=t,i=W(ne,s),a=ce(ne,s),o=Z(s),g=d.useRef(null),m=we(r,g,i.onTriggerChange),u=d.useRef(!1),c=d.useRef(!1),h=d.useCallback(()=>u.current=!1,[]);return d.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),e.jsx(Ve,{asChild:!0,...o,children:e.jsx(Ze.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...l,ref:m,onPointerMove:R(t.onPointerMove,j=>{j.pointerType!=="touch"&&!c.current&&!a.isPointerInTransitRef.current&&(i.onTriggerEnter(),c.current=!0)}),onPointerLeave:R(t.onPointerLeave,()=>{i.onTriggerLeave(),c.current=!1}),onPointerDown:R(t.onPointerDown,()=>{i.open&&i.onClose(),u.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:R(t.onFocus,()=>{u.current||i.onOpen()}),onBlur:R(t.onBlur,i.onClose),onClick:R(t.onClick,i.onClose)})})});Te.displayName=ne;var de="TooltipPortal",[wa,_a]=V(de,{forceMount:void 0}),Pe=t=>{const{__scopeTooltip:r,forceMount:s,children:l,container:i}=t,a=W(de,r);return e.jsx(wa,{scope:r,forceMount:s,children:e.jsx(_e,{present:s||a.open,children:e.jsx(aa,{asChild:!0,container:i,children:l})})})};Pe.displayName=de;var A="TooltipContent",Se=d.forwardRef((t,r)=>{const s=_a(A,t.__scopeTooltip),{forceMount:l=s.forceMount,side:i="top",...a}=t,o=W(A,t.__scopeTooltip);return e.jsx(_e,{present:l||o.open,children:o.disableHoverableContent?e.jsx(De,{side:i,...a,ref:r}):e.jsx(Na,{side:i,...a,ref:r})})}),Na=d.forwardRef((t,r)=>{const s=W(A,t.__scopeTooltip),l=ce(A,t.__scopeTooltip),i=d.useRef(null),a=we(r,i),[o,g]=d.useState(null),{trigger:m,onClose:u}=s,c=i.current,{onPointerInTransitChange:h}=l,j=d.useCallback(()=>{g(null),h(!1)},[h]),p=d.useCallback((b,w)=>{const y=b.currentTarget,N={x:b.clientX,y:b.clientY},f=Sa(N,y.getBoundingClientRect()),x=Da(N,f),D=Ma(w.getBoundingClientRect()),C=$a([...x,...D]);g(C),h(!0)},[h]);return d.useEffect(()=>()=>j(),[j]),d.useEffect(()=>{if(m&&c){const b=y=>p(y,c),w=y=>p(y,m);return m.addEventListener("pointerleave",b),c.addEventListener("pointerleave",w),()=>{m.removeEventListener("pointerleave",b),c.removeEventListener("pointerleave",w)}}},[m,c,p,j]),d.useEffect(()=>{if(o){const b=w=>{const y=w.target,N={x:w.clientX,y:w.clientY},f=(m==null?void 0:m.contains(y))||(c==null?void 0:c.contains(y)),x=!Ea(N,o);f?j():x&&(j(),u())};return document.addEventListener("pointermove",b),()=>document.removeEventListener("pointermove",b)}},[m,c,o,u,j]),e.jsx(De,{...t,ref:a})}),[ka,Ca]=V(I,{isInside:!1}),Ta=ja("TooltipContent"),De=d.forwardRef((t,r)=>{const{__scopeTooltip:s,children:l,"aria-label":i,onEscapeKeyDown:a,onPointerDownOutside:o,...g}=t,m=W(A,s),u=Z(s),{onClose:c}=m;return d.useEffect(()=>(document.addEventListener(ie,c),()=>document.removeEventListener(ie,c)),[c]),d.useEffect(()=>{if(m.trigger){const h=j=>{const p=j.target;p!=null&&p.contains(m.trigger)&&c()};return window.addEventListener("scroll",h,{capture:!0}),()=>window.removeEventListener("scroll",h,{capture:!0})}},[m.trigger,c]),e.jsx(sa,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:a,onPointerDownOutside:o,onFocusOutside:h=>h.preventDefault(),onDismiss:c,children:e.jsxs(ta,{"data-state":m.stateAttribute,...u,...g,ref:r,style:{...g.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(Ta,{children:l}),e.jsx(ka,{scope:s,isInside:!0,children:e.jsx(ca,{id:m.contentId,role:"tooltip",children:i||l})})]})})});Se.displayName=A;var Me="TooltipArrow",Pa=d.forwardRef((t,r)=>{const{__scopeTooltip:s,...l}=t,i=Z(s);return Ca(Me,s).isInside?null:e.jsx(ra,{...i,...l,ref:r})});Pa.displayName=Me;function Sa(t,r){const s=Math.abs(r.top-t.y),l=Math.abs(r.bottom-t.y),i=Math.abs(r.right-t.x),a=Math.abs(r.left-t.x);switch(Math.min(s,l,i,a)){case a:return"left";case i:return"right";case s:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function Da(t,r,s=5){const l=[];switch(r){case"top":l.push({x:t.x-s,y:t.y+s},{x:t.x+s,y:t.y+s});break;case"bottom":l.push({x:t.x-s,y:t.y-s},{x:t.x+s,y:t.y-s});break;case"left":l.push({x:t.x+s,y:t.y-s},{x:t.x+s,y:t.y+s});break;case"right":l.push({x:t.x-s,y:t.y-s},{x:t.x-s,y:t.y+s});break}return l}function Ma(t){const{top:r,right:s,bottom:l,left:i}=t;return[{x:i,y:r},{x:s,y:r},{x:s,y:l},{x:i,y:l}]}function Ea(t,r){const{x:s,y:l}=t;let i=!1;for(let a=0,o=r.length-1;a<r.length;o=a++){const g=r[a],m=r[o],u=g.x,c=g.y,h=m.x,j=m.y;c>l!=j>l&&s<(h-u)*(l-c)/(j-c)+u&&(i=!i)}return i}function $a(t){const r=t.slice();return r.sort((s,l)=>s.x<l.x?-1:s.x>l.x?1:s.y<l.y?-1:s.y>l.y?1:0),La(r)}function La(t){if(t.length<=1)return t.slice();const r=[];for(let l=0;l<t.length;l++){const i=t[l];for(;r.length>=2;){const a=r[r.length-1],o=r[r.length-2];if((a.x-o.x)*(i.y-o.y)>=(a.y-o.y)*(i.x-o.x))r.pop();else break}r.push(i)}r.pop();const s=[];for(let l=t.length-1;l>=0;l--){const i=t[l];for(;s.length>=2;){const a=s[s.length-1],o=s[s.length-2];if((a.x-o.x)*(i.y-o.y)>=(a.y-o.y)*(i.x-o.x))s.pop();else break}s.push(i)}return s.pop(),r.length===1&&s.length===1&&r[0].x===s[0].x&&r[0].y===s[0].y?r:r.concat(s)}var Ra=ke,Aa=Ce,Fa=Te,Oa=Pe,Ee=Se;const ge=Ra,je=Aa,be=Fa,oe=d.forwardRef(({className:t,sideOffset:r=4,...s},l)=>e.jsx(Oa,{children:e.jsx(Ee,{ref:l,sideOffset:r,className:ea("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s})}));oe.displayName=Ee.displayName;function $e({type:t,value:r,size:s=32}){const l=a=>{const o=s/64;return a==="wink"?e.jsxs("g",{transform:`scale(${o})`,children:[e.jsx("circle",{cx:"20",cy:"24",r:"7",fill:"#111827"}),e.jsx("circle",{cx:"20",cy:"23",r:"3",fill:"#ffffff"}),e.jsx("circle",{cx:"21",cy:"22",r:"1.5",fill:"#ffffff",opacity:"0.6"}),e.jsx("path",{d:"M38 24 Q 44 24 50 24",stroke:"#111827",strokeWidth:"3",strokeLinecap:"round"})]}):a==="sleepy"?e.jsxs("g",{transform:`scale(${o})`,children:[e.jsx("path",{d:"M14 24 Q 20 30 26 24",stroke:"#111827",strokeWidth:"3",strokeLinecap:"round",fill:"none"}),e.jsx("path",{d:"M38 24 Q 44 30 50 24",stroke:"#111827",strokeWidth:"3",strokeLinecap:"round",fill:"none"})]}):e.jsxs("g",{transform:`scale(${o})`,children:[e.jsx("circle",{cx:"20",cy:"24",r:"7",fill:"#111827"}),e.jsx("circle",{cx:"20",cy:"23",r:"3",fill:"#ffffff"}),e.jsx("circle",{cx:"21",cy:"22",r:"1.5",fill:"#ffffff",opacity:"0.6"}),e.jsx("circle",{cx:"44",cy:"24",r:"7",fill:"#111827"}),e.jsx("circle",{cx:"44",cy:"23",r:"3",fill:"#ffffff"}),e.jsx("circle",{cx:"45",cy:"22",r:"1.5",fill:"#ffffff",opacity:"0.6"})]})},i=a=>{const o=s/64;return a==="big_smile"?e.jsxs("g",{transform:`scale(${o})`,children:[e.jsx("path",{d:"M18 42 Q 32 56 46 42",stroke:"#111827",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),e.jsx("path",{d:"M22 42 Q 32 52 42 42",stroke:"#ef4444",strokeWidth:"2.5",fill:"none",strokeLinecap:"round"})]}):a==="open_smile"?e.jsx("g",{transform:`scale(${o})`,children:e.jsx("path",{d:"M20 40 Q 32 56 44 40 Q 32 48 20 40 Z",fill:"#ef4444",stroke:"#111827",strokeWidth:"2.5"})}):a==="grin"?e.jsxs("g",{transform:`scale(${o})`,children:[e.jsx("path",{d:"M18 44 Q 32 52 46 44",stroke:"#111827",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),e.jsx("path",{d:"M28 44 L 28 47",stroke:"#111827",strokeWidth:"1.5"}),e.jsx("path",{d:"M36 44 L 36 47",stroke:"#111827",strokeWidth:"1.5"})]}):a==="tongue_out"?e.jsxs("g",{transform:`scale(${o})`,children:[e.jsx("path",{d:"M20 42 Q 32 50 44 42",stroke:"#111827",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),e.jsx("path",{d:"M28 42 Q 32 52 36 42",fill:"#f87171",stroke:"#111827",strokeWidth:"1.5"})]}):a==="neutral"?e.jsx("g",{transform:`scale(${o})`,children:e.jsx("path",{d:"M22 44 L 42 44",stroke:"#111827",strokeWidth:"3",strokeLinecap:"round"})}):e.jsx("g",{transform:`scale(${o})`,children:e.jsx("path",{d:"M20 42 Q 32 50 44 42",stroke:"#111827",strokeWidth:"3",fill:"none",strokeLinecap:"round"})})};return e.jsxs("svg",{width:s,height:s,viewBox:`0 0 ${s} ${s}`,className:"inline-block",children:[e.jsx("circle",{cx:s/2,cy:s/2,r:s/2-1,fill:"#FFE0BD",stroke:"#e5e7eb",strokeWidth:"1"}),t==="eyes"?l(r):null,t==="mouth"?i(r):null,t==="face"?e.jsxs(e.Fragment,{children:[l("normal"),i(r)]}):null]})}function S({title:t,options:r,selected:s,onChange:l,isUnlocked:i,unlockableItems:a=[],type:o="default",previewType:g=null}){const m=u=>{const c=a.find(h=>h.id===u);return(c==null?void 0:c.requirement)||"Complete challenges to unlock"};return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800",children:t}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:r.map(u=>{const c=i(u.id),h=s===u.id;return o==="color"?e.jsx(ge,{children:e.jsxs(je,{children:[e.jsx(be,{asChild:!0,children:e.jsxs("button",{onClick:()=>c&&l(u.id),disabled:!c,className:`relative h-16 rounded-xl border-4 transition-all ${h?"border-purple-500 shadow-lg scale-110":"border-gray-200 hover:border-purple-300"} ${!c&&"opacity-50 cursor-not-allowed"}`,style:{backgroundColor:u.color},children:[!c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 rounded-lg",children:e.jsx(xe,{className:"w-6 h-6 text-white"})}),h&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center",children:"âœ“"})]})}),e.jsxs(oe,{children:[e.jsx("p",{className:"font-medium",children:u.label}),!c&&e.jsx("p",{className:"text-xs text-gray-400",children:m(u.id)})]})]})},u.id):e.jsx(ge,{children:e.jsxs(je,{children:[e.jsx(be,{asChild:!0,children:e.jsxs("button",{onClick:()=>c&&l(u.id),disabled:!c,className:`relative p-4 rounded-xl border-4 transition-all ${h?"border-purple-500 bg-purple-50 shadow-lg scale-105":"border-gray-200 bg-white hover:border-purple-300 hover:bg-purple-50"} ${!c&&"opacity-50 cursor-not-allowed"}`,children:[g?e.jsx("div",{className:"mb-1 flex justify-center",children:e.jsx($e,{type:g,value:u.id,size:48})}):e.jsx("div",{className:"text-3xl mb-1",children:u.emoji}),e.jsx("div",{className:"text-xs font-medium text-gray-600 truncate",children:u.label}),!c&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-700 text-white rounded-full w-6 h-6 flex items-center justify-center",children:e.jsx(xe,{className:"w-3 h-3"})}),h&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-purple-500 text-white rounded-full w-7 h-7 flex items-center justify-center shadow-lg",children:"âœ“"})]})}),e.jsxs(oe,{children:[e.jsx("p",{className:"font-medium",children:u.label}),!c&&e.jsx("p",{className:"text-xs text-gray-400",children:m(u.id)})]})]})},u.id)})})]})}function Ja(){var t,r,s;const l=Be(),i=He(),{user:a,loading:o}=Ie(),[g,m]=d.useState(!1),[u,c]=d.useState(!1),[h,j]=d.useState(""),[p,b]=d.useState({avatar_skin_tone:"medium",avatar_hair_style:"short",avatar_hair_color:"brown",avatar_eyes:"normal",avatar_face:"smile",avatar_shirt:"t_shirt_basic",avatar_pants:"jeans",avatar_shoes:"sneakers",avatar_hat:"none",avatar_glasses:"none",avatar_accessory:"none",avatar_background:"plain",pet_hat:"none",pet_accessory:"none",unlocked_items:["t_shirt_basic","jeans","sneakers","short","long","black","brown","blonde","normal","happy","light","medium","tan","dark","smile","big_smile","plain"],parent_email:""});d.useEffect(()=>{a&&(j(a.full_name||""),b({avatar_skin_tone:a.avatar_skin_tone||"medium",avatar_hair_style:a.avatar_hair_style||"short",avatar_hair_color:a.avatar_hair_color||"brown",avatar_eyes:a.avatar_eyes||"normal",avatar_face:a.avatar_face||"smile",avatar_shirt:a.avatar_shirt||"t_shirt_basic",avatar_pants:a.avatar_pants||"jeans",avatar_shoes:a.avatar_shoes||"sneakers",avatar_hat:a.avatar_hat||"none",avatar_glasses:a.avatar_glasses||"none",avatar_accessory:a.avatar_accessory||"none",avatar_background:a.avatar_background||"plain",pet_hat:a.pet_hat||"none",pet_accessory:a.pet_accessory||"none",unlocked_items:a.unlocked_items||["t_shirt_basic","jeans","sneakers","short","long","black","brown","blonde","normal","happy","light","medium","tan","dark","smile","big_smile","plain"],parent_email:a.parent_email||""}))},[a]);const w=async()=>{if(!a)return;const n=U(Y);await X(q(n,"users",a.email),{...p,full_name:a.full_name,email:a.email,updatedAt:Date.now()},{merge:!0}),m(!0),setTimeout(()=>m(!1),3e3)},y=pe({mutationFn:async n=>{if(!a)return;const _=U(Y);return await X(q(_,"users",a.email),{...n},{merge:!0}),n},onSuccess:n=>{b(_=>({..._,...n})),i.invalidateQueries({queryKey:["user",a.email]})}}),N=pe({mutationFn:async()=>{if(!a)return;const n=U(Y);return await X(q(n,"users",a.email),{subscription_cancels_at:a.subscription_expires_at,subscription_auto_renew:!1},{merge:!0}),!0},onSuccess:()=>{c(!1),i.invalidateQueries({queryKey:["user",a.email]})}}),f=(n,_)=>{b(se=>({...se,[n]:_}))},x=n=>a!=null&&a.hasPremiumAccess?!0:(p.unlocked_items||[]).includes(n)||((a==null?void 0:a.purchased_items)||[]).includes(n),D=()=>{const n=C.length,_=C.reduce((P,Oe)=>P+(Oe.stars_earned||0),0),se=C.some(P=>P.stars_earned===3),Ae=C.some(P=>P.correct_answers/P.total_questions===1),Fe=C.some(P=>P.level==="hard"&&P.stars_earned>=2),k=[];return n>=3&&!x("hoodie")&&k.push({item:"hoodie",reason:"Play 3 games",emoji:"ðŸ‘•"}),n>=5&&!x("curly")&&k.push({item:"curly",reason:"Play 5 games",emoji:"ðŸ¦±"}),n>=7&&!x("baseball_cap")&&k.push({item:"baseball_cap",reason:"Play 7 games",emoji:"ðŸ§¢"}),n>=10&&!x("shorts")&&k.push({item:"shorts",reason:"Play 10 games",emoji:"ðŸ©³"}),n>=15&&!x("boots")&&k.push({item:"boots",reason:"Play 15 games",emoji:"ðŸ¥¾"}),_>=10&&!x("spiky")&&k.push({item:"spiky",reason:"Earn 10 stars",emoji:"âš¡"}),_>=20&&!x("sunglasses")&&k.push({item:"sunglasses",reason:"Earn 20 stars",emoji:"ðŸ˜Ž"}),_>=30&&!x("stars")&&k.push({item:"stars",reason:"Earn 30 stars",emoji:"â­"}),se&&!x("star")&&k.push({item:"star",reason:"Get 3 stars in one game",emoji:"ðŸ¤©"}),Ae&&!x("heart")&&k.push({item:"heart",reason:"Perfect score",emoji:"ðŸ˜"}),Fe&&!x("crown")&&k.push({item:"crown",reason:"Complete hard level",emoji:"ðŸ‘‘"}),k.slice(0,3)},{data:C=[],isFetching:ee}=We({queryKey:["userProgress",a==null?void 0:a.email],queryFn:()=>la(a.email),enabled:!!(a!=null&&a.email)}),F=D(),v=a==null?void 0:a.active_pet,z=v?{id:v,name:v.charAt(0).toUpperCase()+v.slice(1),emoji:v==="dragon"?"ðŸ‰":v==="owl"?"ðŸ¦‰":v==="fox"?"ðŸ¦Š":v==="unicorn"?"ðŸ¦„":"ðŸ±",gradient:v==="dragon"?"from-red-400 to-orange-500":v==="owl"?"from-indigo-400 to-purple-500":v==="fox"?"from-orange-400 to-red-500":"from-pink-400 to-purple-500"}:null,ae=(a==null?void 0:a.subscription_tier)||"free",Le=ae!=="free",M=a!=null&&a.subscription_expires_at?new Date(a.subscription_expires_at):null,Re=M?Math.ceil((M-new Date)/(1e3*60*60*24)):0;return o?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Loading your avatar..."})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-block mb-4",children:e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-xl",children:e.jsx(ze,{className:"w-10 h-10 text-white"})})}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent",children:"Customize Your Avatar"}),(a==null?void 0:a.hasPremiumAccess)&&((a==null?void 0:a.subscription_tier)==="free"||(a==null?void 0:a.isOnTrial))&&e.jsxs(Q,{className:"bg-green-500 text-white",children:["Premium (Trial)",typeof(a==null?void 0:a.trialDaysRemaining)=="number"?` â€¢ ${a.trialDaysRemaining} day${a.trialDaysRemaining===1?"":"s"} left`:""]})]}),e.jsx("p",{className:"text-xl text-gray-600",children:"Express yourself with tons of options!"}),e.jsxs("div",{className:"mt-4 mx-auto max-w-sm",children:[e.jsx(he,{className:"text-sm text-gray-600",children:"Display name"}),e.jsxs("form",{className:"flex gap-2 mt-1",onSubmit:async n=>{n.preventDefault();const _=U(Y);a!=null&&a.email&&(await X(q(_,"users",a.email),{full_name:h},{merge:!0}),i.invalidateQueries({queryKey:["user",a.email]}),m(!0),setTimeout(()=>m(!1),3e3))},children:[e.jsx(me,{value:h,onChange:n=>j(n.target.value),placeholder:"Your name",maxLength:32,autoComplete:"off"}),e.jsx(T,{variant:"outline",type:"submit",children:"Save"})]})]})]}),g&&e.jsxs(O,{className:"mb-6 bg-green-50 border-green-200",children:[e.jsx(E,{className:"w-4 h-4 text-green-600"}),e.jsx(B,{className:"text-green-800",children:"Avatar saved successfully! ðŸŽ‰"})]}),F.length>0&&e.jsxs(O,{className:"mb-6 bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-300",children:[e.jsx(E,{className:"w-5 h-5 text-yellow-600"}),e.jsx(B,{className:"text-yellow-800",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-lg",children:"ðŸŽ‰ New Items Unlocked!"}),e.jsx("div",{className:"flex gap-3 mt-2",children:F.map((n,_)=>e.jsxs(Q,{className:"bg-yellow-500 text-white text-sm",children:[n.emoji," ",n.item.replace(/_/g," ")]},_))})]}),e.jsx(G,{to:H("Shop"),children:e.jsxs(T,{className:"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Browse Shop"]})})]})})]}),Le&&e.jsx($,{className:"mb-8 border-4 border-yellow-400 shadow-xl bg-gradient-to-r from-yellow-50 to-orange-50",children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Qe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:ae==="premium_parent"?"Premium Parent":ae==="premium_player"?"Premium Player":"Family/Teacher Plan"}),e.jsxs(Q,{className:"bg-green-500 text-white",children:[e.jsx(Ue,{className:"w-3 h-3 mr-1"}),"Active",(a==null?void 0:a.subscription_tier)==="free"?" (Trial)":""]})]}),e.jsxs("p",{className:"text-gray-600 flex flex-wrap gap-2 items-center",children:[M&&`Renews ${ue(M,"MMM d, yyyy")} â€¢ ${Re} days left`,!M&&(a==null?void 0:a.isOnTrial)&&typeof(a==null?void 0:a.trialDaysRemaining)=="number"&&e.jsxs("span",{className:"text-sm text-yellow-700",children:["Trial: ",a.trialDaysRemaining," day",a.trialDaysRemaining===1?"":"s"," left"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(T,{variant:"outline",className:"h-12",onClick:()=>l(H("Subscription")),children:[e.jsx(ma,{className:"w-4 h-4 mr-2"}),"Manage Subscription"]}),(a==null?void 0:a.subscription_auto_renew)!==!1&&e.jsxs(T,{variant:"destructive",onClick:()=>c(!0),className:"h-12",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs($,{className:"sticky top-24 border-4 border-purple-200 shadow-xl",children:[e.jsx(K,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white",children:e.jsxs(J,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Your Avatar"}),e.jsxs(Q,{variant:"secondary",className:"bg-white text-purple-600",children:[(((t=p.unlocked_items)==null?void 0:t.length)||0)+(((r=a==null?void 0:a.purchased_items)==null?void 0:r.length)||0)," Items"]})]})}),e.jsxs(L,{className:"p-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(oa,{avatarData:p,size:"large",showPet:!!v,petData:z})}),v&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-purple-500"}),z.name,"'s Accessories"]}),e.jsx("div",{className:"flex justify-center gap-4",children:e.jsx(da,{pet:z,experience:((s=a==null?void 0:a.pet_experience)==null?void 0:s[v])||0,size:"medium",showAccessories:!0,hatType:p.pet_hat,accessoryType:p.pet_accessory})})]}),e.jsxs(T,{onClick:w,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 h-12 text-lg",disabled:y.isPending,children:[e.jsx(ua,{className:"w-5 h-5 mr-2"}),y.isPending?"Saving...":"Save Avatar"]}),e.jsx(G,{to:H("Shop"),children:e.jsxs(T,{variant:"outline",className:"w-full mt-3 h-12 border-2 border-purple-300 hover:bg-purple-50",children:[e.jsx(te,{className:"w-5 h-5 mr-2"}),"Get More Items"]})})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs($,{className:"border-2 border-purple-200 shadow-lg",children:[e.jsx(K,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-6 h-6 text-purple-500"}),"Customization Options"]})}),e.jsx(L,{children:e.jsxs(ia,{defaultValue:"appearance",className:"w-full",children:[e.jsxs(na,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(re,{value:"appearance",children:[e.jsx(fa,{className:"w-4 h-4 mr-1"}),"Face"]}),e.jsxs(re,{value:"clothing",children:[e.jsx(ha,{className:"w-4 h-4 mr-1"}),"Clothing"]}),e.jsxs(re,{value:"pet",children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Pet"]})]}),e.jsxs(le,{value:"appearance",className:"space-y-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 text-gray-800 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-purple-500"}),"Quick Pick - Adorable Faces!"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[{id:"happy_kid",eyes:"normal",face:"big_smile",label:"ðŸ˜„ Happy"},{id:"playful",eyes:"wink",face:"tongue_out",label:"ðŸ˜œ Playful"},{id:"sweet_smile",eyes:"normal",face:"smile",label:"ðŸ˜Š Sweet"},{id:"excited",eyes:"normal",face:"open_smile",label:"ðŸ˜ƒ Excited"},{id:"sleepy_cute",eyes:"sleepy",face:"smile",label:"ðŸ˜Œ Sleepy"}].map(n=>e.jsx("button",{onClick:()=>{f("avatar_eyes",n.eyes),f("avatar_face",n.face)},className:"relative p-6 rounded-xl border-4 border-purple-200 bg-gradient-to-br from-purple-50 to-pink-50 hover:border-purple-400 hover:shadow-xl transition-all group",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-yellow-100 to-orange-100 flex items-center justify-center mb-2 group-hover:scale-110 transition-transform",children:e.jsx($e,{type:"face",value:n.face,size:56})}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:n.label})]})},n.id))})]}),e.jsx(S,{title:"Skin Tone",options:[{id:"light",label:"Light",color:"#FFE0BD"},{id:"medium",label:"Medium",color:"#F4C89A"},{id:"tan",label:"Tan",color:"#D4A574"},{id:"dark",label:"Dark",color:"#8D5524"}],selected:p.avatar_skin_tone,onChange:n=>f("avatar_skin_tone",n),isUnlocked:()=>!0,type:"color"}),e.jsx(S,{title:"Eyes",options:[{id:"normal",label:"Round",emoji:"ðŸ‘€"},{id:"happy",label:"Happy",emoji:"ðŸ˜Š"},{id:"wink",label:"Wink",emoji:"ï¿½"},{id:"sleepy",label:"Sleepy",emoji:"ðŸ˜´"}],selected:p.avatar_eyes,onChange:n=>f("avatar_eyes",n),isUnlocked:x,previewType:"eyes"}),e.jsx(S,{title:"Face Expression",options:[{id:"smile",label:"Smile",emoji:"ðŸ˜Š"},{id:"big_smile",label:"Big Smile",emoji:"ðŸ˜„"},{id:"grin",label:"Grin",emoji:"ï¿½"},{id:"open_smile",label:"Open Smile",emoji:"ï¿½"},{id:"neutral",label:"Neutral",emoji:"ðŸ˜"},{id:"tongue_out",label:"Playful",emoji:"ðŸ˜›"}],selected:p.avatar_face,onChange:n=>f("avatar_face",n),isUnlocked:x,previewType:"mouth"}),e.jsx(S,{title:"Background",options:[{id:"plain",label:"Plain",emoji:"â¬œ"},{id:"stars",label:"Stars",emoji:"â­"},{id:"rainbow",label:"Rainbow",emoji:"ðŸŒˆ"},{id:"clouds",label:"Clouds",emoji:"â˜ï¸"},{id:"space",label:"Space",emoji:"ðŸš€"},{id:"underwater",label:"Underwater",emoji:"ðŸŒŠ"},{id:"forest",label:"Forest",emoji:"ðŸŒ²"},{id:"city",label:"City",emoji:"ðŸ™ï¸"},{id:"beach",label:"Beach",emoji:"ðŸ–ï¸"}],selected:p.avatar_background,onChange:n=>f("avatar_background",n),isUnlocked:x})]}),e.jsxs(le,{value:"clothing",className:"space-y-6",children:[e.jsx(S,{title:"Shirts & Tops",options:[{id:"t_shirt_basic",label:"Basic Tee",emoji:"ðŸ‘•"},{id:"t_shirt_stripe",label:"Striped Tee",emoji:"ðŸ‘”"},{id:"polo",label:"Polo Shirt",emoji:"ðŸ‘•"},{id:"hoodie",label:"Hoodie",emoji:"ðŸ§¥"},{id:"tank_top",label:"Tank Top",emoji:"ðŸ‘™"},{id:"sweater",label:"Sweater",emoji:"ðŸ§¶"},{id:"jersey",label:"Jersey",emoji:"âš½"},{id:"button_up",label:"Button Up",emoji:"ðŸ‘”"},{id:"graphic_tee",label:"Graphic Tee",emoji:"ðŸŽ¨"}],selected:p.avatar_shirt,onChange:n=>f("avatar_shirt",n),isUnlocked:x}),e.jsx(S,{title:"Pants & Bottoms",options:[{id:"jeans",label:"Jeans",emoji:"ðŸ‘–"},{id:"shorts",label:"Shorts",emoji:"ðŸ©³"},{id:"skirt",label:"Skirt",emoji:"ðŸ‘—"},{id:"dress_pants",label:"Dress Pants",emoji:"ðŸ‘”"},{id:"joggers",label:"Joggers",emoji:"ðŸƒ"},{id:"overalls",label:"Overalls",emoji:"ðŸ‘–"},{id:"leggings",label:"Leggings",emoji:"ðŸ©±"},{id:"cargo_pants",label:"Cargo Pants",emoji:"ðŸŽ’"}],selected:p.avatar_pants,onChange:n=>f("avatar_pants",n),isUnlocked:x})]}),e.jsx(le,{value:"pet",className:"space-y-6",children:v?e.jsxs(e.Fragment,{children:[e.jsxs(O,{className:"bg-purple-50 border-purple-300",children:[e.jsx(E,{className:"w-4 h-4 text-purple-600"}),e.jsxs(B,{className:"text-purple-800",children:[e.jsxs("strong",{children:["Dress up your ",z.name,"!"]})," Customize your pet's look with hats and accessories."]})]}),e.jsx(S,{title:"Pet Hats",options:[{id:"none",label:"None",emoji:"ðŸš«"},{id:"tiny_cap",label:"Tiny Cap",emoji:"ðŸ§¢"},{id:"bow",label:"Bow",emoji:"ðŸŽ€"},{id:"crown",label:"Crown",emoji:"ðŸ‘‘"},{id:"santa_hat",label:"Santa Hat",emoji:"ðŸŽ…"},{id:"party_hat",label:"Party Hat",emoji:"ðŸŽ‰"}],selected:p.pet_hat,onChange:n=>f("pet_hat",n),isUnlocked:x}),e.jsx(S,{title:"Pet Accessories",options:[{id:"none",label:"None",emoji:"ðŸš«"},{id:"collar",label:"Collar",emoji:"ðŸ“¿"},{id:"bow_tie",label:"Bow Tie",emoji:"ðŸŽ€"},{id:"bandana",label:"Bandana",emoji:"ðŸ§£"},{id:"scarf",label:"Scarf",emoji:"ðŸ§£"},{id:"wings",label:"Wings",emoji:"ðŸª½"},{id:"cape",label:"Cape",emoji:"ðŸ¦¸"}],selected:p.pet_accessory,onChange:n=>f("pet_accessory",n),isUnlocked:x})]}):e.jsx($,{className:"text-center py-12",children:e.jsxs(L,{children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ¾"}),e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"No Pet Yet!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Get a pet from the shop to customize it!"}),e.jsx(G,{to:H("Shop"),children:e.jsxs(T,{className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(te,{className:"w-5 h-5 mr-2"}),"Visit Shop"]})})]})})})]})})]})})]}),e.jsxs($,{className:"mt-8 border-2 border-blue-200",children:[e.jsx(K,{className:"bg-blue-50",children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-6 h-6 text-blue-600"}),"Parent/Teacher Access"]})}),e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Allow a parent or teacher to monitor your progress and help you set learning goals."}),e.jsx(O,{className:"bg-blue-50 border-blue-200",children:e.jsxs(B,{className:"text-sm text-blue-900 space-y-2",children:[e.jsx("p",{className:"font-semibold",children:"How it works"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Enter a parent or teacher's email and tap Save â€” we'll send them an invite."}),e.jsx("li",{children:"They can create/sign in to a free account and link to your profile."}),e.jsx("li",{children:"They can see your stars, recent games, concepts practiced, and goals."}),e.jsx("li",{children:"They cannot change your avatar, play as you, or make purchases."}),e.jsx("li",{children:"You can remove or change the email anytime, or manage access in the Parent Portal."})]}),e.jsx("p",{className:"text-xs text-blue-800",children:"Tip: If the invite doesnâ€™t arrive, ask them to check spam or try again."})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{htmlFor:"parent_email",children:"Parent/Teacher Email"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(me,{id:"parent_email",type:"email",value:p.parent_email||"",onChange:n=>f("parent_email",n.target.value),placeholder:"parent@example.com"}),e.jsx(T,{onClick:()=>y.mutate({parent_email:p.parent_email}),disabled:y.isPending,children:"Save"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[(a==null?void 0:a.parent_email)&&e.jsxs("p",{className:"text-sm text-green-600",children:["âœ“ Linked to: ",a.parent_email]}),e.jsx(G,{to:H("ParentPortal"),className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"Manage in Parent Portal"})]})]})]})})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs($,{className:"max-w-md w-full border-4 border-red-300",children:[e.jsx(K,{className:"bg-red-50",children:e.jsxs(J,{className:"flex items-center gap-2 text-red-700",children:[e.jsx(fe,{className:"w-6 h-6"}),"Cancel Subscription?"]})}),e.jsxs(L,{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-gray-700",children:"Are you sure you want to cancel your subscription?"}),e.jsxs(O,{className:"bg-yellow-50 border-yellow-300",children:[e.jsx(fe,{className:"w-4 h-4 text-yellow-600"}),e.jsxs(B,{className:"text-yellow-800 text-sm",children:["You'll lose access to premium features when your current billing period ends on ",M?ue(M,"MMMM d, yyyy"):"the end date","."]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(T,{variant:"outline",className:"flex-1",onClick:()=>c(!1),children:"Keep Subscription"}),e.jsx(T,{variant:"destructive",className:"flex-1",onClick:()=>N.mutate(),disabled:N.isPending,children:N.isPending?"Cancelling...":"Yes, Cancel"})]})]})]})})]})}export{Ja as default};
