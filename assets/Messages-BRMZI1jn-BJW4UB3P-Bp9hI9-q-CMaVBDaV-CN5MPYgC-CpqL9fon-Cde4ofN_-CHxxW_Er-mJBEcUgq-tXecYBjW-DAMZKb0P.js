import{c as z,x as e,$ as H,C as b,l as J,N as y,P as f,aC as W,ai as L,aA as U,T as q,m as o,aE as Y,Z as $,_ as A,u as D,Y as c,t as d,X as G,i as V,g as B,aD as K,K as C,J as p,D as ee,z as g,r as E,R as se,S as ae,U as le}from"./index-BXLScRZ5.js";import{I as v}from"./useMutation-Dw-sPjxD-CEUn9Yuu-xvhDPSZb-Dr0QtMK_-BVesU6qw-CG5MCbzm-BvDHL4Y4-BLMKEBwG-B1Kla6TY-DNLsubLb-HZRdXv_A.js";import{m as x,x as w,n as re,f as te}from"./textarea-CqrSSpqj-CdkJNOEe-BjFPPF_a-T6z-VvbV-BZi3D42F-BniOzOaT-B4WaX2EB-CE-Vyn65-KB2Vkliq-BO53em2p-BjaIhCrI.js";import{t as T}from"./info-BwmiXNr9-k9-UA3eH-BktW3SKg-XAlziMFr-Crsier0o-Bff3sT4n-DrOZgfPn-DaCjCY9G-BF2G6fIm-BRoxzOXM-DXW0rO7W.js";import{r as ie}from"./circle-alert-D0KxAb-N-CBSI-qzf-C23EQ00--C_pq6P6f-CFg9LYze-Dqr9YOPU-C0SyBRpa-Cu7J1VSn-DjlcNz2B-Ca9RhSWe-Dfv--kBN.js";import{x as ne}from"./trash-2-jwsEREBw-DdJfLY0z-Di6zSu_S-QRFYV4zs-CLTC0C47-DdwKpe-B-CjUiN4J_-CpHGTy1u-Bgc0UciZ-DOCyq9JI-C9IdPGRA.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]],de=G("MailOpen",ce);function me({user:a}){const r=H(),[l,u]=b.useState(null),[h,_]=b.useState(""),[I,M]=b.useState(!1),{data:m=[]}=J({queryKey:["childMessages",a==null?void 0:a.email],queryFn:async()=>{const s=y(f),t=se(q(s,"messages"),ae("child_email","==",a==null?void 0:a.email));return(await le(t)).docs.map(i=>i.data()).sort((i,n)=>new Date(n.created_date)-new Date(i.created_date))},initialData:[],enabled:!!(a!=null&&a.email)}),j=m.filter(s=>s.child_email===(a==null?void 0:a.email)&&!s.is_read).length,R=v({mutationFn:async s=>{const t=y(f);await W(L(t,"messages",s),{is_read:!0})},onSuccess:()=>{r.invalidateQueries({queryKey:["childMessages"]}),r.invalidateQueries({queryKey:["unreadMessages"]})}}),N=v({mutationFn:async({messageId:s,replyText:t,parentEmail:i})=>{const n=y(f);await U(q(n,"messages"),{parent_email:a==null?void 0:a.email,child_email:i,message_type:"response",subject:`Re: ${l==null?void 0:l.subject}`,message_text:t,reply_to_message_id:s,is_read:!1,parent_read:!1,created_date:new Date().toISOString()})},onSuccess:()=>{r.invalidateQueries({queryKey:["childMessages"]}),r.invalidateQueries({queryKey:["messages"]}),_(""),u(null),M(!0),setTimeout(()=>M(!1),3e3)}}),F=v({mutationFn:async s=>{throw console.log("Message deletion (placeholder):",s),alert("Message deletion is currently being migrated to Firebase. This feature will be available soon!"),new Error("Message deletion pending implementation")},onSuccess:()=>{r.invalidateQueries({queryKey:["childMessages"]}),u(null)}}),P=s=>{u(s),!s.is_read&&s.child_email===(a==null?void 0:a.email)&&R.mutate(s.id)},Q=()=>{!h.trim()||!l||N.mutate({messageId:l.id,replyText:h,parentEmail:l.parent_email})},k={encouragement:K,feedback:B,reminder:T,celebration:V,question:x,response:w},S={encouragement:"from-pink-400 to-rose-500",feedback:"from-blue-400 to-purple-500",reminder:"from-yellow-400 to-orange-500",celebration:"from-green-400 to-emerald-500",question:"from-indigo-400 to-blue-500",response:"from-gray-400 to-slate-500"},O={low:"text-gray-500",normal:"text-blue-500",high:"text-red-500"};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(x,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Messages from Parents"}),e.jsx("p",{className:"text-gray-600",children:"Read messages and reply to your parents"})]})]}),j>0&&e.jsxs(o,{className:"bg-red-500 text-white text-lg px-4 py-2 animate-pulse",children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),j," New"]})]})}),I&&e.jsxs($,{className:"mb-6 bg-green-50 border-green-300",children:[e.jsx(A,{className:"w-5 h-5 text-green-600"}),e.jsxs(D,{className:"text-green-800",children:[e.jsx("strong",{children:"Reply sent!"})," Your parent will see your message."]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-3",children:[e.jsxs("h2",{className:"font-bold text-lg mb-4",children:["Inbox (",m.length,")"]}),m.length===0?e.jsx(c,{className:"border-2 border-gray-200",children:e.jsxs(d,{className:"p-8 text-center",children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-600",children:"No messages yet"})]})}):m.map(s=>{const t=k[s.message_type]||x,i=S[s.message_type]||"from-gray-400 to-gray-500",n=s.child_email===(a==null?void 0:a.email)&&!s.is_read,X=(l==null?void 0:l.id)===s.id,Z=s.parent_email!==(a==null?void 0:a.email);return e.jsx(c,{className:`cursor-pointer transition-all ${X?"border-purple-500 ring-2 ring-purple-200 shadow-lg":n?"border-blue-400 bg-blue-50 hover:shadow-md":"border-gray-200 hover:shadow-md"}`,onClick:()=>P(s),children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${i} flex items-center justify-center flex-shrink-0`,children:e.jsx(t,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n&&e.jsx(o,{className:"bg-blue-500 text-white text-xs",children:"NEW"}),!Z&&e.jsxs(o,{className:"bg-purple-500 text-white text-xs",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),"Your Reply"]})]}),e.jsx("h4",{className:`font-bold text-sm truncate ${n?"text-blue-900":"text-gray-900"}`,children:s.subject}),e.jsx("p",{className:"text-xs text-gray-600 truncate mt-1",children:s.message_text}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:C(new Date(s.created_date),"MMM d, h:mm a")})]})]})})},s.id)})]}),e.jsx("div",{className:"lg:col-span-2",children:l?e.jsxs(c,{className:"border-2 border-purple-200 shadow-lg",children:[e.jsx(p,{className:`bg-gradient-to-br ${S[l.message_type]} text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ee.createElement(k[l.message_type]||x,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xl",children:l.subject}),e.jsxs("p",{className:"text-sm opacity-90 mt-1",children:["From: ",l.parent_email===(a==null?void 0:a.email)?"You":"Your Parent"]})]})]}),e.jsx(o,{variant:"secondary",className:"bg-white/20",children:l.message_type})]})}),e.jsxs(d,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(o,{variant:"outline",className:"text-gray-600",children:C(new Date(l.created_date),"MMMM d, yyyy 'at' h:mm a")}),l.priority!=="normal"&&e.jsxs(o,{variant:"outline",className:O[l.priority],children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),l.priority," priority"]})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border-2 border-gray-200",children:e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap text-lg leading-relaxed",children:l.message_text})})]}),l.parent_email!==(a==null?void 0:a.email)&&e.jsxs("div",{className:"space-y-3 border-t pt-6",children:[e.jsxs("h4",{className:"font-bold flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-purple-500"}),"Send a Reply"]}),e.jsx(re,{value:h,onChange:s=>_(s.target.value),placeholder:"Type your reply here...",rows:4,className:"resize-none"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{onClick:Q,disabled:!h.trim()||N.isPending,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),N.isPending?"Sending...":"Send Reply"]}),e.jsxs(E,{variant:"outline",onClick:()=>{confirm("Delete this message?")&&F.mutate(l.id)},className:"text-red-600",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),l.parent_email===(a==null?void 0:a.email)&&e.jsx("div",{className:"border-t pt-4",children:e.jsxs($,{className:"bg-purple-50 border-purple-200",children:[e.jsx(T,{className:"w-5 h-5 text-purple-600"}),e.jsx(D,{className:"text-purple-800",children:"This is your reply. Your parent will see this message."})]})})]})]}):e.jsx(c,{className:"border-2 border-gray-200 h-full",children:e.jsxs(d,{className:"p-12 text-center flex flex-col items-center justify-center h-full",children:[e.jsx(x,{className:"w-20 h-20 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-600 mb-2",children:"Select a message to read"}),e.jsx("p",{className:"text-gray-500",children:"Click on a message from the list to view and reply"})]})})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mt-8",children:[e.jsxs(c,{className:"border-2 border-blue-200",children:[e.jsx(p,{className:"bg-blue-50",children:e.jsxs(g,{className:"text-lg flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600"}),"Unread Messages"]})}),e.jsx(d,{className:"p-4",children:e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:j})})]}),e.jsxs(c,{className:"border-2 border-purple-200",children:[e.jsx(p,{className:"bg-purple-50",children:e.jsxs(g,{className:"text-lg flex items-center gap-2",children:[e.jsx(x,{className:"w-5 h-5 text-purple-600"}),"Total Messages"]})}),e.jsx(d,{className:"p-4",children:e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:m.length})})]}),e.jsxs(c,{className:"border-2 border-green-200",children:[e.jsx(p,{className:"bg-green-50",children:e.jsxs(g,{className:"text-lg flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-green-600"}),"Encouragement"]})}),e.jsx(d,{className:"p-4",children:e.jsx("p",{className:"text-3xl font-bold text-green-600",children:m.filter(s=>s.message_type==="encouragement").length})})]})]})]})}function je(){const{user:a,loading:r}=z();return r?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Loading..."})]})}):e.jsx(me,{user:a})}export{je as default};
