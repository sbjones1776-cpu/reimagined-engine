import{n as I,r as i,j as e,C as l,d as c,h as j,b as A,p as E,t as g,B as T,M as U,N as L,A as O,y as q}from"./index-52tutDqx.js";import{L as p}from"./loader-circle-BANzzYJc.js";var m={};function V(){const{user:a,loading:w}=I(),[x,h]=i.useState(!1),[f,n]=i.useState(null),[N,y]=i.useState(!1),[o,v]=i.useState("monthly"),u={monthly:{id:"MONTHLY_PLAN_ID",name:"Monthly",price:"$9.99",priceValue:9.99,interval:"per month",savings:null},annual:{id:"ANNUAL_PLAN_ID",name:"Annual",price:"$79.99",priceValue:79.99,interval:"per year",savings:"Save 33%"}};i.useEffect(()=>{const s=document.createElement("script");return s.src="https://web.squarecdn.com/v1/square.js",s.async=!0,s.onload=P,document.body.appendChild(s),()=>{document.body.removeChild(s)}},[]);const P=async()=>{if(!window.Square){console.error("Square.js failed to load");return}try{const s=m.VITE_SQUARE_APP_ID||"YOUR_SQUARE_APP_ID",r=m.VITE_SQUARE_LOCATION_ID||"YOUR_LOCATION_ID",d=await window.Square.payments(s,r).card();await d.attach("#card-container"),window.squareCard=d}catch(s){console.error("Square initialization failed:",s),n("Payment system failed to load. Please refresh and try again.")}},C=async()=>{var s,r;if(!(a!=null&&a.email)){n("Please sign in to subscribe");return}if(!window.squareCard){n("Payment form not ready. Please wait a moment.");return}h(!0),n(null);try{const t=await window.squareCard.tokenize();if(t.status!=="OK")throw new Error(((r=(s=t.errors)==null?void 0:s[0])==null?void 0:r.message)||"Card tokenization failed");const d=t.token,S=u[o],k=m.VITE_FUNCTIONS_URL||"https://your-project.cloudfunctions.net",b=await fetch(`${k}/createSubscription`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.email,planId:S.id,sourceId:d})}),_=await b.json();if(!b.ok)throw new Error(_.error||"Subscription failed");y(!0),setTimeout(()=>{window.location.href=m.VITE_APP_URL||"https://math-adventure-app.web.app/"},3e3)}catch(t){console.error("Subscription error:",t),n(t.message||"Failed to process subscription")}finally{h(!1)}};return w?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 to-pink-50",children:e.jsx(p,{className:"w-8 h-8 animate-spin text-purple-600"})}):a?N?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 to-pink-50 p-4",children:e.jsx(l,{className:"max-w-md w-full",children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(A,{className:"w-10 h-10 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Welcome to Premium! ðŸŽ‰"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Your subscription is now active. Redirecting you back to the app..."}),e.jsx(p,{className:"w-6 h-6 animate-spin text-purple-600 mx-auto"})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 p-4 py-8 overflow-x-hidden",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full mb-4",children:e.jsx(E,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"Upgrade to Premium"}),e.jsxs("p",{className:"text-gray-600 break-words",children:["Unlock unlimited learning for ",a.email]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:Object.entries(u).map(([s,r])=>e.jsx(l,{className:`cursor-pointer transition-all ${o===s?"border-purple-500 ring-2 ring-purple-200 shadow-lg":"border-gray-200 hover:border-purple-300"}`,onClick:()=>v(s),children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg break-words",children:r.name}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-purple-600",children:r.price}),e.jsx("p",{className:"text-sm text-gray-600 break-words",children:r.interval})]}),o===s&&e.jsx("div",{className:"w-6 h-6 bg-purple-600 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"w-4 h-4 text-white"})})]}),r.savings&&e.jsx(T,{className:"bg-green-100 text-green-700 border-green-200",children:r.savings})]})},s))}),e.jsxs(l,{children:[e.jsx(U,{children:e.jsx(L,{children:"Payment Information"})}),e.jsxs(c,{className:"space-y-4",children:[e.jsx("div",{id:"card-container",className:"min-h-[100px]"}),f&&e.jsx(O,{variant:"destructive",children:e.jsx(q,{children:f})}),e.jsx(j,{onClick:C,disabled:x,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-base sm:text-lg",size:"lg",children:x?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:["Subscribe - ",u[o].price]})}),e.jsx("p",{className:"text-xs text-center text-gray-500 break-words",children:"By subscribing, you agree to our Terms of Service and Privacy Policy. Your subscription will automatically renew. Cancel anytime."})]})]}),e.jsx(l,{className:"mt-6 bg-gradient-to-br from-purple-50 to-pink-50 border-purple-200",children:e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"font-bold mb-3",children:"Included in Premium:"}),e.jsx("ul",{className:"space-y-2",children:["Unlimited games - play as much as you want","AI Math Tutor with instant help","Parent Portal with full analytics","Team Challenges - create unlimited","Exclusive rewards and badges","Priority support"].map((s,r)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm min-w-0",children:[e.jsx(g,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"flex-1 min-w-0 break-words",children:s})]},r))})]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 to-pink-50 p-4",children:e.jsx(l,{className:"max-w-md w-full",children:e.jsxs(c,{className:"p-6 text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Please sign in to subscribe"}),e.jsx(j,{onClick:()=>window.location.href="/",className:"mt-4",children:"Go to App"})]})})})}export{V as default};
