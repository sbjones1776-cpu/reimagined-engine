import{c as O,z,r as u,u as H,j as e,B as o,aB as R,A as q,b as U,y as T,C as i,d as c,T as V,x as W,az as D,f as I,M as h,R as Z,N as g,h as F,i as f,k as w,aA as G,ap as J,aw as X,l as E,q as ee,w as se,m as ae,n as te}from"./index-52tutDqx.js";import{u as v}from"./useMutation-Dw-sPjxD.js";import{M as m,R as _,T as le,S as re}from"./textarea-CqrSSpqj.js";import{I as Q}from"./info-BwmiXNr9.js";import{C as ne}from"./circle-alert-D0KxAb-N.js";import{T as ie}from"./trash-2-jwsEREBw.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]],de=O("MailOpen",ce);function oe({user:s}){const r=z(),[t,j]=u.useState(null),[x,M]=u.useState(""),[A,C]=u.useState(!1),{data:d=[]}=H({queryKey:["childMessages",s==null?void 0:s.email],queryFn:async()=>{const a=f(w),n=ee(E(a,"messages"),se("child_email","==",s==null?void 0:s.email));return(await ae(n)).docs.map(l=>l.data()).sort((l,N)=>new Date(N.created_date)-new Date(l.created_date))},initialData:[],enabled:!!(s!=null&&s.email)}),y=d.filter(a=>a.child_email===(s==null?void 0:s.email)&&!a.is_read).length,K=v({mutationFn:async a=>{const n=f(w);await G(J(n,"messages",a),{is_read:!0})},onSuccess:()=>{r.invalidateQueries({queryKey:["childMessages"]}),r.invalidateQueries({queryKey:["unreadMessages"]})}}),b=v({mutationFn:async({messageId:a,replyText:n,parentEmail:p})=>{const l=f(w);await X(E(l,"messages"),{parent_email:s==null?void 0:s.email,child_email:p,message_type:"response",subject:`Re: ${t==null?void 0:t.subject}`,message_text:n,reply_to_message_id:a,is_read:!1,parent_read:!1,created_date:new Date().toISOString()})},onSuccess:()=>{r.invalidateQueries({queryKey:["childMessages"]}),r.invalidateQueries({queryKey:["messages"]}),M(""),j(null),C(!0),setTimeout(()=>C(!1),3e3)}}),B=v({mutationFn:async a=>{throw console.log("Message deletion (placeholder):",a),alert("Message deletion is currently being migrated to Firebase. This feature will be available soon!"),new Error("Message deletion pending implementation")},onSuccess:()=>{r.invalidateQueries({queryKey:["childMessages"]}),j(null)}}),P=a=>{j(a),!a.is_read&&a.child_email===(s==null?void 0:s.email)&&K.mutate(a.id)},Y=()=>{!x.trim()||!t||b.mutate({messageId:t.id,replyText:x,parentEmail:t.parent_email})},S={encouragement:D,feedback:W,reminder:Q,celebration:V,question:m,response:_},k={encouragement:"from-pink-400 to-rose-500",feedback:"from-blue-400 to-purple-500",reminder:"from-yellow-400 to-orange-500",celebration:"from-green-400 to-emerald-500",question:"from-indigo-400 to-blue-500",response:"from-gray-400 to-slate-500"},$={low:"text-gray-500",normal:"text-blue-500",high:"text-red-500"};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(m,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"Messages from Parents"}),e.jsx("p",{className:"text-gray-600",children:"Read messages and reply to your parents"})]})]}),y>0&&e.jsxs(o,{className:"bg-red-500 text-white text-lg px-4 py-2 animate-pulse",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),y," New"]})]})}),A&&e.jsxs(q,{className:"mb-6 bg-green-50 border-green-300",children:[e.jsx(U,{className:"w-5 h-5 text-green-600"}),e.jsxs(T,{className:"text-green-800",children:[e.jsx("strong",{children:"Reply sent!"})," Your parent will see your message."]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-3",children:[e.jsxs("h2",{className:"font-bold text-lg mb-4",children:["Inbox (",d.length,")"]}),d.length===0?e.jsx(i,{className:"border-2 border-gray-200",children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(de,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-600",children:"No messages yet"})]})}):d.map(a=>{const n=S[a.message_type]||m,p=k[a.message_type]||"from-gray-400 to-gray-500",l=a.child_email===(s==null?void 0:s.email)&&!a.is_read,N=(t==null?void 0:t.id)===a.id,L=a.parent_email!==(s==null?void 0:s.email);return e.jsx(i,{className:`cursor-pointer transition-all ${N?"border-purple-500 ring-2 ring-purple-200 shadow-lg":l?"border-blue-400 bg-blue-50 hover:shadow-md":"border-gray-200 hover:shadow-md"}`,onClick:()=>P(a),children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${p} flex items-center justify-center flex-shrink-0`,children:e.jsx(n,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l&&e.jsx(o,{className:"bg-blue-500 text-white text-xs",children:"NEW"}),!L&&e.jsxs(o,{className:"bg-purple-500 text-white text-xs",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"Your Reply"]})]}),e.jsx("h4",{className:`font-bold text-sm truncate ${l?"text-blue-900":"text-gray-900"}`,children:a.subject}),e.jsx("p",{className:"text-xs text-gray-600 truncate mt-1",children:a.message_text}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:I(new Date(a.created_date),"MMM d, h:mm a")})]})]})})},a.id)})]}),e.jsx("div",{className:"lg:col-span-2",children:t?e.jsxs(i,{className:"border-2 border-purple-200 shadow-lg",children:[e.jsx(h,{className:`bg-gradient-to-br ${k[t.message_type]} text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Z.createElement(S[t.message_type]||m,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xl",children:t.subject}),e.jsxs("p",{className:"text-sm opacity-90 mt-1",children:["From: ",t.parent_email===(s==null?void 0:s.email)?"You":"Your Parent"]})]})]}),e.jsx(o,{variant:"secondary",className:"bg-white/20",children:t.message_type})]})}),e.jsxs(c,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(o,{variant:"outline",className:"text-gray-600",children:I(new Date(t.created_date),"MMMM d, yyyy 'at' h:mm a")}),t.priority!=="normal"&&e.jsxs(o,{variant:"outline",className:$[t.priority],children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),t.priority," priority"]})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border-2 border-gray-200",children:e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap text-lg leading-relaxed",children:t.message_text})})]}),t.parent_email!==(s==null?void 0:s.email)&&e.jsxs("div",{className:"space-y-3 border-t pt-6",children:[e.jsxs("h4",{className:"font-bold flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-purple-500"}),"Send a Reply"]}),e.jsx(le,{value:x,onChange:a=>M(a.target.value),placeholder:"Type your reply here...",rows:4,className:"resize-none"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{onClick:Y,disabled:!x.trim()||b.isPending,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),b.isPending?"Sending...":"Send Reply"]}),e.jsxs(F,{variant:"outline",onClick:()=>{confirm("Delete this message?")&&B.mutate(t.id)},className:"text-red-600",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),t.parent_email===(s==null?void 0:s.email)&&e.jsx("div",{className:"border-t pt-4",children:e.jsxs(q,{className:"bg-purple-50 border-purple-200",children:[e.jsx(Q,{className:"w-5 h-5 text-purple-600"}),e.jsx(T,{className:"text-purple-800",children:"This is your reply. Your parent will see this message."})]})})]})]}):e.jsx(i,{className:"border-2 border-gray-200 h-full",children:e.jsxs(c,{className:"p-12 text-center flex flex-col items-center justify-center h-full",children:[e.jsx(m,{className:"w-20 h-20 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-600 mb-2",children:"Select a message to read"}),e.jsx("p",{className:"text-gray-500",children:"Click on a message from the list to view and reply"})]})})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mt-8",children:[e.jsxs(i,{className:"border-2 border-blue-200",children:[e.jsx(h,{className:"bg-blue-50",children:e.jsxs(g,{className:"text-lg flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-blue-600"}),"Unread Messages"]})}),e.jsx(c,{className:"p-4",children:e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:y})})]}),e.jsxs(i,{className:"border-2 border-purple-200",children:[e.jsx(h,{className:"bg-purple-50",children:e.jsxs(g,{className:"text-lg flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-purple-600"}),"Total Messages"]})}),e.jsx(c,{className:"p-4",children:e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:d.length})})]}),e.jsxs(i,{className:"border-2 border-green-200",children:[e.jsx(h,{className:"bg-green-50",children:e.jsxs(g,{className:"text-lg flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-green-600"}),"Encouragement"]})}),e.jsx(c,{className:"p-4",children:e.jsx("p",{className:"text-3xl font-bold text-green-600",children:d.filter(a=>a.message_type==="encouragement").length})})]})]})]})}function ye(){const{user:s,loading:r}=te();return r?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Loading..."})]})}):e.jsx(oe,{user:s})}export{ye as default};
