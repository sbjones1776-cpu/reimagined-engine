import{z as Y,r as B,a1 as X,u as h,f as C,aG as ee,j as e,T as o,x as b,a as T,A as se,y as ae,C as g,M as j,N as p,d as u,h as q,p as te,B as F,K as I,an as le,U as re,e as O,aH as ne,aI as ie,aD as ce,aJ as de,aK as oe,aL as me,aM as xe,aN as he}from"./index-52tutDqx.js";import{u as Q}from"./useMutation-Dw-sPjxD.js";import{T as ge,a as je,b as N,c as w}from"./tabs-BCUfDdd3.js";import{U as v}from"./user-plus-DvDth6Co.js";import{T as pe}from"./trending-up-DOxCo9I6.js";import{Z as ue}from"./zap-BUGd4PS-.js";import{P as fe}from"./plus-CzE6Y-vE.js";import{T as ye}from"./target-1p2ICMDN.js";import{M as P}from"./medal-iK-ypg-g.js";import{s as be}from"./startOfMonth-D3h4jTlt.js";function Ae(){const f=Y(),[m,_]=B.useState(""),[W,A]=B.useState(!1),{user:a}=X(),{data:M=[]}=h({queryKey:["allUsers"],queryFn:()=>de(),staleTime:3e5,gcTime:6e5}),{data:d=[]}=h({queryKey:["allProgress"],queryFn:()=>oe(),staleTime:3e5,gcTime:6e5}),{data:D=[]}=h({queryKey:["allDailyChallenges"],queryFn:()=>me(),staleTime:3e5,gcTime:6e5}),{data:R=[]}=h({queryKey:["myFriends",a==null?void 0:a.email],queryFn:()=>xe(a.email),enabled:!!(a!=null&&a.email),staleTime:6e4}),{data:S=[]}=h({queryKey:["pendingRequests",a==null?void 0:a.email],queryFn:()=>he(a.email),enabled:!!(a!=null&&a.email),staleTime:6e4}),k=Q({mutationFn:async({user_email:s,friend_email:t})=>await ne(s,t),onSuccess:()=>{f.invalidateQueries({queryKey:["myFriends",a==null?void 0:a.email]}),f.invalidateQueries({queryKey:["pendingRequests",a==null?void 0:a.email]}),A(!0),_(""),setTimeout(()=>A(!1),3e3)}}),E=Q({mutationFn:async({id:s,status:t})=>await ie(s,t),onSuccess:()=>{f.invalidateQueries({queryKey:["myFriends",a==null?void 0:a.email]}),f.invalidateQueries({queryKey:["pendingRequests",a==null?void 0:a.email]})}}),$=`${C(new Date,"yyyy")}-W${ee(new Date)}`,z=`${C(new Date,"yyyy")}-M${C(new Date,"MM")}`,y=(s,t=null)=>{const l=d.filter(n=>t?n.operation===s&&n.level===t:n.operation===s),r={};return l.forEach(n=>{const i=n.user_email;r[i]||(r[i]={email:i,totalScore:0,bestScore:0,gamesPlayed:0,totalAccuracy:0}),r[i].totalScore+=n.score,r[i].bestScore=Math.max(r[i].bestScore,n.score),r[i].gamesPlayed++,r[i].totalAccuracy+=n.correct_answers/n.total_questions*100}),Object.values(r).map(n=>({...n,avgAccuracy:Math.round(n.totalAccuracy/n.gamesPlayed)})).sort((n,i)=>i.bestScore-n.bestScore).slice(0,10)},H=()=>{const s={};return d.forEach(t=>{const l=t.user_email;(!s[l]||t.time_taken<s[l].time)&&(s[l]={email:l,time:t.time_taken,score:t.score,accuracy:Math.round(t.correct_answers/t.total_questions*100)})}),Object.values(s).sort((t,l)=>t.time-l.time).slice(0,10)},G=()=>{const s=R.map(l=>l.user_email===(a==null?void 0:a.email)?l.friend_email:l.user_email);s.push(a==null?void 0:a.email);const t={};return d.forEach(l=>{const r=l.user_email;s.includes(r)&&(t[r]||(t[r]={email:r,totalScore:0,gamesPlayed:0,totalStars:0}),t[r].totalScore+=l.score,t[r].gamesPlayed++,t[r].totalStars+=l.stars_earned||0)}),Object.values(t).sort((l,r)=>r.totalScore-l.totalScore).slice(0,10)},L=s=>{const t=s==="weekly"?ce(new Date):be(new Date),l={};return d.forEach(r=>{var x;const n=(x=r.completed_at)!=null&&x.toDate?r.completed_at.toDate():new Date,i=r.user_email;n>=t&&(l[i]||(l[i]={email:i,totalScore:0,gamesPlayed:0,totalStars:0}),l[i].totalScore+=r.score,l[i].gamesPlayed++,l[i].totalStars+=r.stars_earned||0)}),Object.values(l).sort((r,n)=>n.totalScore-r.totalScore).slice(0,10)},Z=s=>s===1?e.jsx(o,{className:"w-6 h-6 text-yellow-500 fill-yellow-500"}):s===2?e.jsx(P,{className:"w-6 h-6 text-gray-400 fill-gray-400"}):s===3?e.jsx(P,{className:"w-6 h-6 text-amber-600 fill-amber-600"}):e.jsxs("span",{className:"w-6 h-6 flex items-center justify-center font-bold text-gray-500",children:["#",s]}),J=s=>s===1?"from-yellow-100 to-yellow-200 border-yellow-300":s===2?"from-gray-100 to-gray-200 border-gray-300":s===3?"from-amber-100 to-amber-200 border-amber-300":"from-white to-gray-50 border-gray-200",U=s=>{const t=M.find(l=>l.email===s);return(t==null?void 0:t.child_name)||(t==null?void 0:t.full_name)||s.split("@")[0]},V=()=>{!m||m===(a==null?void 0:a.email)||k.mutate({user_email:a.email,friend_email:m,connection_type:"friend"})},c=({title:s,icon:t,data:l,renderStats:r})=>e.jsxs(g,{className:"border-2 border-purple-200",children:[e.jsx(j,{className:"bg-gradient-to-r from-purple-100 to-pink-100",children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-6 h-6 text-purple-600"}),s]})}),e.jsx(u,{className:"p-6",children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(o,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No data available yet"})]}):e.jsx("div",{className:"space-y-2",children:l.map((n,i)=>{const x=i+1,K=n.email===(a==null?void 0:a.email);return e.jsx("div",{className:`flex items-center justify-between p-4 rounded-xl border-2 transition-all ${K?"bg-gradient-to-r from-purple-100 to-pink-100 border-purple-300 shadow-md":`bg-gradient-to-r ${J(x)} border`}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[Z(x),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:U(n.email)}),K&&e.jsx(F,{className:"bg-purple-500 text-white",children:"You"})]}),r(n)]})]})},i)})})})]});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-block mb-4",children:e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-xl",children:e.jsx(o,{className:"w-10 h-10 text-white"})})}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-r from-yellow-600 via-orange-600 to-red-600 bg-clip-text text-transparent",children:"Leaderboards"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Compete with friends and players worldwide!"}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-4 justify-center text-sm text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow",children:[e.jsx(o,{className:"w-4 h-4 text-yellow-600"}),e.jsxs("span",{children:[M.length," Players"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow",children:[e.jsx(b,{className:"w-4 h-4 text-purple-600"}),e.jsxs("span",{children:[d.length," Game Entries"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow",children:[e.jsx(T,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{children:[D.length," Daily Challenges"]})]})]})]}),W&&e.jsxs(se,{className:"mb-6 bg-green-50 border-green-200",children:[e.jsx(v,{className:"w-4 h-4 text-green-600"}),e.jsx(ae,{className:"text-green-800",children:"Friend request sent successfully! ğŸ‰"})]}),S.length>0&&e.jsxs(g,{className:"mb-6 border-2 border-blue-300 bg-blue-50",children:[e.jsx(j,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-6 h-6 text-blue-600"}),"Pending Friend Requests (",S.length,")"]})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"font-medium",children:U(s.user_email)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{size:"sm",onClick:()=>E.mutate({id:s.id,status:"accepted"}),className:"bg-green-500 hover:bg-green-600",children:"Accept"}),e.jsx(q,{size:"sm",variant:"outline",onClick:()=>E.mutate({id:s.id,status:"declined"}),children:"Decline"})]})]},s.id))})})]}),e.jsxs(ge,{defaultValue:"tournaments",className:"space-y-6",children:[e.jsxs(je,{className:"grid w-full grid-cols-2 md:grid-cols-4",children:[e.jsx(N,{value:"tournaments",children:"Tournaments"}),e.jsx(N,{value:"categories",children:"Categories"}),e.jsx(N,{value:"friends",children:"Friends"}),e.jsx(N,{value:"special",children:"Special"})]}),e.jsxs(w,{value:"tournaments",className:"space-y-6",children:[e.jsxs(g,{className:"border-4 border-yellow-300 bg-gradient-to-r from-yellow-50 to-orange-50",children:[e.jsx(j,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-6 h-6 text-yellow-600"}),"Active Tournaments"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border-2 border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(T,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Weekly Tournament"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Resets every Monday"})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tournament ID:"}),e.jsx("span",{className:"font-bold",children:$})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Prize:"}),e.jsx("span",{className:"font-bold text-yellow-600",children:"50 Bonus Stars â­"})]})]}),e.jsx(F,{className:"w-full justify-center bg-purple-500 text-white",children:"Active Now"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(T,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Monthly Tournament"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Resets on 1st of month"})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tournament ID:"}),e.jsx("span",{className:"font-bold",children:z})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Prize:"}),e.jsx("span",{className:"font-bold text-yellow-600",children:"100 Bonus Stars â­"})]})]}),e.jsx(F,{className:"w-full justify-center bg-blue-500 text-white",children:"Active Now"})]})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(c,{title:"Weekly Leaders",icon:pe,data:L("weekly"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),s.totalScore," pts"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4 text-yellow-500"}),s.totalStars]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})}),e.jsx(c,{title:"Monthly Leaders",icon:I,data:L("monthly"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),s.totalScore," pts"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4 text-yellow-500"}),s.totalStars]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})})]})]}),e.jsx(w,{value:"categories",className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(c,{title:"Multiplication Masters (Hard)",icon:ue,data:y("multiplication","hard"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:["Best: ",s.bestScore]}),e.jsxs("span",{children:["Avg: ",s.avgAccuracy,"%"]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})}),e.jsx(c,{title:"Addition Champions",icon:fe,data:y("addition"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:["Best: ",s.bestScore]}),e.jsxs("span",{children:["Avg: ",s.avgAccuracy,"%"]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})}),e.jsx(c,{title:"Division Experts (Hard)",icon:ye,data:y("division","hard"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:["Best: ",s.bestScore]}),e.jsxs("span",{children:["Avg: ",s.avgAccuracy,"%"]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})}),e.jsx(c,{title:"Subtraction Stars",icon:P,data:y("subtraction"),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{children:["Best: ",s.bestScore]}),e.jsxs("span",{children:["Avg: ",s.avgAccuracy,"%"]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})})]})}),e.jsxs(w,{value:"friends",className:"space-y-6",children:[e.jsxs(g,{className:"border-2 border-blue-200 bg-blue-50",children:[e.jsx(j,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-6 h-6 text-blue-600"}),"Invite Friends"]})}),e.jsxs(u,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(le,{placeholder:"Enter friend's email",value:m,onChange:s=>_(s.target.value),type:"email"}),e.jsxs(q,{onClick:V,className:"bg-blue-500 hover:bg-blue-600",disabled:k.isPending||!m,children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Invite"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Connected friends: ",R.length]})]})]}),e.jsx(c,{title:"Friends & Family Leaderboard",icon:re,data:G(),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),s.totalScore," pts"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4 text-yellow-500"}),s.totalStars]}),e.jsxs("span",{children:[s.gamesPlayed," games"]})]})})]}),e.jsxs(w,{value:"special",className:"space-y-6",children:[e.jsx(c,{title:"Speed Demons (Fastest Completion)",icon:O,data:H(),renderStats:s=>e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 font-bold text-blue-600",children:[e.jsx(O,{className:"w-4 h-4"}),s.time,"s"]}),e.jsxs("span",{children:[s.score," pts"]}),e.jsxs("span",{children:[s.accuracy,"% accuracy"]})]})}),e.jsxs(g,{className:"border-2 border-green-200 bg-green-50",children:[e.jsx(j,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-6 h-6 text-green-600"}),"Special Achievements"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ†"}),e.jsx("h4",{className:"font-bold mb-1",children:"Perfect Score Club"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[d.filter(s=>s.correct_answers/s.total_questions===1).length," perfect games"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"âš¡"}),e.jsx("h4",{className:"font-bold mb-1",children:"Speed Masters"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[d.filter(s=>s.time_taken<60).length," games under 60s"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ”¥"}),e.jsx("h4",{className:"font-bold mb-1",children:"Daily Warriors"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[D.length," daily challenges completed"]})]})]})})]})]})]})]})}export{Ae as default};
