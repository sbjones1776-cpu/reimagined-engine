import{a1 as qe,b as tt,E as l,a2 as st,D as Me,i as Ye,x as e,W as S,n as L,a as F,T as Q,g as ae,r as re,o as B,O,h as z,e as Ie,G as K,a3 as N,J as at,a4 as rt,q as De,a5 as lt,a6 as it,s as ue,S as he,a7 as nt,Y as ot,X as ct,a8 as mt,U as dt,a9 as xt,aa as ut,Z as ht}from"./index-Duhpx7eq.js";import{T as pt}from"./useMutation-Dw-sPjxD-CEUn9Yuu-xvhDPSZb-Dr0QtMK_-BVesU6qw.js";import{F as gt}from"./progress-DswiN-jt-CRkTvpyk-D1KYlrjl-CsboKJzw-C3ozQzG_.js";import{R as bt,D as yt}from"./CelebrationAnimation-Dc0BowXO-4Xv1ol_O-B1v40KzG-IHAvCb5d-HS1mS00F.js";import{L as _}from"./TextToSpeech-AHz3T4an-Bb6-aa6H-M_MuP7jF-DwxXGwoF-BcGzNvoM.js";import{y as Ue}from"./target-1p2ICMDN-CvDzxGjB-qkOcir94-HosS9mN8-D7ZLtM3Q.js";import{o as jt}from"./rotate-ccw-D8vHVTX7-B0EUTX0N-B62Xtj9N-Bzq5Fnxx-Bw8Xp5R6.js";import{r as ft}from"./circle-alert-D0KxAb-N-CBSI-qzf-C23EQ00--C_pq6P6f-CFg9LYze.js";import{e as Ee}from"./book-open-CsZLkRie-CnloTbZU-ChOf-sMy-O-KDOf0X-BjwcqdyU.js";import{e as wt}from"./trending-up-DOxCo9I6-CjyZKRpy-BwiJPOic-BbyIY-I5-2slMDHp0.js";import{i as vt}from"./trending-down-CtEqn-BB-zOpygq96-CNt4ZELp-DYs6Ix-S-DshAzykl.js";import{o as pe}from"./lock-DVJmOJtR-CPCpectf-CAbDyxwB-CjKaN8Uy-DSiTgkC1.js";import{t as Nt}from"./triangle-alert-BF04o9wv-5R0uES8i-B0nBc2eR-DyIfcPD2-DHjNSAAD.js";import{w as _t}from"./QuestionGenerator-z-c728t7-CSzYVewV-BkEMOThz-BkEMOThz-BkEMOThz.js";import{b as kt}from"./PremiumFeatureLock-DUuDI_YH-C25OdOdH-ABaij4QQ-D0Avu4LI-BPEWt9vX.js";import{o as se}from"./arrow-left-8gFWt4dJ-CSNboBK9-xHDhZtE6-CrPSaO5S-DKZmBPSQ.js";import{o as $t}from"./zap-BUGd4PS--D5Rx8Je6-38BwrXim-CvVM-oS5-D5MMr3dA.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Re=ct("Lightbulb",Tt);function St({score:a,correctAnswers:u,totalQuestions:c,timeTaken:h,operation:E,level:D,coinsEarned:i=0,activePowerUps:U={}}){const n=qe(),w=u/c*100;let m=0,v="",b="";return w>=90?(m=3,v="Outstanding! You're a math superstar!",b="üåü"):w>=70?(m=2,v="Great job! Keep practicing!",b="üéâ"):w>=50?(m=1,v="Good effort! Try again to improve!",b="üëç"):(m=0,v="Keep practicing! You'll get better!",b="üí™"),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(K.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},children:e.jsxs(F,{className:"border-4 border-yellow-300 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 py-12 text-white text-center",children:[e.jsx(K.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"text-8xl mb-4",children:b}),e.jsxs("h1",{className:"text-4xl md:text-5xl font-bold mb-2 flex items-center gap-2",children:["Challenge Complete!",e.jsx(_,{text:N("Challenge Complete!"),style:"icon",label:"Read title"})]}),e.jsxs("p",{className:"text-xl flex items-center gap-2",children:[v,e.jsx(_,{text:N(v),style:"icon",label:"Read message"})]})]}),e.jsxs(Q,{className:"p-8 space-y-6",children:[" ",e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-xl",children:[e.jsx(ae,{className:"w-8 h-8 mx-auto mb-2 text-purple-500"}),e.jsxs("div",{className:"text-3xl font-bold text-purple-600 flex items-center gap-2",children:[a,e.jsx(_,{text:N(`Your score is ${a}`),style:"icon",label:"Read score"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Score"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-xl",children:[e.jsx(Ue,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsxs("div",{className:"text-3xl font-bold text-green-600 flex items-center gap-2",children:[u,"/",c,e.jsx(_,{text:N(`You got ${u} out of ${c} correct`),style:"icon",label:"Read correct answers"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Correct"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-xl",children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 flex items-center gap-2",children:[h,"s",e.jsx(_,{text:N(`Time taken: ${h} seconds`),style:"icon",label:"Read time"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Time"})]}),e.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-xl",children:[e.jsx(at,{className:"w-8 h-8 mx-auto mb-2 text-yellow-500 fill-yellow-500"}),e.jsxs("div",{className:"text-3xl font-bold text-yellow-600 flex items-center gap-2",children:[m,e.jsx(_,{text:N(`You earned ${m} stars`),style:"icon",label:"Read stars"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Stars"})]})]}),i>0&&e.jsx(F,{className:"border-2 border-cyan-300 bg-gradient-to-r from-cyan-50 to-blue-50",children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center",children:e.jsx(rt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:["Coins Earned!",e.jsx(_,{text:N(`You earned ${i} coins!`),style:"icon",label:"Read coins"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use them in the shop for power-ups"})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-cyan-600 flex items-center gap-2",children:["+",i,e.jsx(_,{text:N(`Plus ${i} coins`),style:"icon",label:"Read coins"})]})]})})}),Object.keys(U).length>0&&e.jsxs(B,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(De,{className:"w-4 h-4 text-yellow-600"}),e.jsxs(O,{className:"text-yellow-800 flex items-center gap-2",children:[e.jsx("strong",{children:"Power-ups were active!"})," Your rewards have been boosted!",e.jsx(_,{text:N("Power-ups were active! Your rewards have been boosted!"),style:"icon",label:"Read power-ups"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs(S,{variant:"outline",className:"flex-1 h-14 text-lg gap-2",onClick:()=>n(L("Home")),children:[e.jsx(lt,{className:"w-5 h-5"}),"Back Home"]}),e.jsxs(S,{variant:"outline",className:"flex-1 h-14 text-lg gap-2",onClick:()=>window.location.reload(),children:[e.jsx(jt,{className:"w-5 h-5"}),"Try Again"]}),e.jsxs(S,{className:"flex-1 h-14 text-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 gap-2",onClick:()=>n(L("Progress")),children:["View Progress",e.jsx(it,{className:"w-5 h-5"})]})]})]})]})})})}function Ct({question:a,correctAnswer:u,userAnswer:c,operation:h,level:E,onContinue:D}){const[i,U]=l.useState(!1),[n,w]=l.useState(!1),[m,v]=l.useState(""),[b,C]=l.useState(""),[f,T]=l.useState(!1),[P,k]=l.useState(null),R=async()=>{T(!0),k(null);try{console.log("ü§ñ Generating hint for:",a),console.log("ü§ñ AI hints are currently being migrated to Firebase.");const d=`Let's think about ${a} together! Try breaking it down into smaller steps. ${h==="addition"?"Add the ones first, then the tens.":h==="subtraction"?"Remember to borrow if you need to!":h==="multiplication"?"Think about groups of the same number.":"Think about dividing into equal groups!"} You can do this! üí™`;v(d),U(!0),console.log("Tutor session (placeholder):",{question:a,correct_answer:u,user_answer:c,operation:h,level:E,hint_requested:!0,hint_text:d})}catch(d){console.error("‚ùå Error generating hint:",d),k(d.message);const y=`Let's think about ${a} together! Try breaking it down into smaller steps. ${h==="addition"?"Add the ones first, then the tens.":h==="subtraction"?"Remember to borrow if you need to!":h==="multiplication"?"Think about groups of the same number.":"Think about dividing into equal groups!"} You can do this! üí™`;v(y),U(!0)}T(!1)},H=async()=>{T(!0),k(null);try{console.log("ü§ñ Generating explanation for:",a),console.log("ü§ñ AI explanations are currently being migrated to Firebase.");const d=A(a,u,c,h);C(d),w(!0),console.log("Tutor session (placeholder):",{question:a,correct_answer:u,user_answer:c,operation:h,level:E,explanation_viewed:!0,explanation_text:d})}catch(d){console.error("‚ùå Error generating explanation:",d),k(d.message);const y=A(a,u,c,h);C(y),w(!0)}T(!1)},A=(d,y,$,j)=>{var W,X;const J=d.split(/[\+\-\√ó√∑]/),x=parseInt(((W=J[0])==null?void 0:W.trim())||0),g=parseInt(((X=J[1])==null?void 0:X.trim())||0);let r=`**üìç WHERE DID I GO WRONG?**
`;return r+=`You got ${$}, but the correct answer is ${y}. Let's figure out why and learn from it!

`,r+=`**‚ú® LET'S SOLVE IT STEP-BY-STEP!**

`,j==="addition"?(r+=`1Ô∏è‚É£ Set up the problem: ${x} + ${g}
`,r+=`2Ô∏è‚É£ Add the ones place: ${x%10} + ${g%10} = ${x%10+g%10}
`,x%10+g%10>=10&&(r+=`3Ô∏è‚É£ That's ${x%10+g%10}, so we carry the 1!
`),r+=`4Ô∏è‚É£ Add the tens place: ${Math.floor(x/10)} + ${Math.floor(g/10)} ${x%10+g%10>=10?"+ 1 (carried)":""}
`,r+=`5Ô∏è‚É£ Final answer: **${y}** ‚úì

`):j==="subtraction"?(r+=`1Ô∏è‚É£ Set up the problem: ${x} - ${g}
`,r+=`2Ô∏è‚É£ Start with the ones place
`,x%10<g%10&&(r+=`3Ô∏è‚É£ We need to borrow from the tens place!
`),r+=`4Ô∏è‚É£ Subtract: ${x} - ${g}
`,r+=`5Ô∏è‚É£ Final answer: **${y}** ‚úì

`):j==="multiplication"?(r+=`1Ô∏è‚É£ Think: ${x} groups of ${g}
`,r+=`2Ô∏è‚É£ Or: ${x} √ó ${g}
`,(x>10||g>10)&&(r+=`3Ô∏è‚É£ Break it down: (${Math.floor(x/10)*10} + ${x%10}) √ó ${g}
`),r+=`4Ô∏è‚É£ Calculate: ${x} √ó ${g} = ${y}
`,r+=`5Ô∏è‚É£ Final answer: **${y}** ‚úì

`):j==="division"&&(r+=`1Ô∏è‚É£ How many ${g}s fit into ${x}?
`,r+=`2Ô∏è‚É£ Count by ${g}s until you reach ${x}
`,r+=`3Ô∏è‚É£ Check: ${y} √ó ${g} = ${x}
`,r+=`4Ô∏è‚É£ Final answer: **${y}** ‚úì

`),r+=`**üéØ THE RIGHT ANSWER**
`,r+=`${d} = **${y}** üéâ

`,r+=`**üí° QUICK TIP TO REMEMBER**
`,j==="addition"?r+=`Always start with the ones place and work your way left. Don't forget to carry!

`:j==="subtraction"?r+=`If the top number is smaller, remember to borrow from the next column!

`:j==="multiplication"?r+=`Break big numbers into smaller parts to make multiplication easier!

`:r+=`Division is the opposite of multiplication - think about groups!

`,r+=`**üèÉ PRACTICE HELPS!**
`,r+=`The more you practice ${j}, the easier it gets. You're doing great! Keep going! üí™`,r};return e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(F,{className:"max-w-2xl w-full border-4 border-blue-300 shadow-2xl max-h-[90vh] overflow-auto",children:[e.jsx(ue,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white",children:e.jsxs(he,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(Ie,{className:"w-7 h-7"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"AI Math Tutor"}),e.jsxs(z,{variant:"secondary",className:"bg-white/20 text-white",children:[e.jsx(De,{className:"w-3 h-3 mr-1"}),"Powered by AI"]})]}),e.jsx("p",{className:"text-sm opacity-90 font-normal mt-1",children:"Let's learn from this mistake together! üåü"})]})]})}),e.jsxs(Q,{className:"p-6 space-y-6",children:[e.jsx(B,{className:"bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-200",children:e.jsx(O,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Question:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[a,e.jsx(_,{text:N(a),style:"icon",label:"Read question"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-red-500"}),"Your answer:"]}),e.jsxs(z,{variant:"outline",className:"bg-red-100 border-red-300 text-red-700 text-lg flex items-center gap-2",children:[c,e.jsx(_,{text:N(c==null?void 0:c.toString()),style:"icon",label:"Read your answer"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-green-500"}),"Correct answer:"]}),e.jsxs(z,{className:"bg-green-500 text-white text-lg flex items-center gap-2",children:[u,e.jsx(_,{text:N(u==null?void 0:u.toString()),style:"icon",label:"Read correct answer"})]})]})]})})}),P&&e.jsxs(B,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(ft,{className:"w-4 h-4 text-yellow-600"}),e.jsxs(O,{className:"text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," Using fallback explanation. ",P]})]}),e.jsx("div",{children:i?e.jsx(K.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:e.jsxs(F,{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(he,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Re,{className:"w-5 h-5 text-yellow-600"}),"Hint"]})}),e.jsx(Q,{children:e.jsxs("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:[m,e.jsx(_,{text:N(m),style:"icon",label:"Read hint"})]})})]})}):e.jsx(S,{onClick:R,disabled:f,className:"w-full h-16 text-lg bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-yellow-500 hover:to-orange-500 text-gray-900",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-gray-900 border-t-transparent rounded-full mr-2"}),"Thinking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-6 h-6 mr-2"}),"Get a Hint"]})})}),i&&e.jsx("div",{children:n?e.jsx(K.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:e.jsxs(F,{className:"bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-300",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(he,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Ee,{className:"w-5 h-5 text-blue-600"}),"Complete Solution"]}),e.jsx(_,{text:N(b.replace(/\*\*/g,"").replace(/\n\n/g,". ").replace(/\n/g,". ")),style:"button",label:"Read entire solution"})]})}),e.jsx(Q,{children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed space-y-3",children:b.split(`

`).map((d,y)=>e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("div",{className:"flex-1",children:d.split(`
`).map(($,j)=>$.startsWith("**")&&$.endsWith("**")?e.jsx("h4",{className:"font-bold text-lg mb-2 text-purple-700",children:$.replace(/\*\*/g,"")},j):/^\d+Ô∏è‚É£/.test($)?e.jsx("div",{className:"flex gap-3 mb-2 bg-white p-2 rounded-lg",children:e.jsx("span",{className:"text-blue-600 font-bold",children:$})},j):$?e.jsx("p",{className:"mb-2",children:$},j):null)}),e.jsx(_,{text:N(d.replace(/\*\*/g,"")),style:"icon",label:"Read this section"})]})},y))})})})]})}):e.jsx(S,{onClick:H,disabled:f,className:"w-full h-16 text-lg bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"}),"Generating Explanation..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-6 h-6 mr-2"}),"Show Step-by-Step Solution"]})})}),e.jsx(B,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200",children:e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"üí™"}),e.jsx("p",{className:"font-medium text-gray-800",children:"Mistakes help us learn! Keep practicing and you'll get better every day!"})]})}),e.jsxs(S,{onClick:D,className:"w-full h-14 text-lg bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:["I Understand! Continue",e.jsx(mt,{className:"w-5 h-5 ml-2"})]})]})]})})}function Pt({adjustment:a,onClose:u}){const c={easier:{icon:vt,color:"from-blue-400 to-cyan-400",title:"Let's Try Something Easier!",message:"Don't worry! I'm adjusting the difficulty to help you build confidence. You've got this! üíô",emoji:"üéØ"},harder:{icon:wt,color:"from-purple-400 to-pink-400",title:"Level Up Challenge!",message:"Wow! You're doing amazing! Let's try some harder problems to keep you challenged! üöÄ",emoji:"‚≠ê"},perfect:{icon:dt,color:"from-yellow-400 to-orange-400",title:"Perfect Match!",message:"The difficulty is just right for you! Keep up the excellent work! üéâ",emoji:"üèÜ"}},h=c[a]||c.perfect,E=h.icon;return e.jsx(K.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:u,children:e.jsx(K.div,{initial:{y:-50},animate:{y:0},onClick:D=>D.stopPropagation(),children:e.jsx(F,{className:`max-w-md border-4 shadow-2xl bg-gradient-to-br ${h.color}`,children:e.jsxs(Q,{className:"p-8 text-center text-white",children:[e.jsx(K.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"text-7xl mb-4",children:h.emoji}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(E,{className:"w-6 h-6"}),e.jsx("h3",{className:"text-2xl font-bold",children:h.title})]}),e.jsx("p",{className:"text-lg opacity-95 mb-6",children:h.message}),e.jsxs(z,{className:"bg-white/20 text-white text-sm px-4 py-2",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"AI Adaptive Learning"]}),e.jsx("p",{className:"text-xs mt-4 opacity-75",children:"Click anywhere to continue"})]})})})})}function At({operation:a=null}){var u;const[c,h]=l.useState(0),[E,D]=l.useState(!1),[i,U]=l.useState(!1),{data:n,refetch:w}=Me({queryKey:["currentUser"],queryFn:async()=>({email:"user@example.com",parental_controls:{},daily_usage_tracking:{}}),initialData:{email:"user@example.com",parental_controls:{},daily_usage_tracking:{}}}),m=Ye(new Date,"yyyy-MM-dd"),v=(n==null?void 0:n.parental_controls)||{},b=(n==null?void 0:n.daily_usage_tracking)||{},C=b[m]||{total_minutes:0,by_operation:{}},f=v.daily_time_limit_minutes||0,T=v.enforce_time_limits!==!1,P=v.time_limit_warning_minutes||5,k=v.time_limits_by_operation||{};if(l.useEffect(()=>{var A;if(!T||f===0)return;const d=C.total_minutes||0;h(d),d>=f?U(!0):f-d<=P&&f-d>0&&D(!0),a&&k[a]&&(((A=C.by_operation)==null?void 0:A[a])||0)>=k[a]&&U(!0)},[n,a,T,f,P,k]),l.useEffect(()=>{if(!T||i)return;const A=setInterval(async()=>{var d;const y=Math.floor((C.total_minutes||0)+.016666666666666666),$=a?Math.floor((((d=C.by_operation)==null?void 0:d[a])||0)+1/60):0,j={...b,[m]:{total_minutes:y,by_operation:{...C.by_operation||{},...a?{[a]:$}:{}}}};try{console.log("Time tracking update (placeholder):",j),await w()}catch(W){console.error("Error updating time tracking:",W)}},6e4);return()=>clearInterval(A)},[T,i,a,C,b,w]),!T||f===0)return null;const R=Math.max(0,f-c),H=a&&k[a]?Math.max(0,k[a]-(((u=C.by_operation)==null?void 0:u[a])||0)):null;return i?e.jsxs(B,{className:"mb-6 bg-red-50 border-red-300",children:[e.jsx(pe,{className:"w-5 h-5 text-red-600"}),e.jsxs(O,{className:"text-red-800",children:[e.jsx("strong",{className:"block mb-2",children:"Time Limit Reached"}),"You've used your allotted time for today. Come back tomorrow to continue learning!",a&&H===0&&k[a]&&e.jsxs("p",{className:"mt-2 text-sm",children:[a," time limit: ",k[a]," minutes reached"]}),e.jsx("div",{className:"mt-3 text-sm text-gray-600",children:"Time resets at midnight. See you tomorrow! üåô"})]})]}):E&&R<=P?e.jsxs(B,{className:"mb-6 bg-yellow-50 border-yellow-300",children:[e.jsx(Nt,{className:"w-5 h-5 text-yellow-600"}),e.jsxs(O,{className:"text-yellow-800",children:[e.jsx("strong",{className:"block mb-2",children:"Time Running Out!"}),"You have ",e.jsxs("strong",{children:[R," minutes"]})," left to play today.",a&&H!==null&&H<R&&e.jsxs("p",{className:"mt-2",children:[a,": ",e.jsxs("strong",{children:[H," minutes"]})," left"]})]})]}):e.jsxs("div",{className:"mb-4 flex items-center justify-end gap-2 text-sm text-gray-600",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsxs("span",{children:[R," minutes remaining today"]})]})}function Jt(){var a;const u=qe(),c=tt(),h=new URLSearchParams(window.location.search),E=h.get("operation"),D=h.get("level"),[i,U]=l.useState(E),[n,w]=l.useState(D),[m,v]=l.useState(0),[b,C]=l.useState([]),[f,T]=l.useState([]),[P,k]=l.useState(0),[R,H]=l.useState(!1),[A,d]=l.useState(Date.now()),[y,$]=l.useState(!1),[j,W]=l.useState(0),[X,J]=l.useState(!1),[x,g]=l.useState(null),[r,ge]=l.useState(!1),[He,Le]=l.useState(null),[Z,Et]=l.useState({}),[Fe,be]=l.useState(!1),[ye,Qe]=l.useState(!1),Y=10,{user:t}=st(),{data:je=[]}=Me({queryKey:["recentProgress",t==null?void 0:t.email],queryFn:async()=>t!=null&&t.email?(await ht(t.email)).slice(0,5):[],initialData:[],enabled:!!(t!=null&&t.email)}),le=!!(t!=null&&t.hasPremiumAccess),V=["addition","subtraction","multiplication","division","addition_single_digit","subtraction_single_digit","counting","number_comparison"],ie=["easy"],q=(t==null?void 0:t.parental_controls)||{},ee=q.focus_operations||[];q.focus_priority;const fe=q.focus_reminder_frequency||"never",we=["addition","subtraction","multiplication","division","fractions","decimals","percentages","word_problems","money_math","time","geometry","mixed","counting","number_comparison","skip_counting_2s","skip_counting_5s","skip_counting_10s","even_odd","ordering_numbers","place_value","addition_single_digit","subtraction_single_digit"],ne=Array.isArray(q.allowed_operations)?q.allowed_operations:void 0,oe=Array.isArray(q.allowed_levels)?q.allowed_levels:void 0,ce=!!(t!=null&&t._optimisticTrial||t!=null&&t.isOnTrial||t!=null&&t.inGraceDay),Ke=ce?we:le?ne&&ne.length>0?ne:we:V,Ge=ce?["easy","medium","hard","expert"]:le?oe&&oe.length>0?oe:["easy","medium","hard","expert"]:ie,Be=Ye(new Date,"yyyy-MM-dd"),ve=((t==null?void 0:t.daily_usage_tracking)||{})[Be]||{total_minutes:0,by_operation:{}},Ne=q.daily_time_limit_minutes||0,_e=q.time_limits_by_operation||{},ke=q.enforce_time_limits!==!1,te=Ke.includes(i),me=Ge.includes(n),Oe=ke&&Ne>0&&(ve.total_minutes||0)>=Ne,We=ke&&i&&_e[i]&&(((a=ve.by_operation)==null?void 0:a[i])||0)>=_e[i],$e=!(ce||t!=null&&t.hasPremiumAccess)&&(!te||!me);l.useEffect(()=>{$e&&Qe(!0)},[$e]),l.useEffect(()=>{ee.length>0&&fe==="every_session"&&!ee.includes(i)&&be(!0)},[i,ee,fe]),l.useEffect(()=>{Te(),d(Date.now())},[i,n]),l.useEffect(()=>{if(!R){const s=setInterval(()=>{W(Math.floor((Date.now()-A)/1e3))},1e3);return()=>clearInterval(s)}},[A,R]);const ze=()=>{if(je.length<3)return null;const s=je.map(o=>o.correct_answers/o.total_questions*100),p=s.reduce((o,I)=>o+I,0)/s.length;return p>=90&&n!=="expert"?"harder":p<60&&n!=="easy"?"easier":null},Je=s=>{s==="harder"?n==="easy"?w("medium"):n==="medium"?w("hard"):n==="hard"&&w("expert"):s==="easier"&&(n==="expert"?w("hard"):n==="hard"?w("medium"):n==="medium"&&w("easy"))},Te=()=>{const s=[];for(let p=0;p<Y;p++)s.push(_t(i,n));C(s)},Se=(s,p)=>{let o=s*5;return p<60?o+=20:p<120&&(o+=10),s===Y&&(o+=30),Z.double_coins&&(o*=2),o},Ze=pt({mutationFn:async s=>{var p;if(!(t!=null&&t.email))throw new Error("User not authenticated");const o=await xt(t.email,s),I=s.coins_earned||0,M={coins:((t==null?void 0:t.coins)||0)+I,total_stars_earned:((t==null?void 0:t.total_stars_earned)||0)+(s.stars_earned||0)},G=t==null?void 0:t.active_pet;if(G){const de=((p=t==null?void 0:t.pet_experience)==null?void 0:p[G])||0,xe=s.correct_answers*10;M.pet_experience={...(t==null?void 0:t.pet_experience)||{},[G]:de+xe}}return await ut(t.email,M),o},onMutate:async s=>{await c.cancelQueries({queryKey:["gameProgress",t==null?void 0:t.email]}),await c.cancelQueries({queryKey:["recentProgress",t==null?void 0:t.email]});const p=c.getQueryData(["gameProgress",t==null?void 0:t.email])||[],o=c.getQueryData(["recentProgress",t==null?void 0:t.email])||[],I={id:"optimistic-"+Date.now(),user_email:t==null?void 0:t.email,operation:s.operation,level:s.level,score:s.score,correct_answers:s.correct_answers,total_questions:s.total_questions,time_taken:s.time_taken,stars_earned:s.stars_earned,coins_earned:s.coins_earned,completed_at:new Date};return c.setQueryData(["gameProgress",t==null?void 0:t.email],[I,...p]),c.setQueryData(["recentProgress",t==null?void 0:t.email],[I,...o].slice(0,5)),{prevProgress:p,prevRecent:o}},onError:(s,p,o)=>{o!=null&&o.prevProgress&&c.setQueryData(["gameProgress",t==null?void 0:t.email],o.prevProgress),o!=null&&o.prevRecent&&c.setQueryData(["recentProgress",t==null?void 0:t.email],o.prevRecent)},onSettled:()=>{c.invalidateQueries({queryKey:["gameProgress",t==null?void 0:t.email]}),c.invalidateQueries({queryKey:["recentProgress",t==null?void 0:t.email]}),c.invalidateQueries({queryKey:["currentUser"]})}}),Ve=s=>{const p=s===b[m].answer;if(m===Y-1){const o=[...f,{question:m,correct:p}];T(o),Pe(o);return}T([...f,{question:m,correct:p}]),p?(k(P+10),$(!0),setTimeout(()=>$(!1),1e3),setTimeout(()=>{Ce()},500)):(g({question:b[m].question,correctAnswer:b[m].answer,userAnswer:s,explanation:b[m].explanation}),J(!0))},Ce=()=>{if(m<Y-1){if(v(m+1),(m+1)%3===0){const s=ze();s&&(Le(s),ge(!0),Je(s),setTimeout(()=>{Te()},2e3))}}else Pe()},Pe=(s=null)=>{const p=Math.floor((Date.now()-A)/1e3),o=(s||f).filter(et=>et.correct).length;let I=P;Z.double_stars&&(I*=2);let M=0;const G=o/Y*100;G>=90?M=3:G>=70?M=2:G>=50&&(M=1),Z.double_stars&&M>0&&(M=Math.min(M*2,3));const de=Se(o,p),xe={addition:"Practice adding numbers accurately",subtraction:"Practice subtracting numbers accurately",multiplication:"Master multiplication facts and techniques",division:"Understand division and practice calculations",fractions:"Work with fractions - add, subtract, multiply, divide",decimals:"Practice decimal operations",percentages:"Calculate percentages",word_problems:"Apply math to real-world scenarios",money:"Work with dollars and cents",time:"Practice telling time and calculating elapsed time",geometry:"Understand shapes, area, perimeter, and volume",mixed:"Practice multiple operations"};Ze.mutate({level:n,operation:i,score:I,correct_answers:o,total_questions:Y,time_taken:p,stars_earned:M,coins_earned:de,learning_objective:xe[i]||"Mathematical problem solving"}),setTimeout(()=>{H(!0)},500)},Xe=()=>{J(!1),g(null),Ce()};if(!i||!n)return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8 text-center",children:[e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Invalid game configuration"}),e.jsx(S,{onClick:()=>u(L("Home")),children:"Go Back Home"})]});if(!te||!me){const s=!le&&(!V.includes(i)||!ie.includes(n));return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(F,{className:`border-4 ${s?"border-yellow-400 bg-gradient-to-r from-yellow-50 to-orange-50":"border-red-300"} shadow-xl`,children:e.jsx(Q,{className:"p-12 text-center",children:s?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-16 h-16 mx-auto mb-4 text-yellow-600"}),e.jsxs("div",{className:"inline-flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-6 h-6 text-yellow-600"}),e.jsx("h2",{className:"text-2xl font-bold text-yellow-700",children:"Premium Content"})]}),e.jsxs("p",{className:"text-gray-700 mb-4 font-medium",children:[!V.includes(i)&&"This math concept is available in Premium.",!ie.includes(n)&&V.includes(i)&&"This difficulty level is available in Premium."]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Upgrade to unlock 80+ math concepts and all difficulty levels!"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(S,{onClick:()=>u(L("Subscription")),className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Upgrade Now"]}),e.jsxs(S,{variant:"outline",onClick:()=>u(L("Home")),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-700",children:"Content Restricted"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:[!te&&"This math concept is currently restricted by your parent.",!me&&te&&"This difficulty level is currently restricted by your parent."]}),e.jsxs(S,{onClick:()=>u(L("Home")),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})})})})}if(Oe||We)return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(F,{className:"border-4 border-orange-300 shadow-xl",children:e.jsxs(Q,{className:"p-12 text-center",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-orange-500"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-orange-700",children:"Time Limit Reached"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You've used your allotted time for today. Great job practicing! Come back tomorrow to continue learning."}),e.jsx("div",{className:"text-sm text-gray-500 mb-6",children:"Time resets at midnight üåô"}),e.jsxs(S,{onClick:()=>u(L("Home")),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})})});if(b.length===0)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Loading your challenge..."})]})});if(R){const s=f.filter(p=>p.correct).length;return e.jsx(St,{score:P,correctAnswers:s,totalQuestions:Y,timeTaken:j,operation:i,level:n,coinsEarned:Se(s,j),activePowerUps:Z})}const Ae=(m+1)/Y*100;return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[y&&e.jsx(bt,{}),ye&&e.jsx(kt,{featureName:`${i} - ${n} Level`,description:`Unlock all math operations and difficulty levels with a premium subscription. Free users can practice ${V.join(", ")} on Easy level.`,isOpen:ye,onClose:()=>u("/")}),X&&x&&e.jsx(Ct,{question:x.question,correctAnswer:x.correctAnswer,userAnswer:x.userAnswer,explanation:x.explanation,operation:i,level:n,onContinue:Xe}),r&&e.jsx(Pt,{adjustment:He,onClose:()=>ge(!1)}),Fe&&e.jsxs(B,{className:"mb-6 bg-purple-50 border-purple-300",children:[e.jsx(Ue,{className:"w-5 h-5 text-purple-600"}),e.jsxs(O,{className:"text-purple-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Parent Suggestion:"})," Your parent recommends focusing on"," ",ee.join(", "),". Try playing those games!"]}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>be(!1),className:"ml-4 text-purple-700 hover:bg-purple-100",children:"Got it"})]})]}),e.jsx(At,{operation:i}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(S,{variant:"outline",onClick:()=>u(L("Home")),className:"gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[Object.keys(Z).length>0&&e.jsxs(z,{variant:"outline",className:"text-lg px-4 py-2 bg-yellow-50 border-yellow-300",children:[e.jsx($t,{className:"w-5 h-5 mr-2 text-yellow-500"}),"Power-Ups Active"]}),e.jsxs(z,{variant:"outline",className:"text-lg px-4 py-2 bg-white",children:[e.jsx(Ie,{className:"w-5 h-5 mr-2 text-purple-500"}),"AI Tutor Active"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-md",children:[e.jsx(re,{className:"w-5 h-5 text-blue-500"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[j,"s"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-md",children:[e.jsx(ae,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"font-bold text-gray-800",children:P})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Question ",m+1," of ",Y]}),e.jsxs("span",{children:[Math.round(Ae),"%"]})]}),e.jsx(gt,{value:Ae,className:"h-3"})]})]}),b.length>0&&e.jsx(yt,{question:b[m],onAnswer:Ve,questionNumber:m+1})]})}export{Jt as default};
