import{c as st,N as Ue,j as e,O as Y,C as q,P as _,d as D,T as ie,e as re,x as at,A as G,v as Me,y as B,h as $,Q as it,g as O,V as rt,r,I as he,J as pe,E as Ie,B as z,W as nt,b as lt,Y as ot,u as He,f as Qe,z as ct,Z as mt,_ as dt,$ as xt,K as ut}from"./index-C0XnwW1J.js";import{u as ht}from"./useMutation-BBbn5Ibo.js";import{P as pt}from"./progress-D8Mly-oi.js";import{C as gt,Q as ft}from"./CelebrationAnimation-5xmelkAl.js";import{T as k}from"./TextToSpeech-jPFv8Mzs.js";import{T as Fe}from"./target-CKjL3a7Z.js";import{C as yt}from"./coins-C3lSgozT.js";import{R as bt}from"./rotate-ccw-BY_oOohm.js";import{C as jt}from"./circle-alert-BiIT3tKc.js";import{B as Re}from"./book-open-ChO3lU0J.js";import{A as wt}from"./award-DsC9STJ2.js";import{T as Nt}from"./trending-up-Bw7UHNpS.js";import{T as vt}from"./trending-down-DyY_-Dls.js";import{L as ge}from"./lock-C1-5gGAl.js";import{T as _t}from"./triangle-alert-Dd6OicLx.js";import{g as kt}from"./QuestionGenerator-z-c728t7.js";import{P as Tt}from"./PremiumFeatureLock-DOt-wJcj.js";import{A as ae}from"./arrow-left-B1UHrOU7.js";import{Z as Ct}from"./zap-w4f_OL2g.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Ee=st("Lightbulb",St);function Pt({score:s,correctAnswers:l,totalQuestions:f,timeTaken:u,operation:M,level:o,coinsEarned:R=0,activePowerUps:n={}}){const T=Ue(),m=l/f*100;let w=0,g="",b="";return m>=90?(w=3,g="Outstanding! You're a math superstar!",b="üåü"):m>=70?(w=2,g="Great job! Keep practicing!",b="üéâ"):m>=50?(w=1,g="Good effort! Try again to improve!",b="üëç"):(w=0,g="Keep practicing! You'll get better!",b="üí™"),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(Y.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},children:e.jsxs(q,{className:"border-4 border-yellow-300 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 py-12 text-white text-center",children:[e.jsx(Y.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"text-8xl mb-4",children:b}),e.jsxs("h1",{className:"text-4xl md:text-5xl font-bold mb-2 flex items-center gap-2",children:["Challenge Complete!",e.jsx(k,{text:_("Challenge Complete!"),style:"icon",label:"Read title"})]}),e.jsxs("p",{className:"text-xl flex items-center gap-2",children:[g,e.jsx(k,{text:_(g),style:"icon",label:"Read message"})]})]}),e.jsxs(D,{className:"p-8 space-y-6",children:[" ",e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-xl",children:[e.jsx(ie,{className:"w-8 h-8 mx-auto mb-2 text-purple-500"}),e.jsxs("div",{className:"text-3xl font-bold text-purple-600 flex items-center gap-2",children:[s,e.jsx(k,{text:_(`Your score is ${s}`),style:"icon",label:"Read score"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Score"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-xl",children:[e.jsx(Fe,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsxs("div",{className:"text-3xl font-bold text-green-600 flex items-center gap-2",children:[l,"/",f,e.jsx(k,{text:_(`You got ${l} out of ${f} correct`),style:"icon",label:"Read correct answers"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Correct"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-xl",children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 flex items-center gap-2",children:[u,"s",e.jsx(k,{text:_(`Time taken: ${u} seconds`),style:"icon",label:"Read time"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Time"})]}),e.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-xl",children:[e.jsx(at,{className:"w-8 h-8 mx-auto mb-2 text-yellow-500 fill-yellow-500"}),e.jsxs("div",{className:"text-3xl font-bold text-yellow-600 flex items-center gap-2",children:[w,e.jsx(k,{text:_(`You earned ${w} stars`),style:"icon",label:"Read stars"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Stars"})]})]}),R>0&&e.jsx(q,{className:"border-2 border-cyan-300 bg-gradient-to-r from-cyan-50 to-blue-50",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center",children:e.jsx(yt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:["Coins Earned!",e.jsx(k,{text:_(`You earned ${R} coins!`),style:"icon",label:"Read coins"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use them in the shop for power-ups"})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-cyan-600 flex items-center gap-2",children:["+",R,e.jsx(k,{text:_(`Plus ${R} coins`),style:"icon",label:"Read coins"})]})]})})}),Object.keys(n).length>0&&e.jsxs(G,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(Me,{className:"w-4 h-4 text-yellow-600"}),e.jsxs(B,{className:"text-yellow-800 flex items-center gap-2",children:[e.jsx("strong",{children:"Power-ups were active!"})," Your rewards have been boosted!",e.jsx(k,{text:_("Power-ups were active! Your rewards have been boosted!"),style:"icon",label:"Read power-ups"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs($,{variant:"outline",className:"flex-1 h-14 text-lg gap-2",onClick:()=>T(O("Home")),children:[e.jsx(it,{className:"w-5 h-5"}),"Back Home"]}),e.jsxs($,{variant:"outline",className:"flex-1 h-14 text-lg gap-2",onClick:()=>window.location.reload(),children:[e.jsx(bt,{className:"w-5 h-5"}),"Try Again"]}),e.jsxs($,{className:"flex-1 h-14 text-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 gap-2",onClick:()=>T(O("Progress")),children:["View Progress",e.jsx(rt,{className:"w-5 h-5"})]})]})]})]})})})}function $t({question:s,correctAnswer:l,userAnswer:f,operation:u,level:M,onContinue:o}){const[R,n]=r.useState(!1),[T,m]=r.useState(!1),[w,g]=r.useState(""),[b,N]=r.useState(""),[C,S]=r.useState(!1),[L,P]=r.useState(null),Q=async()=>{S(!0),P(null);try{console.log("ü§ñ Generating hint for:",s),console.log("ü§ñ AI hints are currently being migrated to Firebase.");const d=`Let's think about ${s} together! Try breaking it down into smaller steps. ${u==="addition"?"Add the ones first, then the tens.":u==="subtraction"?"Remember to borrow if you need to!":u==="multiplication"?"Think about groups of the same number.":"Think about dividing into equal groups!"} You can do this! üí™`;g(d),n(!0),console.log("Tutor session (placeholder):",{question:s,correct_answer:l,user_answer:f,operation:u,level:M,hint_requested:!0,hint_text:d})}catch(d){console.error("‚ùå Error generating hint:",d),P(d.message);const y=`Let's think about ${s} together! Try breaking it down into smaller steps. ${u==="addition"?"Add the ones first, then the tens.":u==="subtraction"?"Remember to borrow if you need to!":u==="multiplication"?"Think about groups of the same number.":"Think about dividing into equal groups!"} You can do this! üí™`;g(y),n(!0)}S(!1)},F=async()=>{S(!0),P(null);try{console.log("ü§ñ Generating explanation for:",s),console.log("ü§ñ AI explanations are currently being migrated to Firebase.");const d=E(s,l,f,u);N(d),m(!0),console.log("Tutor session (placeholder):",{question:s,correct_answer:l,user_answer:f,operation:u,level:M,explanation_viewed:!0,explanation_text:d})}catch(d){console.error("‚ùå Error generating explanation:",d),P(d.message);const y=E(s,l,f,u);N(y),m(!0)}S(!1)},E=(d,y,v,j)=>{var ee,V;const K=d.split(/[\+\-\√ó√∑]/),p=parseInt(((ee=K[0])==null?void 0:ee.trim())||0),x=parseInt(((V=K[1])==null?void 0:V.trim())||0);let i=`**üìç WHERE DID I GO WRONG?**
`;return i+=`You got ${v}, but the correct answer is ${y}. Let's figure out why and learn from it!

`,i+=`**‚ú® LET'S SOLVE IT STEP-BY-STEP!**

`,j==="addition"?(i+=`1Ô∏è‚É£ Set up the problem: ${p} + ${x}
`,i+=`2Ô∏è‚É£ Add the ones place: ${p%10} + ${x%10} = ${p%10+x%10}
`,p%10+x%10>=10&&(i+=`3Ô∏è‚É£ That's ${p%10+x%10}, so we carry the 1!
`),i+=`4Ô∏è‚É£ Add the tens place: ${Math.floor(p/10)} + ${Math.floor(x/10)} ${p%10+x%10>=10?"+ 1 (carried)":""}
`,i+=`5Ô∏è‚É£ Final answer: **${y}** ‚úì

`):j==="subtraction"?(i+=`1Ô∏è‚É£ Set up the problem: ${p} - ${x}
`,i+=`2Ô∏è‚É£ Start with the ones place
`,p%10<x%10&&(i+=`3Ô∏è‚É£ We need to borrow from the tens place!
`),i+=`4Ô∏è‚É£ Subtract: ${p} - ${x}
`,i+=`5Ô∏è‚É£ Final answer: **${y}** ‚úì

`):j==="multiplication"?(i+=`1Ô∏è‚É£ Think: ${p} groups of ${x}
`,i+=`2Ô∏è‚É£ Or: ${p} √ó ${x}
`,(p>10||x>10)&&(i+=`3Ô∏è‚É£ Break it down: (${Math.floor(p/10)*10} + ${p%10}) √ó ${x}
`),i+=`4Ô∏è‚É£ Calculate: ${p} √ó ${x} = ${y}
`,i+=`5Ô∏è‚É£ Final answer: **${y}** ‚úì

`):j==="division"&&(i+=`1Ô∏è‚É£ How many ${x}s fit into ${p}?
`,i+=`2Ô∏è‚É£ Count by ${x}s until you reach ${p}
`,i+=`3Ô∏è‚É£ Check: ${y} √ó ${x} = ${p}
`,i+=`4Ô∏è‚É£ Final answer: **${y}** ‚úì

`),i+=`**üéØ THE RIGHT ANSWER**
`,i+=`${d} = **${y}** üéâ

`,i+=`**üí° QUICK TIP TO REMEMBER**
`,j==="addition"?i+=`Always start with the ones place and work your way left. Don't forget to carry!

`:j==="subtraction"?i+=`If the top number is smaller, remember to borrow from the next column!

`:j==="multiplication"?i+=`Break big numbers into smaller parts to make multiplication easier!

`:i+=`Division is the opposite of multiplication - think about groups!

`,i+=`**üèÉ PRACTICE HELPS!**
`,i+=`The more you practice ${j}, the easier it gets. You're doing great! Keep going! üí™`,i};return e.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(q,{className:"max-w-2xl w-full border-4 border-blue-300 shadow-2xl max-h-[90vh] overflow-auto",children:[e.jsx(he,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white",children:e.jsxs(pe,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(Ie,{className:"w-7 h-7"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"AI Math Tutor"}),e.jsxs(z,{variant:"secondary",className:"bg-white/20 text-white",children:[e.jsx(Me,{className:"w-3 h-3 mr-1"}),"Powered by AI"]})]}),e.jsx("p",{className:"text-sm opacity-90 font-normal mt-1",children:"Let's learn from this mistake together! üåü"})]})]})}),e.jsxs(D,{className:"p-6 space-y-6",children:[e.jsx(G,{className:"bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-200",children:e.jsx(B,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Question:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[s,e.jsx(k,{text:_(s),style:"icon",label:"Read question"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-red-500"}),"Your answer:"]}),e.jsxs(z,{variant:"outline",className:"bg-red-100 border-red-300 text-red-700 text-lg flex items-center gap-2",children:[f,e.jsx(k,{text:_(f==null?void 0:f.toString()),style:"icon",label:"Read your answer"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4 text-green-500"}),"Correct answer:"]}),e.jsxs(z,{className:"bg-green-500 text-white text-lg flex items-center gap-2",children:[l,e.jsx(k,{text:_(l==null?void 0:l.toString()),style:"icon",label:"Read correct answer"})]})]})]})})}),L&&e.jsxs(G,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(jt,{className:"w-4 h-4 text-yellow-600"}),e.jsxs(B,{className:"text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," Using fallback explanation. ",L]})]}),e.jsx("div",{children:R?e.jsx(Y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:e.jsxs(q,{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300",children:[e.jsx(he,{className:"pb-3",children:e.jsxs(pe,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Ee,{className:"w-5 h-5 text-yellow-600"}),"Hint"]})}),e.jsx(D,{children:e.jsxs("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:[w,e.jsx(k,{text:_(w),style:"icon",label:"Read hint"})]})})]})}):e.jsx($,{onClick:Q,disabled:C,className:"w-full h-16 text-lg bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-yellow-500 hover:to-orange-500 text-gray-900",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-gray-900 border-t-transparent rounded-full mr-2"}),"Thinking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-6 h-6 mr-2"}),"Get a Hint"]})})}),R&&e.jsx("div",{children:T?e.jsx(Y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:e.jsxs(q,{className:"bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-300",children:[e.jsx(he,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(pe,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Re,{className:"w-5 h-5 text-blue-600"}),"Complete Solution"]}),e.jsx(k,{text:_(b.replace(/\*\*/g,"").replace(/\n\n/g,". ").replace(/\n/g,". ")),style:"button",label:"Read entire solution"})]})}),e.jsx(D,{children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed space-y-3",children:b.split(`

`).map((d,y)=>e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("div",{className:"flex-1",children:d.split(`
`).map((v,j)=>v.startsWith("**")&&v.endsWith("**")?e.jsx("h4",{className:"font-bold text-lg mb-2 text-purple-700",children:v.replace(/\*\*/g,"")},j):/^\d+Ô∏è‚É£/.test(v)?e.jsx("div",{className:"flex gap-3 mb-2 bg-white p-2 rounded-lg",children:e.jsx("span",{className:"text-blue-600 font-bold",children:v})},j):v?e.jsx("p",{className:"mb-2",children:v},j):null)}),e.jsx(k,{text:_(d.replace(/\*\*/g,"")),style:"icon",label:"Read this section"})]})},y))})})})]})}):e.jsx($,{onClick:F,disabled:C,className:"w-full h-16 text-lg bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"}),"Generating Explanation..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-6 h-6 mr-2"}),"Show Step-by-Step Solution"]})})}),e.jsx(G,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200",children:e.jsxs(B,{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"üí™"}),e.jsx("p",{className:"font-medium text-gray-800",children:"Mistakes help us learn! Keep practicing and you'll get better every day!"})]})}),e.jsxs($,{onClick:o,className:"w-full h-14 text-lg bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:["I Understand! Continue",e.jsx(ot,{className:"w-5 h-5 ml-2"})]})]})]})})}function Lt({adjustment:s,onClose:l}){const f={easier:{icon:vt,color:"from-blue-400 to-cyan-400",title:"Let's Try Something Easier!",message:"Don't worry! I'm adjusting the difficulty to help you build confidence. You've got this! üíô",emoji:"üéØ"},harder:{icon:Nt,color:"from-purple-400 to-pink-400",title:"Level Up Challenge!",message:"Wow! You're doing amazing! Let's try some harder problems to keep you challenged! üöÄ",emoji:"‚≠ê"},perfect:{icon:wt,color:"from-yellow-400 to-orange-400",title:"Perfect Match!",message:"The difficulty is just right for you! Keep up the excellent work! üéâ",emoji:"üèÜ"}},u=f[s]||f.perfect,M=u.icon;return e.jsx(Y.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:l,children:e.jsx(Y.div,{initial:{y:-50},animate:{y:0},onClick:o=>o.stopPropagation(),children:e.jsx(q,{className:`max-w-md border-4 shadow-2xl bg-gradient-to-br ${u.color}`,children:e.jsxs(D,{className:"p-8 text-center text-white",children:[e.jsx(Y.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"text-7xl mb-4",children:u.emoji}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(M,{className:"w-6 h-6"}),e.jsx("h3",{className:"text-2xl font-bold",children:u.title})]}),e.jsx("p",{className:"text-lg opacity-95 mb-6",children:u.message}),e.jsxs(z,{className:"bg-white/20 text-white text-sm px-4 py-2",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"AI Adaptive Learning"]}),e.jsx("p",{className:"text-xs mt-4 opacity-75",children:"Click anywhere to continue"})]})})})})}function At({operation:s=null}){var F;const[l,f]=r.useState(0),[u,M]=r.useState(!1),[o,R]=r.useState(!1),{data:n,refetch:T}=He({queryKey:["currentUser"],queryFn:async()=>({email:"user@example.com",parental_controls:{},daily_usage_tracking:{}}),initialData:{email:"user@example.com",parental_controls:{},daily_usage_tracking:{}}}),m=Qe(new Date,"yyyy-MM-dd"),w=(n==null?void 0:n.parental_controls)||{},g=(n==null?void 0:n.daily_usage_tracking)||{},b=g[m]||{total_minutes:0,by_operation:{}},N=w.daily_time_limit_minutes||0,C=w.enforce_time_limits!==!1,S=w.time_limit_warning_minutes||5,L=w.time_limits_by_operation||{};if(r.useEffect(()=>{var d;if(!C||N===0)return;const E=b.total_minutes||0;f(E),E>=N?R(!0):N-E<=S&&N-E>0&&M(!0),s&&L[s]&&(((d=b.by_operation)==null?void 0:d[s])||0)>=L[s]&&R(!0)},[n,s,C,N,S,L]),r.useEffect(()=>{if(!C||o)return;const E=setInterval(async()=>{var j;const d=Math.floor((b.total_minutes||0)+.016666666666666666),y=s?Math.floor((((j=b.by_operation)==null?void 0:j[s])||0)+1/60):0,v={...g,[m]:{total_minutes:d,by_operation:{...b.by_operation||{},...s?{[s]:y}:{}}}};try{console.log("Time tracking update (placeholder):",v),await T()}catch(K){console.error("Error updating time tracking:",K)}},6e4);return()=>clearInterval(E)},[C,o,s,b,g,T]),!C||N===0)return null;const P=Math.max(0,N-l),Q=s&&L[s]?Math.max(0,L[s]-(((F=b.by_operation)==null?void 0:F[s])||0)):null;return o?e.jsxs(G,{className:"mb-6 bg-red-50 border-red-300",children:[e.jsx(ge,{className:"w-5 h-5 text-red-600"}),e.jsxs(B,{className:"text-red-800",children:[e.jsx("strong",{className:"block mb-2",children:"Time Limit Reached"}),"You've used your allotted time for today. Come back tomorrow to continue learning!",s&&Q===0&&L[s]&&e.jsxs("p",{className:"mt-2 text-sm",children:[s," time limit: ",L[s]," minutes reached"]}),e.jsx("div",{className:"mt-3 text-sm text-gray-600",children:"Time resets at midnight. See you tomorrow! üåô"})]})]}):u&&P<=S?e.jsxs(G,{className:"mb-6 bg-yellow-50 border-yellow-300",children:[e.jsx(_t,{className:"w-5 h-5 text-yellow-600"}),e.jsxs(B,{className:"text-yellow-800",children:[e.jsx("strong",{className:"block mb-2",children:"Time Running Out!"}),"You have ",e.jsxs("strong",{children:[P," minutes"]})," left to play today.",s&&Q!==null&&Q<P&&e.jsxs("p",{className:"mt-2",children:[s,": ",e.jsxs("strong",{children:[Q," minutes"]})," left"]})]})]}):e.jsxs("div",{className:"mb-4 flex items-center justify-end gap-2 text-sm text-gray-600",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsxs("span",{children:[P," minutes remaining today"]})]})}function es(){var Ae;const s=Ue(),l=ct(),f=new URLSearchParams(window.location.search),u=f.get("operation"),M=f.get("level"),[o,R]=r.useState(u),[n,T]=r.useState(M),[m,w]=r.useState(0),[g,b]=r.useState([]),[N,C]=r.useState([]),[S,L]=r.useState(0),[P,Q]=r.useState(!1),[F,E]=r.useState(Date.now()),[d,y]=r.useState(!1),[v,j]=r.useState(0),[K,p]=r.useState(!1),[x,i]=r.useState(null),[ee,V]=r.useState(!1),[Oe,Ye]=r.useState(null),[Z,Rt]=r.useState({}),[qe,fe]=r.useState(!1),[ye,De]=r.useState(!1),H=10,{user:t}=mt(),{data:be=[]}=He({queryKey:["recentProgress",t==null?void 0:t.email],queryFn:async()=>t!=null&&t.email?(await ut(t.email)).slice(0,5):[],initialData:[],enabled:!!(t!=null&&t.email)}),ne=!!(t!=null&&t.hasPremiumAccess),J=["addition","subtraction","multiplication","division","addition_single_digit","subtraction_single_digit","counting","number_comparison"],le=["easy"],I=(t==null?void 0:t.parental_controls)||{},te=I.focus_operations||[];I.focus_priority;const je=I.focus_reminder_frequency||"never",we=["addition","subtraction","multiplication","division","fractions","decimals","percentages","word_problems","money_math","time","geometry","mixed","counting","number_comparison","skip_counting_2s","skip_counting_5s","skip_counting_10s","even_odd","ordering_numbers","place_value","addition_single_digit","subtraction_single_digit"],oe=Array.isArray(I.allowed_operations)?I.allowed_operations:void 0,ce=Array.isArray(I.allowed_levels)?I.allowed_levels:void 0,me=!!(t!=null&&t._optimisticTrial||t!=null&&t.isOnTrial||t!=null&&t.inGraceDay),Ge=me?we:ne?oe&&oe.length>0?oe:we:J,Be=me?["easy","medium","hard","expert"]:ne?ce&&ce.length>0?ce:["easy","medium","hard","expert"]:le,Ke=Qe(new Date,"yyyy-MM-dd"),Ne=((t==null?void 0:t.daily_usage_tracking)||{})[Ke]||{total_minutes:0,by_operation:{}},ve=I.daily_time_limit_minutes||0,_e=I.time_limits_by_operation||{},ke=I.enforce_time_limits!==!1,se=Ge.includes(o),de=Be.includes(n),We=ke&&ve>0&&(Ne.total_minutes||0)>=ve,ze=ke&&o&&_e[o]&&(((Ae=Ne.by_operation)==null?void 0:Ae[o])||0)>=_e[o],Te=!(me||t!=null&&t.hasPremiumAccess)&&(!se||!de);r.useEffect(()=>{Te&&De(!0)},[Te]),r.useEffect(()=>{te.length>0&&je==="every_session"&&!te.includes(o)&&fe(!0)},[o,te,je]),r.useEffect(()=>{Ce(),E(Date.now())},[o,n]),r.useEffect(()=>{if(!P){const a=setInterval(()=>{j(Math.floor((Date.now()-F)/1e3))},1e3);return()=>clearInterval(a)}},[F,P]);const Ve=()=>{if(be.length<3)return null;const a=be.map(c=>c.correct_answers/c.total_questions*100),h=a.reduce((c,A)=>c+A,0)/a.length;return h>=90&&n!=="expert"?"harder":h<60&&n!=="easy"?"easier":null},Ze=a=>{a==="harder"?n==="easy"?T("medium"):n==="medium"?T("hard"):n==="hard"&&T("expert"):a==="easier"&&(n==="expert"?T("hard"):n==="hard"?T("medium"):n==="medium"&&T("easy"))},Ce=()=>{const a=[];for(let h=0;h<H;h++)a.push(kt(o,n));b(a)},Se=(a,h)=>{let c=a*5;return h<60?c+=20:h<120&&(c+=10),a===H&&(c+=30),Z.double_coins&&(c*=2),c},Je=ht({mutationFn:async a=>{var W;if(!(t!=null&&t.email))throw new Error("User not authenticated");const h=await dt(t.email,a),c=a.coins_earned||0,X={coins:((t==null?void 0:t.coins)||0)+c,total_stars_earned:((t==null?void 0:t.total_stars_earned)||0)+(a.stars_earned||0)},U=t==null?void 0:t.active_pet;if(U){const xe=((W=t==null?void 0:t.pet_experience)==null?void 0:W[U])||0,ue=a.correct_answers*10;X.pet_experience={...(t==null?void 0:t.pet_experience)||{},[U]:xe+ue}}return await xt(t.email,X),h},onMutate:async a=>{await l.cancelQueries({queryKey:["gameProgress",t==null?void 0:t.email]}),await l.cancelQueries({queryKey:["recentProgress",t==null?void 0:t.email]});const h=l.getQueryData(["gameProgress",t==null?void 0:t.email])||[],c=l.getQueryData(["recentProgress",t==null?void 0:t.email])||[],A={id:"optimistic-"+Date.now(),user_email:t==null?void 0:t.email,operation:a.operation,level:a.level,score:a.score,correct_answers:a.correct_answers,total_questions:a.total_questions,time_taken:a.time_taken,stars_earned:a.stars_earned,coins_earned:a.coins_earned,completed_at:new Date};return l.setQueryData(["gameProgress",t==null?void 0:t.email],[A,...h]),l.setQueryData(["recentProgress",t==null?void 0:t.email],[A,...c].slice(0,5)),{prevProgress:h,prevRecent:c}},onError:(a,h,c)=>{c!=null&&c.prevProgress&&l.setQueryData(["gameProgress",t==null?void 0:t.email],c.prevProgress),c!=null&&c.prevRecent&&l.setQueryData(["recentProgress",t==null?void 0:t.email],c.prevRecent)},onSettled:()=>{l.invalidateQueries({queryKey:["gameProgress",t==null?void 0:t.email]}),l.invalidateQueries({queryKey:["recentProgress",t==null?void 0:t.email]}),l.invalidateQueries({queryKey:["currentUser"]})}}),Xe=a=>{const h=a===g[m].answer;if(m===H-1){const A=[...N,{question:m,correct:h}];C(A),$e(A);return}C([...N,{question:m,correct:h}]),h?(L(S+10),y(!0),setTimeout(()=>y(!1),1e3),setTimeout(()=>{Pe()},500)):(i({question:g[m].question,correctAnswer:g[m].answer,userAnswer:a,explanation:g[m].explanation}),p(!0))},Pe=()=>{if(m<H-1){if(w(m+1),(m+1)%3===0){const a=Ve();a&&(Ye(a),V(!0),Ze(a),setTimeout(()=>{Ce()},2e3))}}else $e()},$e=(a=null)=>{const h=Math.floor((Date.now()-F)/1e3),A=(a||N).filter(tt=>tt.correct).length;let X=S;Z.double_stars&&(X*=2);let U=0;const W=A/H*100;W>=90?U=3:W>=70?U=2:W>=50&&(U=1),Z.double_stars&&U>0&&(U=Math.min(U*2,3));const xe=Se(A,h),ue={addition:"Practice adding numbers accurately",subtraction:"Practice subtracting numbers accurately",multiplication:"Master multiplication facts and techniques",division:"Understand division and practice calculations",fractions:"Work with fractions - add, subtract, multiply, divide",decimals:"Practice decimal operations",percentages:"Calculate percentages",word_problems:"Apply math to real-world scenarios",money:"Work with dollars and cents",time:"Practice telling time and calculating elapsed time",geometry:"Understand shapes, area, perimeter, and volume",mixed:"Practice multiple operations"};Je.mutate({level:n,operation:o,score:X,correct_answers:A,total_questions:H,time_taken:h,stars_earned:U,coins_earned:xe,learning_objective:ue[o]||"Mathematical problem solving"}),setTimeout(()=>{Q(!0)},500)},et=()=>{p(!1),i(null),Pe()};if(!o||!n)return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8 text-center",children:[e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Invalid game configuration"}),e.jsx($,{onClick:()=>s(O("Home")),children:"Go Back Home"})]});if(!se||!de){const a=!ne&&(!J.includes(o)||!le.includes(n));return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(q,{className:`border-4 ${a?"border-yellow-400 bg-gradient-to-r from-yellow-50 to-orange-50":"border-red-300"} shadow-xl`,children:e.jsx(D,{className:"p-12 text-center",children:a?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-16 h-16 mx-auto mb-4 text-yellow-600"}),e.jsxs("div",{className:"inline-flex items-center gap-2 mb-2",children:[e.jsx(ie,{className:"w-6 h-6 text-yellow-600"}),e.jsx("h2",{className:"text-2xl font-bold text-yellow-700",children:"Premium Content"})]}),e.jsxs("p",{className:"text-gray-700 mb-4 font-medium",children:[!J.includes(o)&&"This math concept is available in Premium.",!le.includes(n)&&J.includes(o)&&"This difficulty level is available in Premium."]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Upgrade to unlock 80+ math concepts and all difficulty levels!"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs($,{onClick:()=>s(O("Subscription")),className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Upgrade Now"]}),e.jsxs($,{variant:"outline",onClick:()=>s(O("Home")),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-700",children:"Content Restricted"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:[!se&&"This math concept is currently restricted by your parent.",!de&&se&&"This difficulty level is currently restricted by your parent."]}),e.jsxs($,{onClick:()=>s(O("Home")),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})})})})}if(We||ze)return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(q,{className:"border-4 border-orange-300 shadow-xl",children:e.jsxs(D,{className:"p-12 text-center",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-orange-500"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-orange-700",children:"Time Limit Reached"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You've used your allotted time for today. Great job practicing! Come back tomorrow to continue learning."}),e.jsx("div",{className:"text-sm text-gray-500 mb-6",children:"Time resets at midnight üåô"}),e.jsxs($,{onClick:()=>s(O("Home")),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})})});if(g.length===0)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Loading your challenge..."})]})});if(P){const a=N.filter(h=>h.correct).length;return e.jsx(Pt,{score:S,correctAnswers:a,totalQuestions:H,timeTaken:v,operation:o,level:n,coinsEarned:Se(a,v),activePowerUps:Z})}const Le=(m+1)/H*100;return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[d&&e.jsx(gt,{}),ye&&e.jsx(Tt,{featureName:`${o} - ${n} Level`,description:`Unlock all math operations and difficulty levels with a premium subscription. Free users can practice ${J.join(", ")} on Easy level.`,isOpen:ye,onClose:()=>s("/")}),K&&x&&e.jsx($t,{question:x.question,correctAnswer:x.correctAnswer,userAnswer:x.userAnswer,explanation:x.explanation,operation:o,level:n,onContinue:et}),ee&&e.jsx(Lt,{adjustment:Oe,onClose:()=>V(!1)}),qe&&e.jsxs(G,{className:"mb-6 bg-purple-50 border-purple-300",children:[e.jsx(Fe,{className:"w-5 h-5 text-purple-600"}),e.jsxs(B,{className:"text-purple-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Parent Suggestion:"})," Your parent recommends focusing on"," ",te.join(", "),". Try playing those games!"]}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>fe(!1),className:"ml-4 text-purple-700 hover:bg-purple-100",children:"Got it"})]})]}),e.jsx(At,{operation:o}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs($,{variant:"outline",onClick:()=>s(O("Home")),className:"gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[Object.keys(Z).length>0&&e.jsxs(z,{variant:"outline",className:"text-lg px-4 py-2 bg-yellow-50 border-yellow-300",children:[e.jsx(Ct,{className:"w-5 h-5 mr-2 text-yellow-500"}),"Power-Ups Active"]}),e.jsxs(z,{variant:"outline",className:"text-lg px-4 py-2 bg-white",children:[e.jsx(Ie,{className:"w-5 h-5 mr-2 text-purple-500"}),"AI Tutor Active"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-md",children:[e.jsx(re,{className:"w-5 h-5 text-blue-500"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[v,"s"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-md",children:[e.jsx(ie,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"font-bold text-gray-800",children:S})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Question ",m+1," of ",H]}),e.jsxs("span",{children:[Math.round(Le),"%"]})]}),e.jsx(pt,{value:Le,className:"h-3"})]})]}),g.length>0&&e.jsx(ft,{question:g[m],onAnswer:Xe,questionNumber:m+1})]})}export{es as default};
