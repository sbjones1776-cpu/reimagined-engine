import{b as ce,E as A,aL as pe,F as ge,a2 as ue,D as oe,x as e,ab as ye,a as b,T as _,J as Q,a4 as z,o as Y,q as L,O,l as M,s as J,S as X,h as P,W as f,u as le,i as I,A as E,L as he,M as xe,ah as je,ai as ve,f as be,Y as Z,aa as $,aF as ee,aM as _e,Z as fe}from"./index-Duhpx7eq.js";import{T as V}from"./useMutation-Dw-sPjxD-CEUn9Yuu-xvhDPSZb-Dr0QtMK_-BVesU6qw.js";import{H as ae,L as re,P as v,G as q}from"./tabs-BCUfDdd3-DRpA79_--UQJ3H5nI-BCygjE_3-CERtGQAZ.js";import we from"./PetDisplay-T8ztPqrq-CgXjoFIZ-CN-awV62-B0Vb4HvE-C7wsuJWC.js";import{o as K}from"./lock-DVJmOJtR-CPCpectf-CAbDyxwB-CjKaN8Uy-DSiTgkC1.js";import{h as se}from"./gift-gU3fLUyU-xa62twJ2-CA8s9oVC-2bqbjn29-DymLulGz.js";import{b as Ne}from"./PremiumFeatureLock-DUuDI_YH-C25OdOdH-ABaij4QQ-D0Avu4LI-BPEWt9vX.js";import{e as ke}from"./palette-C1tdbQoO-D9zv_SnR-dpSQlzRX-CX9NrSmo-CXa-mNyE.js";import{o as Se}from"./zap-BUGd4PS--D5Rx8Je6-38BwrXim-CvVM-oS5-D5MMr3dA.js";import"./progress-DswiN-jt-CRkTvpyk-D1KYlrjl-CsboKJzw-C3ozQzG_.js";function te(i,c){const o=ee(i),t=ee(c),u=ie(o,t),S=Math.abs(_e(o,t));o.setDate(o.getDate()-u*S);const D=+(ie(o,t)===-u),C=u*(S-D);return C===0?0:C}function ie(i,c){const o=i.getFullYear()-c.getFullYear()||i.getMonth()-c.getMonth()||i.getDate()-c.getDate()||i.getHours()-c.getHours()||i.getMinutes()-c.getMinutes()||i.getSeconds()-c.getSeconds()||i.getMilliseconds()-c.getMilliseconds();return o<0?-1:o>0?1:o}function De({badge:i,size:c="medium"}){if(!i)return null;const o={small:"w-8 h-8 text-lg",medium:"w-12 h-12 text-2xl",large:"w-20 h-20 text-4xl"},t=o[c]||o.medium,u=i.emoji==="ğŸ®";return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:`${t} rounded-full bg-gradient-to-br ${i.gradient} flex items-center justify-center shadow-lg border-2 border-white`,children:u?e.jsx(le,{size:c==="large"?"md":c==="small"?"xs":"sm",variant:"plain"}):e.jsx("span",{children:i.emoji})}),c!=="small"&&e.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 whitespace-nowrap",children:e.jsx(P,{variant:"outline",className:"text-xs bg-white",children:i.name})})]})}const ne=[{day:1,stars:5,coins:20,emoji:"ğŸ"},{day:2,stars:5,coins:25,emoji:"â­"},{day:3,stars:10,coins:30,emoji:"ğŸ’"},{day:4,stars:10,coins:35,emoji:"ğŸ¯"},{day:5,stars:15,coins:50,emoji:"ğŸ†"},{day:6,stars:15,coins:60,emoji:"ğŸ‘‘"},{day:7,stars:25,coins:100,emoji:"ğŸ‰",special:"Bonus Pet Food!"}];function Ce(){const i=ce(),[c,o]=A.useState(!1),{data:t}=oe({queryKey:["currentUser"],queryFn:async()=>({email:"user@example.com",coins:0,daily_login_streak:0,total_login_days:0,last_login_date:null,active_pet:null,pet_experience:{}}),initialData:{email:"user@example.com",coins:0,daily_login_streak:0,total_login_days:0,last_login_date:null,active_pet:null,pet_experience:{}}}),u=V({mutationFn:async()=>{var l;const m=I(E(new Date),"yyyy-MM-dd"),y=((t==null?void 0:t.daily_login_streak)||0)+1,h=(y-1)%7+1,U=ne[h-1],N={last_login_date:m,daily_login_streak:y,total_login_days:((t==null?void 0:t.total_login_days)||0)+1,coins:((t==null?void 0:t.coins)||0)+U.coins};if(h===7&&t!=null&&t.active_pet){const a=((l=t==null?void 0:t.pet_experience)==null?void 0:l[t.active_pet])||0;N.pet_experience={...(t==null?void 0:t.pet_experience)||{},[t.active_pet]:a+200}}const F=he(xe);await je(ve(F,"users",t.email),N,{merge:!0})},onSuccess:()=>{i.invalidateQueries({queryKey:["currentUser"]}),o(!0),setTimeout(()=>o(!1),3e3)}}),S=()=>{if(!t)return!1;const l=I(E(new Date),"yyyy-MM-dd"),m=t.last_login_date;if(!m)return!0;if(m===l)return!1;const y=new Date(m),h=E(new Date);return te(h,y)===1},D=()=>{if(!(t!=null&&t.last_login_date))return!1;const l=new Date(t.last_login_date),m=E(new Date);return te(m,l)>1},C=()=>t!=null&&t.daily_login_streak?(t.daily_login_streak-1)%7+1:1,H=()=>{if(!(t!=null&&t.last_login_date))return!1;const l=I(E(new Date),"yyyy-MM-dd");return t.last_login_date===l},T=(t==null?void 0:t.daily_login_streak)||0,r=C(),B=H(),w=D();return e.jsxs(b,{className:"border-4 border-purple-300 shadow-xl bg-gradient-to-br from-purple-50 to-pink-50",children:[e.jsx(J,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white",children:e.jsxs(X,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-6 h-6"}),e.jsx("span",{children:"Daily Login Rewards"})]}),e.jsxs(P,{className:"bg-white text-purple-600 font-bold",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),T," Day Streak"]})]})}),e.jsxs(_,{className:"p-6",children:[c&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border-2 border-green-300 rounded-xl animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-4xl",children:"ğŸ‰"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-green-800",children:"Reward Claimed!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Come back tomorrow for more rewards!"})]})]})}),w&&e.jsx("div",{className:"mb-4 p-4 bg-orange-50 border-2 border-orange-300 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-3xl",children:"ğŸ˜¢"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-orange-800",children:"Streak Reset!"}),e.jsx("p",{className:"text-sm text-orange-700",children:"You missed a day. Start a new streak today!"})]})]})}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-6",children:ne.map((l,m)=>{const y=m+1,h=y===r,U=!w&&T>=y,N=B&&y===r;return e.jsxs("div",{className:`relative p-3 rounded-xl text-center transition-all ${N?"bg-green-100 border-2 border-green-400 scale-105":h&&!B?"bg-purple-100 border-2 border-purple-400 scale-105 animate-pulse":U?"bg-gray-100 border-2 border-gray-300":"bg-white border-2 border-gray-200 opacity-60"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:l.emoji}),e.jsxs("div",{className:"text-xs font-bold mb-1",children:["Day ",y]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs",children:[e.jsx(Q,{className:"w-3 h-3 text-yellow-500 fill-yellow-500"}),e.jsx("span",{children:l.stars})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xs",children:[e.jsx(z,{className:"w-3 h-3 text-blue-500"}),e.jsx("span",{children:l.coins})]})]}),N&&e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 fill-green-100"})}),!h&&!U&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 rounded-xl",children:e.jsx(K,{className:"w-4 h-4 text-gray-500"})}),l.special&&h&&e.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 whitespace-nowrap",children:e.jsx(P,{className:"bg-orange-500 text-white text-xs",children:l.special})})]},y)})}),e.jsxs("div",{className:"space-y-3",children:[B?e.jsxs("div",{className:"text-center p-4 bg-green-50 border-2 border-green-200 rounded-xl",children:[e.jsx(Z,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsx("p",{className:"font-bold text-green-800",children:"Already claimed today!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Come back tomorrow for more rewards"})]}):w?e.jsxs(f,{onClick:()=>u.mutate(),disabled:u.isPending,className:"w-full h-14 text-lg bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600",children:[e.jsx(se,{className:"w-5 h-5 mr-2"}),"Start New Streak & Claim Day 1"]}):e.jsxs(f,{onClick:()=>u.mutate(),disabled:!S()||u.isPending,className:"w-full h-14 text-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(se,{className:"w-5 h-5 mr-2"}),"Claim Day ",r," Reward"]}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["ğŸ† Total Login Days: ",e.jsx("strong",{children:(t==null?void 0:t.total_login_days)||0})]}),e.jsx("p",{className:"mt-1",children:"ğŸ’¡ Log in every day to keep your streak and earn bigger rewards!"})]})]})]})]})}const de=(i=[])=>i.reduce((c,o)=>c+(o.stars_earned||0),0),Pe=(i=[],c)=>{const o=de(i),t=(c==null?void 0:c.stars_spent)||0;return o-t},W=i=>(i==null?void 0:i.coins)||0,G={pets:[{id:"dragon",name:"Dragon",emoji:"ğŸ‰",price:50,gradient:"from-red-400 to-orange-500",evolveLevel:5,description:"Breathe fire and soar!",premium:!0},{id:"unicorn",name:"Unicorn",emoji:"ğŸ¦„",price:50,gradient:"from-pink-400 to-purple-500",evolveLevel:5,description:"Magical and sparkly!",premium:!0},{id:"owl",name:"Owl",emoji:"ğŸ¦‰",price:50,gradient:"from-indigo-400 to-purple-500",evolveLevel:5,description:"Wise and clever!"},{id:"fox",name:"Fox",emoji:"ğŸ¦Š",price:50,gradient:"from-orange-400 to-red-500",evolveLevel:5,description:"Cunning and quick!"},{id:"cat",name:"Cat",emoji:"ğŸ±",price:50,gradient:"from-gray-400 to-slate-500",evolveLevel:5,description:"Playful and curious!"},{id:"dog",name:"Dog",emoji:"ğŸ¶",price:50,gradient:"from-yellow-400 to-orange-500",evolveLevel:5,description:"Loyal and friendly!"}],avatarItems:[{id:"curly",name:"Curly Hair",emoji:"ğŸ¦±",price:20,category:"hair",type:"avatar_hair_style"},{id:"spiky",name:"Spiky Hair",emoji:"âš¡",price:20,category:"hair",type:"avatar_hair_style"},{id:"ponytail",name:"Ponytail",emoji:"ğŸ€",price:25,category:"hair",type:"avatar_hair_style"},{id:"braids",name:"Braids",emoji:"ğŸ§µ",price:25,category:"hair",type:"avatar_hair_style"},{id:"afro",name:"Afro",emoji:"ğŸŒ€",price:30,category:"hair",type:"avatar_hair_style"},{id:"mohawk",name:"Mohawk",emoji:"ğŸ”¥",price:30,category:"hair",type:"avatar_hair_style"},{id:"bun",name:"Bun",emoji:"ğŸ”",price:25,category:"hair",type:"avatar_hair_style"},{id:"red",name:"Red Hair",emoji:"â¤ï¸",price:15,category:"hair",type:"avatar_hair_color"},{id:"blue",name:"Blue Hair",emoji:"ğŸ’™",price:15,category:"hair",type:"avatar_hair_color"},{id:"pink",name:"Pink Hair",emoji:"ğŸ’—",price:15,category:"hair",type:"avatar_hair_color"},{id:"purple",name:"Purple Hair",emoji:"ğŸ’œ",price:15,category:"hair",type:"avatar_hair_color"},{id:"green",name:"Green Hair",emoji:"ğŸ’š",price:15,category:"hair",type:"avatar_hair_color"},{id:"orange",name:"Orange Hair",emoji:"ğŸ§¡",price:15,category:"hair",type:"avatar_hair_color"},{id:"white",name:"White Hair",emoji:"ğŸ¤",price:20,category:"hair",type:"avatar_hair_color",premium:!0},{id:"rainbow",name:"Rainbow Hair",emoji:"ğŸŒˆ",price:40,category:"hair",type:"avatar_hair_color",premium:!0},{id:"hoodie",name:"Hoodie",emoji:"ğŸ§¥",price:30,category:"clothing",type:"avatar_shirt"},{id:"tank_top",name:"Tank Top",emoji:"ğŸ‘™",price:25,category:"clothing",type:"avatar_shirt"},{id:"sweater",name:"Sweater",emoji:"ğŸ§¶",price:30,category:"clothing",type:"avatar_shirt"},{id:"jersey",name:"Jersey",emoji:"âš½",price:35,category:"clothing",type:"avatar_shirt"},{id:"button_up",name:"Button Up",emoji:"ğŸ‘”",price:35,category:"clothing",type:"avatar_shirt"},{id:"graphic_tee",name:"Graphic Tee",emoji:"ğŸ¨",price:30,category:"clothing",type:"avatar_shirt"},{id:"t_shirt_stripe",name:"Striped Tee",emoji:"ğŸ‘”",price:25,category:"clothing",type:"avatar_shirt"},{id:"polo",name:"Polo Shirt",emoji:"ğŸ‘•",price:30,category:"clothing",type:"avatar_shirt"},{id:"shorts",name:"Shorts",emoji:"ğŸ©³",price:25,category:"clothing",type:"avatar_pants"},{id:"skirt",name:"Skirt",emoji:"ğŸ‘—",price:25,category:"clothing",type:"avatar_pants"},{id:"dress_pants",name:"Dress Pants",emoji:"ğŸ‘”",price:30,category:"clothing",type:"avatar_pants"},{id:"joggers",name:"Joggers",emoji:"ğŸƒ",price:30,category:"clothing",type:"avatar_pants"},{id:"overalls",name:"Overalls",emoji:"ğŸ‘–",price:35,category:"clothing",type:"avatar_pants"},{id:"leggings",name:"Leggings",emoji:"ğŸ©±",price:25,category:"clothing",type:"avatar_pants"},{id:"cargo_pants",name:"Cargo Pants",emoji:"ğŸ’",price:30,category:"clothing",type:"avatar_pants"},{id:"boots",name:"Boots",emoji:"ğŸ¥¾",price:30,category:"clothing",type:"avatar_shoes"},{id:"sandals",name:"Sandals",emoji:"ğŸ©´",price:20,category:"clothing",type:"avatar_shoes"},{id:"dress_shoes",name:"Dress Shoes",emoji:"ğŸ‘",price:35,category:"clothing",type:"avatar_shoes"},{id:"high_tops",name:"High Tops",emoji:"ğŸ‘Ÿ",price:35,category:"clothing",type:"avatar_shoes"},{id:"cleats",name:"Cleats",emoji:"âš½",price:35,category:"clothing",type:"avatar_shoes"},{id:"slippers",name:"Slippers",emoji:"ğŸ©´",price:20,category:"clothing",type:"avatar_shoes"},{id:"baseball_cap",name:"Baseball Cap",emoji:"ğŸ§¢",price:25,category:"accessories",type:"avatar_hat"},{id:"beanie",name:"Beanie",emoji:"ğŸ©",price:25,category:"accessories",type:"avatar_hat"},{id:"sun_hat",name:"Sun Hat",emoji:"ğŸ‘’",price:25,category:"accessories",type:"avatar_hat"},{id:"wizard_hat",name:"Wizard Hat",emoji:"ğŸ§™",price:40,category:"accessories",type:"avatar_hat"},{id:"party_hat",name:"Party Hat",emoji:"ğŸ‰",price:30,category:"accessories",type:"avatar_hat"},{id:"graduation_cap",name:"Graduation Cap",emoji:"ğŸ“",price:35,category:"accessories",type:"avatar_hat"},{id:"crown",name:"Crown",emoji:"ğŸ‘‘",price:50,category:"accessories",type:"avatar_hat"},{id:"top_hat",name:"Top Hat",emoji:"ğŸ©",price:35,category:"accessories",type:"avatar_hat"},{id:"cowboy_hat",name:"Cowboy Hat",emoji:"ğŸ¤ ",price:30,category:"accessories",type:"avatar_hat"},{id:"regular",name:"Glasses",emoji:"ğŸ‘“",price:25,category:"accessories",type:"avatar_glasses"},{id:"sunglasses",name:"Sunglasses",emoji:"ğŸ˜",price:30,category:"accessories",type:"avatar_glasses"},{id:"reading",name:"Reading Glasses",emoji:"ğŸ¤“",price:25,category:"accessories",type:"avatar_glasses"},{id:"safety_goggles",name:"Safety Goggles",emoji:"ğŸ¥½",price:30,category:"accessories",type:"avatar_glasses"},{id:"3d_glasses",name:"3D Glasses",emoji:"ğŸ•¶ï¸",price:30,category:"accessories",type:"avatar_glasses"},{id:"heart_shaped",name:"Heart Glasses",emoji:"ğŸ˜",price:35,category:"accessories",type:"avatar_glasses"},{id:"star_shaped",name:"Star Glasses",emoji:"ğŸ¤©",price:35,category:"accessories",type:"avatar_glasses"},{id:"backpack",name:"Backpack",emoji:"ğŸ’",price:30,category:"accessories",type:"avatar_accessory"},{id:"cape",name:"Cape",emoji:"ğŸ¦¸",price:40,category:"accessories",type:"avatar_accessory"},{id:"scarf",name:"Scarf",emoji:"ğŸ§£",price:25,category:"accessories",type:"avatar_accessory"},{id:"bow_tie",name:"Bow Tie",emoji:"ğŸ€",price:25,category:"accessories",type:"avatar_accessory"},{id:"necklace",name:"Necklace",emoji:"ğŸ“¿",price:30,category:"accessories",type:"avatar_accessory"},{id:"watch",name:"Watch",emoji:"âŒš",price:35,category:"accessories",type:"avatar_accessory"},{id:"headphones",name:"Headphones",emoji:"ğŸ§",price:35,category:"accessories",type:"avatar_accessory"},{id:"earrings",name:"Earrings",emoji:"ğŸ’",price:30,category:"accessories",type:"avatar_accessory"},{id:"bracelet",name:"Bracelet",emoji:"ğŸ“¿",price:25,category:"accessories",type:"avatar_accessory"},{id:"stars",name:"Starry Background",emoji:"â­",price:40,category:"backgrounds",type:"avatar_background"},{id:"rainbow",name:"Rainbow Background",emoji:"ğŸŒˆ",price:40,category:"backgrounds",type:"avatar_background"},{id:"clouds",name:"Cloudy Background",emoji:"â˜ï¸",price:35,category:"backgrounds",type:"avatar_background"},{id:"space",name:"Space Background",emoji:"ğŸš€",price:45,category:"backgrounds",type:"avatar_background"},{id:"underwater",name:"Underwater Background",emoji:"ğŸŒŠ",price:45,category:"backgrounds",type:"avatar_background"},{id:"forest",name:"Forest Background",emoji:"ğŸŒ²",price:40,category:"backgrounds",type:"avatar_background"},{id:"city",name:"City Background",emoji:"ğŸ™ï¸",price:40,category:"backgrounds",type:"avatar_background"},{id:"beach",name:"Beach Background",emoji:"ğŸ–ï¸",price:40,category:"backgrounds",type:"avatar_background"},{id:"cool",name:"Cool Eyes",emoji:"ğŸ˜",price:20,category:"facial",type:"avatar_eyes"},{id:"star",name:"Star Eyes",emoji:"ğŸ¤©",price:25,category:"facial",type:"avatar_eyes"},{id:"heart",name:"Heart Eyes",emoji:"ğŸ˜",price:25,category:"facial",type:"avatar_eyes"},{id:"sleepy",name:"Sleepy Eyes",emoji:"ğŸ˜´",price:20,category:"facial",type:"avatar_eyes"},{id:"angry",name:"Determined Eyes",emoji:"ğŸ˜ ",price:20,category:"facial",type:"avatar_eyes"},{id:"surprised",name:"Surprised Eyes",emoji:"ğŸ˜²",price:20,category:"facial",type:"avatar_eyes"},{id:"wink",name:"Winking Eyes",emoji:"ğŸ˜‰",price:25,category:"facial",type:"avatar_eyes"},{id:"laughing",name:"Laughing Face",emoji:"ğŸ˜†",price:20,category:"facial",type:"avatar_face"},{id:"determined",name:"Determined Face",emoji:"ğŸ˜¤",price:20,category:"facial",type:"avatar_face"},{id:"neutral",name:"Neutral Face",emoji:"ğŸ˜",price:15,category:"facial",type:"avatar_face"},{id:"tongue_out",name:"Playful Face",emoji:"ğŸ˜›",price:20,category:"facial",type:"avatar_face"}],badges:[{id:"first_game",name:"First Game",emoji:"ğŸ®",gradient:"from-green-400 to-emerald-500",description:"Completed your first game!",requirement:"Play 1 game",isAppIcon:!0},{id:"star_collector",name:"Star Collector",emoji:"â­",gradient:"from-yellow-400 to-orange-500",description:"Earned 50 stars!",requirement:"Earn 50 stars"},{id:"speed_demon",name:"Speed Demon",emoji:"âš¡",gradient:"from-blue-400 to-cyan-500",description:"Complete a game in under 60 seconds",requirement:"Complete game < 60s"},{id:"perfectionist",name:"Perfectionist",emoji:"ğŸ’¯",gradient:"from-pink-400 to-purple-500",description:"Get 100% accuracy",requirement:"100% accuracy"},{id:"daily_warrior",name:"Daily Warrior",emoji:"ğŸ—“ï¸",gradient:"from-red-400 to-orange-500",description:"Complete 7 daily challenges",requirement:"7 daily challenges"}],powerUps:[{id:"time_freeze",name:"Time Freeze",emoji:"â°",price:10,coins:!0,description:"Stop the timer for 10 seconds"},{id:"hint_helper",name:"Hint Helper",emoji:"ğŸ’¡",price:5,coins:!0,description:"Get a hint on a problem"},{id:"skip_question",name:"Skip Question",emoji:"â­ï¸",price:8,coins:!0,description:"Skip one difficult question"},{id:"double_stars",name:"Double Stars",emoji:"â­â­",price:15,coins:!0,description:"Earn 2x stars for next game"}]};function $e(){const i=ce(),[c,o]=A.useState(null),[t,u]=A.useState("pets"),[S,D]=A.useState(!1),[C,H]=A.useState(null),{toast:T}=pe(),{user:r,loading:B}=ge(),{user:w}=ue(),{data:l=[]}=oe({queryKey:["gameProgress",r==null?void 0:r.email],queryFn:()=>fe(r.email),enabled:!!(r!=null&&r.email)}),m=V({mutationFn:async({itemId:a,price:s,type:n,coins:p})=>{if(!(r!=null&&r.email))throw new Error("Not signed in");const x=l.reduce((j,me)=>j+(me.stars_earned||0),0),k=(r==null?void 0:r.stars_spent)||0,R=x-k,d=(r==null?void 0:r.coins)||0;if(p){if(d<s)throw new Error("Not enough coins");const j={...r.power_ups||{}};j[a]=(j[a]||0)+1,await $(r.email,{coins:d-s,power_ups:j});return}if(R<s)throw new Error("Not enough stars");if(n==="pet"){const j=new Set((r==null?void 0:r.owned_pets)||[]);j.has(a)||j.add(a),await $(r.email,{stars_spent:k+s,owned_pets:Array.from(j)});return}const g=new Set((r==null?void 0:r.unlocked_items)||[]);g.has(a)||g.add(a),await $(r.email,{stars_spent:k+s,unlocked_items:Array.from(g)})},onMutate:async a=>{await i.cancelQueries({queryKey:["currentUser"]}),await i.cancelQueries({queryKey:["gameProgress",r==null?void 0:r.email]});const s=i.getQueryData(["currentUser"]),n=i.getQueryData(["gameProgress",r==null?void 0:r.email]);if(!s)return{prevUser:s,prevProgress:n};const{itemId:p,price:x,type:k,coins:R}=a,d={...s};if(R){d.coins=(d.coins||0)-x,d.coins<0&&(d.coins=0);const g={...d.power_ups||{}};g[p]=(g[p]||0)+1,d.power_ups=g}else if(k==="pet"){d.stars_spent=(d.stars_spent||0)+x;const g=new Set(d.owned_pets||[]);g.add(p),d.owned_pets=Array.from(g)}else{d.stars_spent=(d.stars_spent||0)+x;const g=new Set(d.unlocked_items||[]);g.add(p),d.unlocked_items=Array.from(g)}return i.setQueryData(["currentUser"],d),{prevUser:s,prevProgress:n}},onError:(a,s,n)=>{n!=null&&n.prevUser&&i.setQueryData(["currentUser"],n.prevUser),T({title:"Purchase Failed",description:a.message.includes("Not enough")?a.message:"Could not complete purchase."})},onSuccess:()=>{o(!0),setTimeout(()=>o(!1),2500)},onSettled:()=>{i.invalidateQueries({queryKey:["currentUser"]}),i.invalidateQueries({queryKey:["gameProgress",r==null?void 0:r.email]})}}),y=V({mutationFn:async a=>{if(!(r!=null&&r.email))throw new Error("Not signed in");if(!new Set((r==null?void 0:r.owned_pets)||[]).has(a))throw new Error("Pet not owned");await $(r.email,{active_pet:a})},onMutate:async a=>{await i.cancelQueries({queryKey:["currentUser"]});const s=i.getQueryData(["currentUser"]);if(!s)return{prevUser:s};const n={...s};return new Set(n.owned_pets||[]).has(a)&&(n.active_pet=a,i.setQueryData(["currentUser"],n)),{prevUser:s}},onError:(a,s,n)=>{n!=null&&n.prevUser&&i.setQueryData(["currentUser"],n.prevUser)},onSettled:()=>{i.invalidateQueries({queryKey:["currentUser"]})}}),h=(a,s="avatar",n=!1)=>{m.mutate({itemId:a.id,price:a.price,type:s,coins:n})},U=a=>{y.mutate(a)},N=(a,s="avatar")=>s==="pet"?((r==null?void 0:r.owned_pets)||[]).includes(a):((r==null?void 0:r.unlocked_items)||[]).includes(a)||((r==null?void 0:r.purchased_items)||[]).includes(a),F=()=>Pe(l,r);return B?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Loading shop..."})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[S&&e.jsx(Ne,{featureName:(C==null?void 0:C.name)||"Premium Item",description:"This exclusive item is available to premium subscribers. Upgrade to unlock all premium pets, avatar items, and more!",isOpen:S,onClose:()=>{D(!1),H(null)}}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-block mb-4",children:e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-xl",children:e.jsx(ye,{className:"w-10 h-10 text-white"})})}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent",children:"Rewards Shop"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Spend your stars and coins on awesome items!"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-8",children:[e.jsx(b,{className:"border-4 border-yellow-300 bg-gradient-to-r from-yellow-50 to-orange-50",children:e.jsxs(_,{className:"p-6 text-center",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto mb-2 text-yellow-500 fill-yellow-500"}),e.jsx("div",{className:"text-4xl font-bold text-yellow-600 mb-1",children:F()}),e.jsx("p",{className:"text-gray-600",children:"Available Stars"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Total: ",de(l)," | Spent: ",(r==null?void 0:r.stars_spent)||0]})]})}),e.jsx(b,{className:"border-4 border-blue-300 bg-gradient-to-r from-blue-50 to-cyan-50",children:e.jsxs(_,{className:"p-6 text-center",children:[e.jsx(z,{className:"w-12 h-12 mx-auto mb-2 text-blue-500"}),e.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-1",children:W(r)}),e.jsx("p",{className:"text-gray-600",children:"Coins"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For power-ups and boosts"})]})})]}),c&&e.jsxs(Y,{className:"mb-6 bg-green-50 border-green-200",children:[e.jsx(L,{className:"w-4 h-4 text-green-600"}),e.jsx(O,{className:"text-green-800",children:"Purchase successful! Item added to your collection ğŸ‰"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(Ce,{})}),e.jsx(b,{className:"border-2 border-purple-200",children:e.jsx(_,{className:"p-6",children:e.jsxs(ae,{value:t,onValueChange:u,children:[e.jsxs(re,{className:"grid w-full grid-cols-4 mb-6",children:[e.jsxs(v,{value:"pets",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Pets"]}),e.jsxs(v,{value:"avatar",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Avatar"]}),e.jsxs(v,{value:"badges",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Badges"]}),e.jsxs(v,{value:"powerups",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Power-Ups"]})]}),e.jsx(q,{value:"pets",className:"space-y-6",children:e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:G.pets.map(a=>{var s;const n=N(a.id,"pet"),p=(r==null?void 0:r.active_pet)===a.id,x=F()>=a.price,k=a.premium&&!(w!=null&&w.hasPremiumAccess);return e.jsxs(b,{className:`border-2 ${p?"border-purple-500 ring-2 ring-purple-200":k?"border-purple-300 bg-purple-50":"border-gray-200"}`,children:[e.jsx(J,{children:e.jsxs(X,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[a.name,a.premium&&e.jsx(M,{className:"w-4 h-4 inline ml-1 text-purple-500"})]}),p&&e.jsx(P,{className:"bg-purple-500",children:"Active"})]})}),e.jsxs(_,{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(we,{pet:a,experience:((s=r==null?void 0:r.pet_experience)==null?void 0:s[a.id])||0,size:"large"})}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.description}),n?p?e.jsx(f,{disabled:!0,className:"w-full",variant:"outline",children:"Currently Active"}):e.jsx(f,{onClick:()=>U(a.id),className:"w-full bg-purple-500 hover:bg-purple-600",children:"Set as Active"}):k?e.jsxs(f,{onClick:()=>{H(a),D(!0)},variant:"outline",className:"w-full border-purple-400 text-purple-600",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Premium Only"]}):e.jsx(f,{onClick:()=>h(a,"pet"),disabled:!x||m.isPending,className:`w-full ${x?"bg-gradient-to-r from-purple-500 to-pink-500":""}`,children:x?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2 fill-white"}),"Buy for ",a.price," Stars"]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Need ",a.price-F()," more stars"]})})]})]},a.id)})})}),e.jsx(q,{value:"avatar",className:"space-y-6",children:e.jsxs(ae,{defaultValue:"hair",children:[e.jsxs(re,{className:"grid w-full grid-cols-5",children:[e.jsx(v,{value:"hair",children:"Hair"}),e.jsx(v,{value:"clothing",children:"Clothing"}),e.jsx(v,{value:"accessories",children:"Accessories"}),e.jsx(v,{value:"backgrounds",children:"Backgrounds"}),e.jsx(v,{value:"facial",children:"Facial"})]}),["hair","clothing","accessories","backgrounds","facial"].map(a=>e.jsx(q,{value:a,children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:G.avatarItems.filter(s=>s.category===a).map(s=>{const n=N(s.id),p=F()>=s.price,x=s.premium&&!(w!=null&&w.hasPremiumAccess);return e.jsx(b,{className:`border-2 ${n?"border-green-300 bg-green-50":x?"border-purple-300 bg-purple-50":"border-gray-200"}`,children:e.jsxs(_,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:s.emoji}),e.jsxs("h3",{className:"font-bold text-sm mb-2",children:[s.name,s.premium&&e.jsx(M,{className:"w-3 h-3 inline ml-1 text-purple-500"})]}),n?e.jsx(P,{className:"bg-green-500 text-white",children:"Owned"}):x?e.jsxs(f,{onClick:()=>{H(s),D(!0)},size:"sm",variant:"outline",className:"w-full border-purple-400 text-purple-600",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Premium"]}):e.jsx(f,{onClick:()=>h(s),disabled:!p||m.isPending,size:"sm",className:`w-full ${p?"bg-gradient-to-r from-purple-500 to-pink-500":""}`,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-3 h-3 mr-1 fill-white"}),s.price]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),s.price]})})]})},s.id)})})},a))]})}),e.jsxs(q,{value:"badges",className:"space-y-6",children:[e.jsxs(Y,{className:"bg-blue-50 border-blue-300",children:[e.jsx(L,{className:"w-4 h-4 text-blue-600"}),e.jsx(O,{className:"text-blue-800",children:"Badges are earned by completing specific achievements. Keep playing to unlock them all!"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:G.badges.map(a=>e.jsx(b,{className:"border-2 border-gray-200",children:e.jsxs(_,{className:"p-6 text-center",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(De,{badge:a,size:"large"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:a.description}),e.jsx(P,{variant:"outline",className:"text-xs",children:a.requirement})]})},a.id))})]}),e.jsxs(q,{value:"powerups",className:"space-y-6",children:[e.jsxs(Y,{className:"bg-cyan-50 border-cyan-300",children:[e.jsx(z,{className:"w-4 h-4 text-cyan-600"}),e.jsx(O,{className:"text-cyan-800",children:"Power-ups are purchased with coins and can be used during games to help you succeed!"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:G.powerUps.map(a=>{const s=W(r)>=a.price,n=((r==null?void 0:r.power_ups)||{})[a.id]||0;return e.jsx(b,{className:"border-2 border-cyan-200",children:e.jsxs(_,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-5xl mb-3",children:a.emoji}),e.jsx("h3",{className:"font-bold mb-2",children:a.name}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:a.description}),n>0&&e.jsxs(P,{className:"bg-green-500 text-white mb-2",children:["Owned: ",n]}),e.jsx(f,{onClick:()=>h(a,"powerup",!0),disabled:!s||m.isPending,size:"sm",className:`w-full ${s?"bg-gradient-to-r from-cyan-500 to-blue-500":""}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Buy for ",a.price]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Need ",a.price-W(r)," coins"]})})]})},a.id)})})]})]})})}),e.jsxs(b,{className:"mt-8 bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-purple-200",children:[e.jsx(J,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-6 h-6 text-purple-600"}),"How to Earn More"]})}),e.jsxs(_,{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx(le,{size:"sm",variant:"circle"})}),e.jsx("h3",{className:"font-bold mb-1",children:"Play Games"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Earn up to 3 stars per game"})]}),e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ“…"}),e.jsx("h3",{className:"font-bold mb-1",children:"Daily Challenges"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Get bonus rewards every day"})]}),e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ†"}),e.jsx("h3",{className:"font-bold mb-1",children:"Achievements"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Unlock items by achieving goals"})]})]})]})]})}export{$e as default};
