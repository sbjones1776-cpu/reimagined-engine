import{X as Re,n as tt,S as l,Z as st,m as De,Y as Ie,x as e,r as T,y as U,t as G,i as Q,p as ae,j as re,u as B,v as K,q as z,e as Me,U as F,a0 as N,f as at,w as Ye,a1 as rt,a2 as lt,z as ue,A as pe,a3 as it,R as nt,l as ot,a4 as ct,a5 as mt,a6 as dt,Q as xt}from"./index-yRbXivLn.js";import{G as ut}from"./useMutation-BBbn5Ibo-BJFBDAw4-Dv4aGJVX-BVnXju1M.js";import{B as pt}from"./progress-D8Mly-oi-3Ij_j_WH-Cj7a_al8-XJPky_9h.js";import{V as ht,A as gt}from"./CelebrationAnimation-5xmelkAl-MsLmzNGW-DQLTHAl3-CZLYZj1G.js";import{L as _}from"./TextToSpeech-jPFv8Mzs-9YNY52v7-7DUXlPgf-H7L-9G35.js";import{y as He}from"./target-CKjL3a7Z-CNfUoT2L-BFcD-nDp-BZzxImDO.js";import{r as bt}from"./coins-C3lSgozT-BPAlcUrl-iLAVQAYw-DCt0oMhl.js";import{e as yt}from"./rotate-ccw-BY_oOohm-Dv5j0UO6-ChJLhnxT-Ckthe42F.js";import{r as ft}from"./circle-alert-BiIT3tKc-CrsIGr-p-Dg4J1ZQm-yRIPZ1pU.js";import{o as qe}from"./book-open-ChO3lU0J-BkdXvgrc-D-2K2eBZ-BHEak8UT.js";import{c as jt}from"./award-DsC9STJ2-D9jCxi3D-CzTl10qc-BMHn5bMC.js";import{l as wt}from"./trending-up-Bw7UHNpS-DrWngiVT-DdV0ZwgI-Db5MxTA1.js";import{t as vt}from"./trending-down-DyY_-Dls-DCTF-sbq-Bkw8f1qh-CpnxeDN9.js";import{r as he}from"./lock-C1-5gGAl-B47CgZWV-D6DQBFTb-DR4RYhi6.js";import{a as Nt}from"./triangle-alert-Dd6OicLx-I3IE0NwH-CK_H4sCV-gKxDgY7H.js";import{w as _t}from"./QuestionGenerator-z-c728t7-CSzYVewV-BkEMOThz-BkEMOThz.js";import{b as kt}from"./PremiumFeatureLock-DOt-wJcj-CYCxA8pw-VcdfFfA8-VUPVXmCD.js";import{e as se}from"./arrow-left-B1UHrOU7-W_GQWmbU-B_okVX8Y-BMeIpEeU.js";import{t as St}from"./zap-w4f_OL2g-BKWEZluV-BRBCNtj7-CAvlrAfT.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Ee=ot("Lightbulb",$t);function Tt({score:a,correctAnswers:u,totalQuestions:c,timeTaken:p,operation:q,level:Y,coinsEarned:i=0,activePowerUps:H={}}){const n=Re(),w=u/c*100;let m=0,v="",b="";return w>=90?(m=3,v="Outstanding! You're a math superstar!",b="üåü"):w>=70?(m=2,v="Great job! Keep practicing!",b="üéâ"):w>=50?(m=1,v="Good effort! Try again to improve!",b="üëç"):(m=0,v="Keep practicing! You'll get better!",b="üí™"),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(F.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},children:e.jsxs(G,{className:"border-4 border-yellow-300 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 py-12 text-white text-center",children:[e.jsx(F.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"text-8xl mb-4",children:b}),e.jsxs("h1",{className:"text-4xl md:text-5xl font-bold mb-2 flex items-center gap-2",children:["Challenge Complete!",e.jsx(_,{text:N("Challenge Complete!"),style:"icon",label:"Read title"})]}),e.jsxs("p",{className:"text-xl flex items-center gap-2",children:[v,e.jsx(_,{text:N(v),style:"icon",label:"Read message"})]})]}),e.jsxs(Q,{className:"p-8 space-y-6",children:[" ",e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-xl",children:[e.jsx(ae,{className:"w-8 h-8 mx-auto mb-2 text-purple-500"}),e.jsxs("div",{className:"text-3xl font-bold text-purple-600 flex items-center gap-2",children:[a,e.jsx(_,{text:N(`Your score is ${a}`),style:"icon",label:"Read score"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Score"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-xl",children:[e.jsx(He,{className:"w-8 h-8 mx-auto mb-2 text-green-500"}),e.jsxs("div",{className:"text-3xl font-bold text-green-600 flex items-center gap-2",children:[u,"/",c,e.jsx(_,{text:N(`You got ${u} out of ${c} correct`),style:"icon",label:"Read correct answers"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Correct"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-xl",children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-2 text-blue-500"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 flex items-center gap-2",children:[p,"s",e.jsx(_,{text:N(`Time taken: ${p} seconds`),style:"icon",label:"Read time"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Time"})]}),e.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-xl",children:[e.jsx(at,{className:"w-8 h-8 mx-auto mb-2 text-yellow-500 fill-yellow-500"}),e.jsxs("div",{className:"text-3xl font-bold text-yellow-600 flex items-center gap-2",children:[m,e.jsx(_,{text:N(`You earned ${m} stars`),style:"icon",label:"Read stars"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Stars"})]})]}),i>0&&e.jsx(G,{className:"border-2 border-cyan-300 bg-gradient-to-r from-cyan-50 to-blue-50",children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center",children:e.jsx(bt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:["Coins Earned!",e.jsx(_,{text:N(`You earned ${i} coins!`),style:"icon",label:"Read coins"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use them in the shop for power-ups"})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-cyan-600 flex items-center gap-2",children:["+",i,e.jsx(_,{text:N(`Plus ${i} coins`),style:"icon",label:"Read coins"})]})]})})}),Object.keys(H).length>0&&e.jsxs(B,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(Ye,{className:"w-4 h-4 text-yellow-600"}),e.jsxs(K,{className:"text-yellow-800 flex items-center gap-2",children:[e.jsx("strong",{children:"Power-ups were active!"})," Your rewards have been boosted!",e.jsx(_,{text:N("Power-ups were active! Your rewards have been boosted!"),style:"icon",label:"Read power-ups"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs(T,{variant:"outline",className:"flex-1 h-14 text-lg gap-2",onClick:()=>n(U("Home")),children:[e.jsx(rt,{className:"w-5 h-5"}),"Back Home"]}),e.jsxs(T,{variant:"outline",className:"flex-1 h-14 text-lg gap-2",onClick:()=>window.location.reload(),children:[e.jsx(yt,{className:"w-5 h-5"}),"Try Again"]}),e.jsxs(T,{className:"flex-1 h-14 text-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 gap-2",onClick:()=>n(U("Progress")),children:["View Progress",e.jsx(lt,{className:"w-5 h-5"})]})]})]})]})})})}function Ct({question:a,correctAnswer:u,userAnswer:c,operation:p,level:q,onContinue:Y}){const[i,H]=l.useState(!1),[n,w]=l.useState(!1),[m,v]=l.useState(""),[b,C]=l.useState(""),[j,$]=l.useState(!1),[P,k]=l.useState(null),E=async()=>{$(!0),k(null);try{console.log("ü§ñ Generating hint for:",a),console.log("ü§ñ AI hints are currently being migrated to Firebase.");const d=`Let's think about ${a} together! Try breaking it down into smaller steps. ${p==="addition"?"Add the ones first, then the tens.":p==="subtraction"?"Remember to borrow if you need to!":p==="multiplication"?"Think about groups of the same number.":"Think about dividing into equal groups!"} You can do this! üí™`;v(d),H(!0),console.log("Tutor session (placeholder):",{question:a,correct_answer:u,user_answer:c,operation:p,level:q,hint_requested:!0,hint_text:d})}catch(d){console.error("‚ùå Error generating hint:",d),k(d.message);const y=`Let's think about ${a} together! Try breaking it down into smaller steps. ${p==="addition"?"Add the ones first, then the tens.":p==="subtraction"?"Remember to borrow if you need to!":p==="multiplication"?"Think about groups of the same number.":"Think about dividing into equal groups!"} You can do this! üí™`;v(y),H(!0)}$(!1)},L=async()=>{$(!0),k(null);try{console.log("ü§ñ Generating explanation for:",a),console.log("ü§ñ AI explanations are currently being migrated to Firebase.");const d=A(a,u,c,p);C(d),w(!0),console.log("Tutor session (placeholder):",{question:a,correct_answer:u,user_answer:c,operation:p,level:q,explanation_viewed:!0,explanation_text:d})}catch(d){console.error("‚ùå Error generating explanation:",d),k(d.message);const y=A(a,u,c,p);C(y),w(!0)}$(!1)},A=(d,y,S,f)=>{var W,J;const V=d.split(/[\+\-\√ó√∑]/),x=parseInt(((W=V[0])==null?void 0:W.trim())||0),g=parseInt(((J=V[1])==null?void 0:J.trim())||0);let r=`**üìç WHERE DID I GO WRONG?**
`;return r+=`You got ${S}, but the correct answer is ${y}. Let's figure out why and learn from it!

`,r+=`**‚ú® LET'S SOLVE IT STEP-BY-STEP!**

`,f==="addition"?(r+=`1Ô∏è‚É£ Set up the problem: ${x} + ${g}
`,r+=`2Ô∏è‚É£ Add the ones place: ${x%10} + ${g%10} = ${x%10+g%10}
`,x%10+g%10>=10&&(r+=`3Ô∏è‚É£ That's ${x%10+g%10}, so we carry the 1!
`),r+=`4Ô∏è‚É£ Add the tens place: ${Math.floor(x/10)} + ${Math.floor(g/10)} ${x%10+g%10>=10?"+ 1 (carried)":""}
`,r+=`5Ô∏è‚É£ Final answer: **${y}** ‚úì

`):f==="subtraction"?(r+=`1Ô∏è‚É£ Set up the problem: ${x} - ${g}
`,r+=`2Ô∏è‚É£ Start with the ones place
`,x%10<g%10&&(r+=`3Ô∏è‚É£ We need to borrow from the tens place!
`),r+=`4Ô∏è‚É£ Subtract: ${x} - ${g}
`,r+=`5Ô∏è‚É£ Final answer: **${y}** ‚úì

`):f==="multiplication"?(r+=`1Ô∏è‚É£ Think: ${x} groups of ${g}
`,r+=`2Ô∏è‚É£ Or: ${x} √ó ${g}
`,(x>10||g>10)&&(r+=`3Ô∏è‚É£ Break it down: (${Math.floor(x/10)*10} + ${x%10}) √ó ${g}
`),r+=`4Ô∏è‚É£ Calculate: ${x} √ó ${g} = ${y}
`,r+=`5Ô∏è‚É£ Final answer: **${y}** ‚úì

`):f==="division"&&(r+=`1Ô∏è‚É£ How many ${g}s fit into ${x}?
`,r+=`2Ô∏è‚É£ Count by ${g}s until you reach ${x}
`,r+=`3Ô∏è‚É£ Check: ${y} √ó ${g} = ${x}
`,r+=`4Ô∏è‚É£ Final answer: **${y}** ‚úì

`),r+=`**üéØ THE RIGHT ANSWER**
`,r+=`${d} = **${y}** üéâ

`,r+=`**üí° QUICK TIP TO REMEMBER**
`,f==="addition"?r+=`Always start with the ones place and work your way left. Don't forget to carry!

`:f==="subtraction"?r+=`If the top number is smaller, remember to borrow from the next column!

`:f==="multiplication"?r+=`Break big numbers into smaller parts to make multiplication easier!

`:r+=`Division is the opposite of multiplication - think about groups!

`,r+=`**üèÉ PRACTICE HELPS!**
`,r+=`The more you practice ${f}, the easier it gets. You're doing great! Keep going! üí™`,r};return e.jsx(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(G,{className:"max-w-2xl w-full border-4 border-blue-300 shadow-2xl max-h-[90vh] overflow-auto",children:[e.jsx(ue,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white",children:e.jsxs(pe,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(Me,{className:"w-7 h-7"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"AI Math Tutor"}),e.jsxs(z,{variant:"secondary",className:"bg-white/20 text-white",children:[e.jsx(Ye,{className:"w-3 h-3 mr-1"}),"Powered by AI"]})]}),e.jsx("p",{className:"text-sm opacity-90 font-normal mt-1",children:"Let's learn from this mistake together! üåü"})]})]})}),e.jsxs(Q,{className:"p-6 space-y-6",children:[e.jsx(B,{className:"bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-200",children:e.jsx(K,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Question:"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[a,e.jsx(_,{text:N(a),style:"icon",label:"Read question"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4 text-red-500"}),"Your answer:"]}),e.jsxs(z,{variant:"outline",className:"bg-red-100 border-red-300 text-red-700 text-lg flex items-center gap-2",children:[c,e.jsx(_,{text:N(c==null?void 0:c.toString()),style:"icon",label:"Read your answer"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-green-500"}),"Correct answer:"]}),e.jsxs(z,{className:"bg-green-500 text-white text-lg flex items-center gap-2",children:[u,e.jsx(_,{text:N(u==null?void 0:u.toString()),style:"icon",label:"Read correct answer"})]})]})]})})}),P&&e.jsxs(B,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(ft,{className:"w-4 h-4 text-yellow-600"}),e.jsxs(K,{className:"text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," Using fallback explanation. ",P]})]}),e.jsx("div",{children:i?e.jsx(F.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:e.jsxs(G,{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs(pe,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Ee,{className:"w-5 h-5 text-yellow-600"}),"Hint"]})}),e.jsx(Q,{children:e.jsxs("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:[m,e.jsx(_,{text:N(m),style:"icon",label:"Read hint"})]})})]})}):e.jsx(T,{onClick:E,disabled:j,className:"w-full h-16 text-lg bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-yellow-500 hover:to-orange-500 text-gray-900",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-gray-900 border-t-transparent rounded-full mr-2"}),"Thinking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-6 h-6 mr-2"}),"Get a Hint"]})})}),i&&e.jsx("div",{children:n?e.jsx(F.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:e.jsxs(G,{className:"bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-300",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(pe,{className:"flex items-center gap-2 text-lg",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-600"}),"Complete Solution"]}),e.jsx(_,{text:N(b.replace(/\*\*/g,"").replace(/\n\n/g,". ").replace(/\n/g,". ")),style:"button",label:"Read entire solution"})]})}),e.jsx(Q,{children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("div",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed space-y-3",children:b.split(`

`).map((d,y)=>e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("div",{className:"flex-1",children:d.split(`
`).map((S,f)=>S.startsWith("**")&&S.endsWith("**")?e.jsx("h4",{className:"font-bold text-lg mb-2 text-purple-700",children:S.replace(/\*\*/g,"")},f):/^\d+Ô∏è‚É£/.test(S)?e.jsx("div",{className:"flex gap-3 mb-2 bg-white p-2 rounded-lg",children:e.jsx("span",{className:"text-blue-600 font-bold",children:S})},f):S?e.jsx("p",{className:"mb-2",children:S},f):null)}),e.jsx(_,{text:N(d.replace(/\*\*/g,"")),style:"icon",label:"Read this section"})]})},y))})})})]})}):e.jsx(T,{onClick:L,disabled:j,className:"w-full h-16 text-lg bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"}),"Generating Explanation..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-6 h-6 mr-2"}),"Show Step-by-Step Solution"]})})}),e.jsx(B,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200",children:e.jsxs(K,{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"üí™"}),e.jsx("p",{className:"font-medium text-gray-800",children:"Mistakes help us learn! Keep practicing and you'll get better every day!"})]})}),e.jsxs(T,{onClick:Y,className:"w-full h-14 text-lg bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:["I Understand! Continue",e.jsx(ct,{className:"w-5 h-5 ml-2"})]})]})]})})}function Pt({adjustment:a,onClose:u}){const c={easier:{icon:vt,color:"from-blue-400 to-cyan-400",title:"Let's Try Something Easier!",message:"Don't worry! I'm adjusting the difficulty to help you build confidence. You've got this! üíô",emoji:"üéØ"},harder:{icon:wt,color:"from-purple-400 to-pink-400",title:"Level Up Challenge!",message:"Wow! You're doing amazing! Let's try some harder problems to keep you challenged! üöÄ",emoji:"‚≠ê"},perfect:{icon:jt,color:"from-yellow-400 to-orange-400",title:"Perfect Match!",message:"The difficulty is just right for you! Keep up the excellent work! üéâ",emoji:"üèÜ"}},p=c[a]||c.perfect,q=p.icon;return e.jsx(F.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:u,children:e.jsx(F.div,{initial:{y:-50},animate:{y:0},onClick:Y=>Y.stopPropagation(),children:e.jsx(G,{className:`max-w-md border-4 shadow-2xl bg-gradient-to-br ${p.color}`,children:e.jsxs(Q,{className:"p-8 text-center text-white",children:[e.jsx(F.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring"},className:"text-7xl mb-4",children:p.emoji}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(q,{className:"w-6 h-6"}),e.jsx("h3",{className:"text-2xl font-bold",children:p.title})]}),e.jsx("p",{className:"text-lg opacity-95 mb-6",children:p.message}),e.jsxs(z,{className:"bg-white/20 text-white text-sm px-4 py-2",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"AI Adaptive Learning"]}),e.jsx("p",{className:"text-xs mt-4 opacity-75",children:"Click anywhere to continue"})]})})})})}function At({operation:a=null}){var u;const[c,p]=l.useState(0),[q,Y]=l.useState(!1),[i,H]=l.useState(!1),{data:n,refetch:w}=De({queryKey:["currentUser"],queryFn:async()=>({email:"user@example.com",parental_controls:{},daily_usage_tracking:{}}),initialData:{email:"user@example.com",parental_controls:{},daily_usage_tracking:{}}}),m=Ie(new Date,"yyyy-MM-dd"),v=(n==null?void 0:n.parental_controls)||{},b=(n==null?void 0:n.daily_usage_tracking)||{},C=b[m]||{total_minutes:0,by_operation:{}},j=v.daily_time_limit_minutes||0,$=v.enforce_time_limits!==!1,P=v.time_limit_warning_minutes||5,k=v.time_limits_by_operation||{};if(l.useEffect(()=>{var A;if(!$||j===0)return;const d=C.total_minutes||0;p(d),d>=j?H(!0):j-d<=P&&j-d>0&&Y(!0),a&&k[a]&&(((A=C.by_operation)==null?void 0:A[a])||0)>=k[a]&&H(!0)},[n,a,$,j,P,k]),l.useEffect(()=>{if(!$||i)return;const A=setInterval(async()=>{var d;const y=Math.floor((C.total_minutes||0)+.016666666666666666),S=a?Math.floor((((d=C.by_operation)==null?void 0:d[a])||0)+1/60):0,f={...b,[m]:{total_minutes:y,by_operation:{...C.by_operation||{},...a?{[a]:S}:{}}}};try{console.log("Time tracking update (placeholder):",f),await w()}catch(W){console.error("Error updating time tracking:",W)}},6e4);return()=>clearInterval(A)},[$,i,a,C,b,w]),!$||j===0)return null;const E=Math.max(0,j-c),L=a&&k[a]?Math.max(0,k[a]-(((u=C.by_operation)==null?void 0:u[a])||0)):null;return i?e.jsxs(B,{className:"mb-6 bg-red-50 border-red-300",children:[e.jsx(he,{className:"w-5 h-5 text-red-600"}),e.jsxs(K,{className:"text-red-800",children:[e.jsx("strong",{className:"block mb-2",children:"Time Limit Reached"}),"You've used your allotted time for today. Come back tomorrow to continue learning!",a&&L===0&&k[a]&&e.jsxs("p",{className:"mt-2 text-sm",children:[a," time limit: ",k[a]," minutes reached"]}),e.jsx("div",{className:"mt-3 text-sm text-gray-600",children:"Time resets at midnight. See you tomorrow! üåô"})]})]}):q&&E<=P?e.jsxs(B,{className:"mb-6 bg-yellow-50 border-yellow-300",children:[e.jsx(Nt,{className:"w-5 h-5 text-yellow-600"}),e.jsxs(K,{className:"text-yellow-800",children:[e.jsx("strong",{className:"block mb-2",children:"Time Running Out!"}),"You have ",e.jsxs("strong",{children:[E," minutes"]})," left to play today.",a&&L!==null&&L<E&&e.jsxs("p",{className:"mt-2",children:[a,": ",e.jsxs("strong",{children:[L," minutes"]})," left"]})]})]}):e.jsxs("div",{className:"mb-4 flex items-center justify-end gap-2 text-sm text-gray-600",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsxs("span",{children:[E," minutes remaining today"]})]})}function Zt(){var a;const u=Re(),c=tt(),p=new URLSearchParams(window.location.search),q=p.get("operation"),Y=p.get("level"),[i,H]=l.useState(q),[n,w]=l.useState(Y),[m,v]=l.useState(0),[b,C]=l.useState([]),[j,$]=l.useState([]),[P,k]=l.useState(0),[E,L]=l.useState(!1),[A,d]=l.useState(Date.now()),[y,S]=l.useState(!1),[f,W]=l.useState(0),[J,V]=l.useState(!1),[x,g]=l.useState(null),[r,ge]=l.useState(!1),[Le,Ue]=l.useState(null),[X,qt]=l.useState({}),[Ge,be]=l.useState(!1),[ye,Qe]=l.useState(!1),I=10,{user:t}=st(),{data:fe=[]}=De({queryKey:["recentProgress",t==null?void 0:t.email],queryFn:async()=>t!=null&&t.email?(await xt(t.email)).slice(0,5):[],initialData:[],enabled:!!(t!=null&&t.email)}),le=!!(t!=null&&t.hasPremiumAccess),Z=["addition","subtraction","multiplication","division","addition_single_digit","subtraction_single_digit","counting","number_comparison"],ie=["easy"],R=(t==null?void 0:t.parental_controls)||{},ee=R.focus_operations||[];R.focus_priority;const je=R.focus_reminder_frequency||"never",we=["addition","subtraction","multiplication","division","fractions","decimals","percentages","word_problems","money_math","time","geometry","mixed","counting","number_comparison","skip_counting_2s","skip_counting_5s","skip_counting_10s","even_odd","ordering_numbers","place_value","addition_single_digit","subtraction_single_digit"],ne=Array.isArray(R.allowed_operations)?R.allowed_operations:void 0,oe=Array.isArray(R.allowed_levels)?R.allowed_levels:void 0,ce=!!(t!=null&&t._optimisticTrial||t!=null&&t.isOnTrial||t!=null&&t.inGraceDay),Fe=ce?we:le?ne&&ne.length>0?ne:we:Z,Oe=ce?["easy","medium","hard","expert"]:le?oe&&oe.length>0?oe:["easy","medium","hard","expert"]:ie,Be=Ie(new Date,"yyyy-MM-dd"),ve=((t==null?void 0:t.daily_usage_tracking)||{})[Be]||{total_minutes:0,by_operation:{}},Ne=R.daily_time_limit_minutes||0,_e=R.time_limits_by_operation||{},ke=R.enforce_time_limits!==!1,te=Fe.includes(i),me=Oe.includes(n),Ke=ke&&Ne>0&&(ve.total_minutes||0)>=Ne,We=ke&&i&&_e[i]&&(((a=ve.by_operation)==null?void 0:a[i])||0)>=_e[i],Se=!(ce||t!=null&&t.hasPremiumAccess)&&(!te||!me);l.useEffect(()=>{Se&&Qe(!0)},[Se]),l.useEffect(()=>{ee.length>0&&je==="every_session"&&!ee.includes(i)&&be(!0)},[i,ee,je]),l.useEffect(()=>{$e(),d(Date.now())},[i,n]),l.useEffect(()=>{if(!E){const s=setInterval(()=>{W(Math.floor((Date.now()-A)/1e3))},1e3);return()=>clearInterval(s)}},[A,E]);const ze=()=>{if(fe.length<3)return null;const s=fe.map(o=>o.correct_answers/o.total_questions*100),h=s.reduce((o,M)=>o+M,0)/s.length;return h>=90&&n!=="expert"?"harder":h<60&&n!=="easy"?"easier":null},Ve=s=>{s==="harder"?n==="easy"?w("medium"):n==="medium"?w("hard"):n==="hard"&&w("expert"):s==="easier"&&(n==="expert"?w("hard"):n==="hard"?w("medium"):n==="medium"&&w("easy"))},$e=()=>{const s=[];for(let h=0;h<I;h++)s.push(_t(i,n));C(s)},Te=(s,h)=>{let o=s*5;return h<60?o+=20:h<120&&(o+=10),s===I&&(o+=30),X.double_coins&&(o*=2),o},Xe=ut({mutationFn:async s=>{var h;if(!(t!=null&&t.email))throw new Error("User not authenticated");const o=await mt(t.email,s),M=s.coins_earned||0,D={coins:((t==null?void 0:t.coins)||0)+M,total_stars_earned:((t==null?void 0:t.total_stars_earned)||0)+(s.stars_earned||0)},O=t==null?void 0:t.active_pet;if(O){const de=((h=t==null?void 0:t.pet_experience)==null?void 0:h[O])||0,xe=s.correct_answers*10;D.pet_experience={...(t==null?void 0:t.pet_experience)||{},[O]:de+xe}}return await dt(t.email,D),o},onMutate:async s=>{await c.cancelQueries({queryKey:["gameProgress",t==null?void 0:t.email]}),await c.cancelQueries({queryKey:["recentProgress",t==null?void 0:t.email]});const h=c.getQueryData(["gameProgress",t==null?void 0:t.email])||[],o=c.getQueryData(["recentProgress",t==null?void 0:t.email])||[],M={id:"optimistic-"+Date.now(),user_email:t==null?void 0:t.email,operation:s.operation,level:s.level,score:s.score,correct_answers:s.correct_answers,total_questions:s.total_questions,time_taken:s.time_taken,stars_earned:s.stars_earned,coins_earned:s.coins_earned,completed_at:new Date};return c.setQueryData(["gameProgress",t==null?void 0:t.email],[M,...h]),c.setQueryData(["recentProgress",t==null?void 0:t.email],[M,...o].slice(0,5)),{prevProgress:h,prevRecent:o}},onError:(s,h,o)=>{o!=null&&o.prevProgress&&c.setQueryData(["gameProgress",t==null?void 0:t.email],o.prevProgress),o!=null&&o.prevRecent&&c.setQueryData(["recentProgress",t==null?void 0:t.email],o.prevRecent)},onSettled:()=>{c.invalidateQueries({queryKey:["gameProgress",t==null?void 0:t.email]}),c.invalidateQueries({queryKey:["recentProgress",t==null?void 0:t.email]}),c.invalidateQueries({queryKey:["currentUser"]})}}),Ze=s=>{const h=s===b[m].answer;if(m===I-1){const o=[...j,{question:m,correct:h}];$(o),Pe(o);return}$([...j,{question:m,correct:h}]),h?(k(P+10),S(!0),setTimeout(()=>S(!1),1e3),setTimeout(()=>{Ce()},500)):(g({question:b[m].question,correctAnswer:b[m].answer,userAnswer:s,explanation:b[m].explanation}),V(!0))},Ce=()=>{if(m<I-1){if(v(m+1),(m+1)%3===0){const s=ze();s&&(Ue(s),ge(!0),Ve(s),setTimeout(()=>{$e()},2e3))}}else Pe()},Pe=(s=null)=>{const h=Math.floor((Date.now()-A)/1e3),o=(s||j).filter(et=>et.correct).length;let M=P;X.double_stars&&(M*=2);let D=0;const O=o/I*100;O>=90?D=3:O>=70?D=2:O>=50&&(D=1),X.double_stars&&D>0&&(D=Math.min(D*2,3));const de=Te(o,h),xe={addition:"Practice adding numbers accurately",subtraction:"Practice subtracting numbers accurately",multiplication:"Master multiplication facts and techniques",division:"Understand division and practice calculations",fractions:"Work with fractions - add, subtract, multiply, divide",decimals:"Practice decimal operations",percentages:"Calculate percentages",word_problems:"Apply math to real-world scenarios",money:"Work with dollars and cents",time:"Practice telling time and calculating elapsed time",geometry:"Understand shapes, area, perimeter, and volume",mixed:"Practice multiple operations"};Xe.mutate({level:n,operation:i,score:M,correct_answers:o,total_questions:I,time_taken:h,stars_earned:D,coins_earned:de,learning_objective:xe[i]||"Mathematical problem solving"}),setTimeout(()=>{L(!0)},500)},Je=()=>{V(!1),g(null),Ce()};if(!i||!n)return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8 text-center",children:[e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Invalid game configuration"}),e.jsx(T,{onClick:()=>u(U("Home")),children:"Go Back Home"})]});if(!te||!me){const s=!le&&(!Z.includes(i)||!ie.includes(n));return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(G,{className:`border-4 ${s?"border-yellow-400 bg-gradient-to-r from-yellow-50 to-orange-50":"border-red-300"} shadow-xl`,children:e.jsx(Q,{className:"p-12 text-center",children:s?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-16 h-16 mx-auto mb-4 text-yellow-600"}),e.jsxs("div",{className:"inline-flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-6 h-6 text-yellow-600"}),e.jsx("h2",{className:"text-2xl font-bold text-yellow-700",children:"Premium Content"})]}),e.jsxs("p",{className:"text-gray-700 mb-4 font-medium",children:[!Z.includes(i)&&"This math concept is available in Premium.",!ie.includes(n)&&Z.includes(i)&&"This difficulty level is available in Premium."]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Upgrade to unlock 80+ math concepts and all difficulty levels!"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(T,{onClick:()=>u(U("Subscription")),className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Upgrade Now"]}),e.jsxs(T,{variant:"outline",onClick:()=>u(U("Home")),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-red-700",children:"Content Restricted"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:[!te&&"This math concept is currently restricted by your parent.",!me&&te&&"This difficulty level is currently restricted by your parent."]}),e.jsxs(T,{onClick:()=>u(U("Home")),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})})})})}if(Ke||We)return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsx(G,{className:"border-4 border-orange-300 shadow-xl",children:e.jsxs(Q,{className:"p-12 text-center",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-orange-500"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 text-orange-700",children:"Time Limit Reached"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You've used your allotted time for today. Great job practicing! Come back tomorrow to continue learning."}),e.jsx("div",{className:"text-sm text-gray-500 mb-6",children:"Time resets at midnight üåô"}),e.jsxs(T,{onClick:()=>u(U("Home")),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Back to Home"]})]})})});if(b.length===0)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Loading your challenge..."})]})});if(E){const s=j.filter(h=>h.correct).length;return e.jsx(Tt,{score:P,correctAnswers:s,totalQuestions:I,timeTaken:f,operation:i,level:n,coinsEarned:Te(s,f),activePowerUps:X})}const Ae=(m+1)/I*100;return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[y&&e.jsx(ht,{}),ye&&e.jsx(kt,{featureName:`${i} - ${n} Level`,description:`Unlock all math operations and difficulty levels with a premium subscription. Free users can practice ${Z.join(", ")} on Easy level.`,isOpen:ye,onClose:()=>u("/")}),J&&x&&e.jsx(Ct,{question:x.question,correctAnswer:x.correctAnswer,userAnswer:x.userAnswer,explanation:x.explanation,operation:i,level:n,onContinue:Je}),r&&e.jsx(Pt,{adjustment:Le,onClose:()=>ge(!1)}),Ge&&e.jsxs(B,{className:"mb-6 bg-purple-50 border-purple-300",children:[e.jsx(He,{className:"w-5 h-5 text-purple-600"}),e.jsxs(K,{className:"text-purple-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Parent Suggestion:"})," Your parent recommends focusing on"," ",ee.join(", "),". Try playing those games!"]}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>be(!1),className:"ml-4 text-purple-700 hover:bg-purple-100",children:"Got it"})]})]}),e.jsx(At,{operation:i}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(T,{variant:"outline",onClick:()=>u(U("Home")),className:"gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[Object.keys(X).length>0&&e.jsxs(z,{variant:"outline",className:"text-lg px-4 py-2 bg-yellow-50 border-yellow-300",children:[e.jsx(St,{className:"w-5 h-5 mr-2 text-yellow-500"}),"Power-Ups Active"]}),e.jsxs(z,{variant:"outline",className:"text-lg px-4 py-2 bg-white",children:[e.jsx(Me,{className:"w-5 h-5 mr-2 text-purple-500"}),"AI Tutor Active"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-md",children:[e.jsx(re,{className:"w-5 h-5 text-blue-500"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[f,"s"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-2 rounded-full shadow-md",children:[e.jsx(ae,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"font-bold text-gray-800",children:P})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Question ",m+1," of ",I]}),e.jsxs("span",{children:[Math.round(Ae),"%"]})]}),e.jsx(pt,{value:Ae,className:"h-3"})]})]}),b.length>0&&e.jsx(gt,{question:b[m],onAnswer:Ze,questionNumber:m+1})]})}export{Zt as default};
